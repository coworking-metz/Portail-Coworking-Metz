!function(t,e,o){"use strict";function c(){var t=o("#product-type").val();o(".tc-normal-epo").toArray().forEach(function(e){var c=o(e),i=c.find(".tmcp_attribute").val(),a=c.find("select.tmcp_att").val(),n=c.find("select.tmcp-variation").val(),r="input.tmcp-price-input-variation-"+n+"[data-price-input-attribute='"+a+"'],select.tmcp-price-input-variation-"+n+"[data-price-input-attribute='"+a+"']";"variable"!==t&&"variable-subscription"!==t?c.find(".show_if_variable").hide():c.find(".show_if_variable").show(),c.find("select.tmcp_att").hide(),c.find("select.tmcp_att[data-tm-attr='"+i+"']").show(),c.find("input.tmcp-price-input").hide(),c.find("select.tmcp-price-input-type").hide(),c.find(r).show()})}function i(){o(".tc-normal-epos .tc-normal-epo").toArray().forEach(function(t){o(".tm_epo_menu_order",t).val(parseInt(o(t).index(".tc-normal-epos .tc-normal-epo"),10))})}function a(t,e){var o,c=t.val(),i=t.closest(".tc-normal-epo"),a=i.find("input.tmcp_loop").val(),n=i.find("select.tmcp_att").val(),r=i.find("select.tmcp-variation").val(),p="";switch(i.find("input.tmcp-price-input").hide(),i.find("select.tmcp-price-input-type").hide(),e){case"variation":r=c,p="input.tmcp-price-input-variation-"+c+"[data-price-input-attribute='"+n+"'],select.tmcp-price-input-variation-"+c+"[data-price-input-attribute='"+n+"']";break;case"attribute":n=c,p="input.tmcp-price-input-variation-"+r+"[data-price-input-attribute='"+c+"'],select.tmcp-price-input-variation-"+r+"[data-price-input-attribute='"+c+"']"}i.find(p).length<=0&&((o=i.find(".tmcp-pricing")).append('<input type="text" size="5" name="tmcp_regular_price['+a+"]["+n+"]["+r+']" value="" class="wc_input_price tmcp-price-input tmcp-price-input-variation-'+r+'" data-price-input-attribute="'+n+'" />'),o.append('<select class="tmcp-price-input-type tmcp-price-input tmcp-price-input-variation-'+r+'" data-price-input-attribute="'+n+'" name="tmcp_regular_price_type['+a+"]["+n+"]["+r+']"><option value="">'+l.i18n_fixed_type+'</option><option value="percent">'+l.i18n_percent_type+"</option></select>")),i.find(p).show()}function n(){var t;1===m&&(o("#tc-admin-extra-product-options").block({message:null}),t={action:"woocommerce_tm_load_epos",post_id:l.post_id,security:l.load_tm_epo_nonce},o.post(l.ajax_url,t,function(t){o(".tm-mode-local").html(t),o("#tc-admin-extra-product-options").unblock(),o("#tc-admin-extra-product-options").trigger("tc_normal_epos_loaded"),m=0,c()}))}function r(t){t&&(o("#tm-meta-cpf-mode").val(t),o(".tm-mode-selector").addClass("tc-hidden"),o(".tm-mode-builder,.tm-mode-local,.tm-mode-settings").hide(),o(".tm-mode-"+t).show(),o(".tc-builder-select,.tc-local-select,.tc-settings-select").removeClass("button-primary"),o(".tc-"+t+"-select").addClass("button-primary"))}var p,l=t.TMEPOADMINJS,m=0;l&&o(function(){var e=o("#bulk-action-selector-top"),d=!1;e.length>0&&e.children("option").each(function(t,e){"tcline"===o(e).val()?(d=!0,o(e).replaceWith(o('<optgroup class="tc-bulk-opt" label="'+o(e).text()+'">'))):d&&"tcclear"!==o(e).val()&&"tcproductclear"!==o(e).val()&&"tcclearexclude"!==o(e).val()&&"tcclearexcludeadd"!==o(e).val()&&o(e).appendTo(o(".tc-bulk-opt")),"tcline2"===o(e).val()&&o(e).remove()}),p={items:".tc-normal-epo",cursor:"move",axis:"y",handle:"h3 .move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){t&&e.item.css("background-color","#f6f6f6")},stop:function(t,e){t&&e.item.removeAttr("style"),i()}},c(),o("#tc-admin-extra-product-options").on("change","select.tmcp-variation",function(){a(o(this),"variation")}),o("#tc-admin-extra-product-options").on("change","select.tmcp_att",function(){a(o(this),"attribute")}),o("#tc-admin-extra-product-options").on("tc_normal_epo_added",function(){o(".tc-normal-epos").sortable(p)}),o("#tc-admin-extra-product-options").on("tc_normal_epos_loaded",function(){o(".tc-normal-epos").sortable(p)}),o(".tc-normal-epos").sortable(p),o("#variable_product_options").on("click","button.remove_variation",function(){m=1}),o("#variable_product_options").on("woocommerce_variations_added",function(){m=1}),o(".product_attributes").on("click","button.add_new_attribute",function(){m=1}),o(".save_attributes").on("click",function(){m=1}),o(".tc-epo-woocommerce-tab a").on("click",function(){n()}),o("#tc-admin-extra-product-options").on("click","button.tm_add_epo",function(){var e=o("select.tmcp-attr-list").val(),i=o(".tc-normal-epos .tc-normal-epo[data-epo-attr='"+e+"']"),a=o(".tc-normal-epo").length,n={action:"woocommerce_tm_add_epo",post_id:l.post_id,att_id:e,loop:a,security:l.add_tm_epo_nonce};if(!(i.length>0))return o(".tm-mode-local").block({message:null}),o.post(l.ajax_url,n,function(e){"max"===e?(t.alert(l.i18n_max_tmcp),o(".tm-mode-local").unblock()):e&&(o(".tc-normal-epos").append(e),o("#tc-admin-extra-product-options").trigger("tc_normal_epo_added"),c())}).always(function(){o(".tm-mode-local").unblock()}),!1;i.find(".woocommerce-tmcp-attributes").show()}),o("#tc-admin-extra-product-options").on("click",".remove_tm_epo",function(e){var c,i,a,n=t.confirm(l.i18n_remove_tmcp);return e.preventDefault(),n&&(c=o(this).parent().parent(),(i=o(this).attr("rel"))>0?(c.block({message:null}),a={action:"woocommerce_tm_remove_epo",tmcpid:i,security:l.delete_tm_epo_nonce},o.post(l.ajax_url,a,function(){c.fadeOut("300",function(){c.remove()})})):c.fadeOut("300",function(){c.remove()})),!1}),o("#tc-admin-extra-product-options").on("change",".tm-type",function(){var t=o(this),e=t.closest(".data").find(".tmcp_choices");"checkbox"===t.val()?e.removeClass("tm-hidden"):e.addClass("tm-hidden")}),o("#tc-admin-extra-product-options").on("click",".tc-select-mode",function(t){var e="local";t.preventDefault(),o(this).is(".tc-builder-select")&&(e="builder"),o(this).is(".tc-settings-select")&&(e="settings"),r(e)}),o("#tm-meta-cpf-mode").val()||o("#tm-meta-cpf-mode").val("builder"),r(o("#tm-meta-cpf-mode").val()),o.tmEPOAdmin&&o.tmEPOAdmin.create_normal_dropdown(o(".tm-mode-settings")),o.fn.tmcheckboxes&&o(".tm-mode-settings").tmcheckboxes()})}(window,document,window.jQuery);