!function(e,t,i){"use strict";function n(e){var t=[];return Object.keys(e).forEach(function(i){Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=e[i])}),t}function a(e,t){var n,a=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?new Array(t-e.length+1).join("0")+e:e};return void 0===e&&(e=""),i.epoAPI.php=i.epoAPI.php||{},i.epoAPI.php.uniqidSeed||(i.epoAPI.php.uniqidSeed=Math.floor(123456789*Math.random())),i.epoAPI.php.uniqidSeed+=1,n=e,n+=a(parseInt(Date.now()/1e3,10),8),n+=a(i.epoAPI.php.uniqidSeed,5),t&&(n+=(10*Math.random()).toFixed(8).toString()),n}function o(e){var t,i;return"object"!=typeof e||null===e?e:(t=Array.isArray(e)?[]:{},Object.keys(e).forEach(function(n){e&&(i=e[n],t[n]="object"==typeof i&&null!==i?o(i):i)}),t)}var l,d,r,s,c,m,u,p,_=e.wp,f=e.TMEPOADMINJS,h=e.TMEPOGLOBALADMINJS,v=e.toastr,b=e._,g=e.plupload,O=!1,A={tc_builder_elements:_.template("tc-builder-elements"),tc_builder_section:_.template("tc-builder-section")},E=e.JSON;i.tmEPOAdmin={addEventsDone:0,variationsCheckForChanges:0,elementLogicObject:{},sectionLogicObject:{},logicOperators:{is:h.i18n_is,isnot:h.i18n_is_not,isempty:h.i18n_is_empty,isnotempty:h.i18n_is_not_empty,startswith:h.i18n_starts_with,endswith:h.i18n_ends_with,greaterthan:h.i18n_greater_than,lessthan:h.i18n_less_than,greaterthanequal:h.i18n_greater_than_equal,lessthanequal:h.i18n_less_than_equal},builderItemsSortableObj:{start:{},end:{}},builderSectionsSortableObj:{start:{},end:{}},builderSize:{w1:"1%",w2:"2%",w3:"3%",w4:"4%",w5:"5%",w6:"6%",w7:"7%",w8:"8%",w9:"9%",w10:"10%",w11:"11%",w12:"12%","w12-5":"12.5%",w13:"13%",w14:"14%",w15:"15%",w16:"16%",w17:"17%",w18:"18%",w19:"19%",w20:"20%",w21:"21%",w22:"22%",w23:"23%",w24:"24%",w25:"25%",w26:"26%",w27:"27%",w28:"28%",w29:"29%",w30:"30%",w31:"31%",w32:"32%",w33:"33%",w34:"34%",w35:"35%",w36:"36%",w37:"37%","w37-5":"37.5%",w38:"38%",w39:"39%",w40:"40%",w41:"41%",w42:"42%",w43:"43%",w44:"44%",w45:"45%",w46:"46%",w47:"47%",w48:"48%",w49:"49%",w50:"50%",w51:"51%",w52:"52%",w53:"53%",w54:"54%",w55:"55%",w56:"56%",w57:"57%",w58:"58%",w59:"59%",w60:"60%",w61:"61%",w62:"62%","w62-5":"62.5%",w63:"63%",w64:"64%",w65:"65%",w66:"66%",w67:"67%",w68:"68%",w69:"69%",w70:"70%",w71:"71%",w72:"72%",w73:"73%",w74:"74%",w75:"75%",w76:"76%",w77:"77%",w78:"78%",w79:"79%",w80:"80%",w81:"81%",w82:"82%",w83:"83%",w84:"84%",w85:"85%",w86:"86%",w87:"87%","w87-5":"87.5%",w88:"88%",w89:"89%",w90:"90%",w91:"91%",w92:"92%",w93:"93%",w94:"94%",w95:"95%",w96:"96%",w97:"97%",w98:"98%",w99:"99%",w100:"100%"},isElementDragged:!1,variationSection:!1,variationSectionIndex:!1,variationFieldIndex:!1,canTakeLogic:["product","color","range","radiobuttons","checkboxes","selectbox","textfield","textarea","variations"],addSortables:function(){i.tmEPOAdmin.is_original&&(i(".builder_layout").sortable({handle:".move",cursor:"move",items:".builder-wrapper:not(.tma-nomove)",start:function(e,t){var n;n=i(t.item).closest(".builder-wrapper").index(),i.tmEPOAdmin.builderSectionsSortableObj.start.section=n,t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.outerWidth())},stop:function(e,t){var n;n=i(t.item).closest(".builder-wrapper").index(),i.tmEPOAdmin.builderSectionsSortableObj.end.section=n,u.splice(n,0,u.splice(i.tmEPOAdmin.builderSectionsSortableObj.start.section,1)[0]),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.builderSectionsSortableObj={start:{},end:{}}},cancel:".tma-nomove",forcePlaceholderSize:!0,placeholder:"bitem pl2",tolerance:"pointer"}),i.tmEPOAdmin.builder_items_sortable(i(".builder-wrapper .bitem-wrapper")))},getBuilder:function(){return u},addEvents:function(){var n,a,o,l,r,s;1!==i.tmEPOAdmin.addEventsDone&&(i.tmEPOAdmin.addSortables(),n=i("#builder_import_file"),(a=new g.Uploader({url:h.import_url,browse_button:n[0],file_data_name:"builder_import_file",multi_selection:!1})).init(),a.bind("FilesAdded",function(e){var t,n=i.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:"",title:h.i18n_import_title});o=i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"300px",classname:"flasho tc-wrapper",data:n}),t=i('<div class="tc-progress-bar tc-notice"><span class="tc-percent"></span></div><div class="tc-progress-info"><span class="tc-progress-info-content"></span></div>'),i('<div class="override-selection"><button type="button" class="tc tc-button details-override">'+h.i18n_overwrite_existing_elements+'</button><button type="button" class="tc tc-button details-append">'+h.i18n_append_new_elements+"</button></div>").appendTo("#tc-floatbox-content"),l=i.tmEPOAdmin.tm_escape(E.stringify(i.tmEPOAdmin.prepareForJson(i.tmEPOAdmin.tcSerializeJsOptionsObject(u)))),h.is_original_post?(i(".details-override").on("click",function(){i("#tc-floatbox-content").find(".override-selection").remove(),t.appendTo("#tc-floatbox-content"),i(".tc-progress-info-content").html(h.i18n_importing),e.setOption("multipart_params",{action:"import",import_override:1,post_id:h.post_id,security:h.import_nonce,is_original_post:h.is_original_post}),e.start(),i(".flasho").addClass("tm_color_notice")}),i(".details-append").on("click",function(){i("#tc-floatbox-content").find(".override-selection").remove(),t.appendTo("#tc-floatbox-content"),i(".tc-progress-info-content").html(h.i18n_importing),e.setOption("multipart_params",{action:"import",import_override:0,post_id:h.post_id,tm_uploadmeta:l,security:h.import_nonce,is_original_post:h.is_original_post}),e.start(),i(".flasho").addClass("tm_color_notice")})):(i("#tc-floatbox-content").find(".override-selection").remove(),t.appendTo("#tc-floatbox-content"),i(".tc-progress-info-content").html(h.i18n_importing),e.setOption("multipart_params",{action:"import",import_override:1,post_id:h.post_id,tm_uploadmeta:l,security:h.import_nonce,is_original_post:h.is_original_post}),e.start(),i(".flasho").addClass("tm_color_notice"))}),a.bind("FileUploaded",function(t,n,a){var l=i.epoAPI.util.parseJSON(a.response);l&&void 0!==l.result&&l.message&&i(".tc-progress-info-content").html(l.message),l&&l.error&&l.message&&i(".tc-progress-info-content").html(l.message),l&&void 0!==l.result&&1===i.epoAPI.math.toFloat(l.result)?(i(".tc-progress-bar").removeClass("tc-notice").addClass("tm_success"),i(".tc-progress-info-content").removeClass("tm_color_error").addClass("tm_color_success"),i(".flasho").removeClass("tm_color_notice tm_color_error").addClass("tm_color_success"),i(".floatbox-cancel").remove(),i(".tc-progress-info-content").html(h.i18n_saving),i(e).off("beforeunload.edit-post"),l.options&&(Array.isArray(l.jsobject)?(i(".builder_layout").html(l.options),u=l.jsobject,i.tmEPOAdmin.setGlobalVariationObject("initialitize_on_after"),v.success(l.message,h.i18n_epo)):v.error(h.i18n_invalid_request,h.i18n_epo)),o.destroy()):(i(".tc-progress-bar").removeClass("tc-notice").addClass("tm_error"),i(".tc-progress-info-content").removeClass("tm_color_success").addClass("tm_color_error"),i(".flasho").removeClass("tm_color_notice tm_color_success").addClass("tm_color_error"))}),a.bind("UploadProgress",function(e,t){var n=parseInt(t.percent,10);i(".tc-progress-bar").css("width",n+"%"),i(".tc-percent").html(n+"%")}),a.bind("Error",function(e,t){t&&t.message&&i(".tc-progress-info-content").removeClass("tm_color_success").addClass("tm_color_error").html("\nError #"+t.code+": "+t.message),i(".tc-progress-bar").removeClass("tc-notice").addClass("tm_error"),i(".flasho").removeClass("tm_color_notice tm_color_success").addClass("tm_color_error")}),a.bind("UploadComplete",function(){i("body").removeClass("overflow")}),i(t).on("click.cpf","#builder_export",function(t){var n,a,o=i(this);t.preventDefault(),o.data("doing_export")||(o.data("doing_export",1).prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),n=i.tmEPOAdmin.prepareForJson(i.tmEPOAdmin.tcSerializeJsOptionsObject(u)),a={action:"tm_export",metaserialized:n=E.stringify(n),is_original_post:h.is_original_post,security:h.export_nonce},i.post(h.ajax_url,a,function(t){var n;t&&t.result&&""!==t.result?e.location=t.result:t&&t.error&&t.message&&(n=i.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+t.message+"</div>",title:h.i18n_error_title}),i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"300px",classname:"flasho tc-wrapper tm-error",data:n}))},"json").always(function(){o.data("doing_export",0).find(".tm-icon").remove()}))}),i(t).on("click.cpf","#builder_save",function(e){var t,n=i(this);n.data("doing_export")||(n.data("doing_export",1).prepend('<i class="tm-icon tcfa tcfa-spin tcfa-spinner"></i>'),t={action:"tm_save",tm_uploadmeta:i.tmEPOAdmin.tm_escape(E.stringify(i.tmEPOAdmin.prepareForJson(i.tmEPOAdmin.tcSerializeJsOptionsObject(u)))),post_id:h.post_id,security:h.save_nonce},i("#tmformfieldsbuilderwrap").addClass("disabled"),e.preventDefault(),i.post(h.ajax_url,t,function(e){e&&e.result&&1===e.result?v.success(e.message,h.i18n_epo):v.error(e.message,h.i18n_epo)},"json").always(function(e){i("#tmformfieldsbuilderwrap").removeClass("disabled"),"-1"===e.responseText&&v.error(h.i18n_invalid_request,h.i18n_epo),n.data("doing_export",0).find(".tm-icon").remove()}))}),i(t).on("click.cpf","#builder_import,.tc-add-import-csv",function(e){e.preventDefault(),i("#builder_import_file").trigger("click")}),i(t).on("click.cpf","#builder-fullsize",function(e){e.preventDefault(),i("body").addClass("overflow fullsize")}),i(t).on("click.cpf","#builder-fullsize-close",function(e){e.preventDefault(),i("body").removeClass("overflow fullsize")}),i(t).on("click.cpf",".builder-add-element",i.tmEPOAdmin.builder_add_element_onClick),i(t).on("click.cpf",".builder_add_section,.tc-add-section ",i.tmEPOAdmin.builder_add_section_onClick),i(t).on("click.cpf",".builder-add-section-and-element,.tc-add-element",i.tmEPOAdmin.builder_add_section_and_element_onClick),i(t).on("click.cpf",".builder_add_variation",i.tmEPOAdmin.builder_add_variation_onClick),i(t).on("click.cpf",".builder-wrapper .section-settings .edit",i.tmEPOAdmin.builder_section_item_onClick),i(t).on("click.cpf",".builder-wrapper .section-settings .clone",i.tmEPOAdmin.builder_section_clone_onClick),i(t).on("click.cpf",".builder-wrapper .section-settings .plus",i.tmEPOAdmin.builder_section_plus_onClick),i(t).on("click.cpf",".builder-wrapper .section-settings .minus",i.tmEPOAdmin.builder_section_minus_onClick),i(t).on("click.cpf",".builder-wrapper .btitle .delete:not(.builder-wrapper.tma-variations-wrap .btitle .delete)",i.tmEPOAdmin.builder_section_delete_onClick),i(t).on("click.cpf",".builder-wrapper .btitle .fold",i.tmEPOAdmin.builder_section_fold_onClick),i(t).on("click",".builder-wrapper.tma-variations-wrap .btitle .delete",i.tmEPOAdmin.builder_variation_delete_onClick),i(t).on("click.cpf",".bitem .bitem-settings .edit",i.tmEPOAdmin.builder_item_onClick),i(t).on("click.cpf",".bitem .bitem-settings .clone",i.tmEPOAdmin.builder_clone_onClick),i(t).on("click.cpf",".bitem .bitem-settings .plus",i.tmEPOAdmin.builder_plus_onClick),i(t).on("click.cpf",".bitem .bitem-settings .minus",i.tmEPOAdmin.builder_minus_onClick),i(t).on("click",".bitem .delete",i.tmEPOAdmin.builder_delete_onClick),i(t).on("click.cpf",".builder-panel-add",i.tmEPOAdmin.builder_panel_add_onClick),i(t).on("click.cpf",".builder-panel-mass-add",i.tmEPOAdmin.builder_panel_mass_add_onClick),i(t).on("click.cpf",".builder-panel-populate",i.tmEPOAdmin.builder_panel_populate_onClick),i(t).on("click.cpf",".builder-image-delete",i.tmEPOAdmin.builder_image_delete_onClick),i(t).on("click.cpf",".builder_panel_delete",i.tmEPOAdmin.builder_panel_delete_onClick),i(".builder_panel_delete").on("click.cpf",i.tmEPOAdmin.builder_panel_delete_onClick),i(t).on("click.cpf",".builder_panel_delete_all",i.tmEPOAdmin.builder_panel_delete_all_onClick),i(t).on("click.cpf",".builder_panel_up",function(){var e=i(this),t=e.closest(".options-wrap");t.prev().before(t),i.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),i.tmEPOAdmin.paginattion_init("current")}),i(t).on("click.cpf",".builder_panel_down",function(){var e=i(this),t=e.closest(".options-wrap");t.next().after(t),i.tmEPOAdmin.panelsReorder(e.closest(".panels_wrap")),i.tmEPOAdmin.paginattion_init("current")}),i(t).on("keyup.cpf change.cpf",".tm_option_title",function(){i(this).closest(".options-wrap").find(".tm_option_value").val(i("<div/>").html(i(this).val()).text())}),i(t).on("change.cpf changechoice",".tm_option_enabled",function(){var e=i(this);e.is(":checked")?e.closest(".options-wrap").removeClass("choice-is-disabled"):e.closest(".options-wrap").addClass("choice-is-disabled")}),i(t).on("click.cpf",".tc-element-setting-price, .tc-element-setting-sale-price, .tm_option_price, .tm_option_sale_price",function(){var e,t,n,a=i(this);"math"===(a.is(".tc-element-setting-price, .tc-element-setting-sale-price")?i(".tm-pricetype-selector"):a.closest(".options-wrap").find(".tm_option_price_type")).val()&&(n=a.val(),e=i.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content-pop",update:h.i18n_save,html:'<div class="tm-inner"><textarea class="tc-element-setting-edit-price"></textarea><div class="tc-price-variables"></div></div>',title:h.i18n_edit_price},"tc-floatbox-edit"),t=i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"50%",height:"80%",top:"10%",left:"25%",classname:"flasho tc-wrapper tc-builder-add-section-and-element",data:e,cancelClass:".floatbox-edit-cancel",unique:!0}),i.tmEPOAdmin.populatePriceVariables(i(".tc-price-variables")),i(".tc-element-setting-edit-price").val(n),i(".floatbox-edit-update").on("click.cpf",function(e){e.preventDefault(),a.val(i(".tc-element-setting-edit-price").val()),t.destroy()}),i(".tc-var-field").on("click.cpf",function(e){var t=i(".tc-element-setting-edit-price"),n=t.val(),a=t[0],o=a.selectionStart,l=a.scrollTop,d=n.substring(0,o),r=n.substring(a.selectionEnd,n.length),s=i(this).attr("data-value");e.preventDefault(),t.val(d+s+r),o+=s.length,a.selectionStart=o,a.selectionEnd=o,a.trigger(" focus"),a.scrollTop=l}),i(".formula-field-mode").on("change.cpf",function(){var e=i(this).val();i(".tc-var-list.other .tc-var-field").toArray().forEach(function(t){i(t).attr("data-value","{field."+i(t).attr("title")+"."+e+"}")})}))}),i(t).on("click.cpf",".tm_upload_button",i.tmEPOAdmin.upload),i(t).on("change.cpf",".use_images,.tm-use-lightbox,.use_colors",i.tmEPOAdmin.tm_upload),i(t).on("change.cpf",".use_url",i.tmEPOAdmin.tm_url),i(t).on("change.cpf",".tm-pricetype-selector",i.tmEPOAdmin.tm_pricetype_selector),i(t).on("change.cpf",".tm_option_price_type",i.tmEPOAdmin.tm_option_price_type),i(t).on("change.cpf",".variations-display-as",i.tmEPOAdmin.variations_display_as),i(t).on("change.cpf",".tm-attribute .tm-changes-product-image",i.tmEPOAdmin.variations_display_as),i(t).on("click.cpf",".tm-upload-button-remove",i.tmEPOAdmin.tm_upload_button_remove_onClick),i(t).on("change.cpf",".tm-weekday-picker",i.tmEPOAdmin.tm_weekday_picker),i(t).on("change.cpf",".tm-month-picker",i.tmEPOAdmin.tm_month_picker),i(t).on("click.cpf",".tm-tags-container .tab-header",function(){var e=i(this),t=e.closest(".tm-tags-container"),n=t.find(".tm-elements-container").find("li.tm-element-button"),a=t.find(".tab-header"),o=e.attr("data-tm-tag");a.removeClass("open").addClass("closed"),e.removeClass("closed").addClass("open"),"all"===o?n.removeClass("tm-hidden"):(n.addClass("tm-hidden"),n.filter("."+o).removeClass("tm-hidden"))}),i(t).on("click.cpf",".tm_editor_wrap",function(){var t=i(this).find("textarea");t.attr("id")&&(e.wpActiveEditor=t.attr("id"))}),i(t).on("change.cpf",".cpf-logic-element",i.tmEPOAdmin.cpf_logic_element_onchange),i(t).on("change.cpf",".cpf-logic-operator",i.tmEPOAdmin.cpf_logic_operator_onchange),i(t).on("change.cpf",".activate-sections-logic, .activate-element-logic",function(){i(this).is(":checked")?i(this).closest(".message0x0").find(".builder-logic-div").show():i(this).closest(".message0x0").find(".builder-logic-div").hide()}),i(t).on("dblclick.cpf",".tm-default-radio",function(){i(this).prop("checked",!1)}),s=function(e){if(13===e.keyCode)return e.preventDefault(),i.tmEPOAdmin.force_current_edit_label=!0,r(),!1},r=function(e){var n,a,o,l,d=i.tmEPOAdmin.current_edit_label;i.tmEPOAdmin.current_edit_label&&(!0!==i.tmEPOAdmin.force_current_edit_label&&(d.is(e.target)||0!==d.has(e.target).length||i(e.target).is(".tm-internal-name"))||((n=d.closest(".tm-label-desc").next(".tm-label-desc-edit").find(".tm-internal-name")).trigger("change"),d.is(".tm-internal-label")&&d.html(n.val()).removeClass("tm-hidden"),d.is(".tm-element-label")&&d.removeClass("tm-hidden").closest(".tm-label-desc").find(".tm-internal-label").html(n.val()),d.closest(".tm-label-desc").removeClass("tm-hidden").next(".tm-label-desc-edit").addClass("tm-hidden"),""===n.val()?(d.closest(".tm-label-desc").removeClass("tc-has-value").addClass("tc-empty-value"),d.closest(".tm-label-desc").find(".tm-internal-label").html(d.closest(".tm-label-desc").find(".tm-element-label").html()),n.val(d.closest(".tm-label-desc").find(".tm-element-label").html())):d.closest(".tm-label-desc").removeClass("tc-empty-value").addClass("tc-has-value"),a=n.closest(".builder-wrapper").index(),o=i.tmEPOAdmin.find_index(u[a].section.is_slider,n.closest(".bitem")),(l=n.closest(".tm-label-desc-edit")).is(".tm-for-bitem")?i.tmEPOAdmin.setFieldValue(a,o,"internal_name",n.val(),!0):l.is(".tm-for-section")&&(u[a].section.sections_internal_name.default=n.val()),n.remove(),i.tmEPOAdmin.current_edit_label=!1,i.tmEPOAdmin.force_current_edit_label=!1,i(t).off("mouseup",r),i(t).off("keydown",s)))},i(t).on("click",".tm-element-label,.tm-internal-label",function(){var e,n,a,o,l,d=i(this);i.tmEPOAdmin.current_edit_label=d,e=d.addClass("tm-hidden").closest(".tm-label-desc").addClass("tm-hidden").next(".tm-label-desc-edit").removeClass("tm-hidden"),o=d.closest(".builder-wrapper").index(),l=i.tmEPOAdmin.find_index(u[o].section.is_slider,d.closest(".bitem")),e.is(".tm-for-bitem")?(n=e.attr("data-element"),a=i.tmEPOAdmin.getFieldValue(u[o].fields[l],"internal_name",!0)):e.is(".tm-for-section")&&(n="sections",a=u[o].section.sections_internal_name.default),n=i("<input type='text' value='"+a+"' name='tm_meta[tmfbuilder]["+(n+="_internal_name")+"][]' class='t tm-internal-name'>"),e.append(n),n.trigger(" focus"),i(t).on("mouseup",r),i(t).on("keydown",s)}),i(t).on("click.cpf",".cpf-add-rule",i.tmEPOAdmin.cpf_add_rule),i(t).on("click.cpf",".cpf-delete-rule",i.tmEPOAdmin.cpf_delete_rule),i(t).on("click.cpf",".tma-handle-wrap .tma-handle",i.tmEPOAdmin.builder_fold_onClick),i(t).on("keyup change","#tc-floatbox-content .n[type=text]",function(){var e,t,n,a=i(this),o=a.val();return d&&o!==t&&(e=new RegExp("[^-0-9%.\\"+d.mon_decimal_point+"]+","gi"),t=o.replace(e,""),a.val(t),0===a.parent().find(".wc_error_tip").length&&(n=a.position(),a.after('<div class="wc_error_tip">'+d.i18n_mon_decimal_error+"</div>"),i(".wc_error_tip").css("left",n.left+a.width()-a.width()/2-i(".wc_error_tip").width()/2).css("top",n.top+a.height()).fadeIn("100"))),this}),i(t).on("click",".tc-enable-responsive",function(){var e=i(this),t=e.find(".on"),n=e.find(".off"),a=i("#tc-floatbox-content").find(".builder_responsive_div");e.is(".active")?(e.removeClass("active"),t.addClass("tm-hidden"),n.removeClass("tm-hidden"),a.hide()):(e.addClass("active"),t.removeClass("tm-hidden"),n.addClass("tm-hidden"),a.show())}),i(t).on("change.cpf",".product-mode",function(){var e=i("#tc-floatbox-content"),t=i(this).val(),n=i(".product-default-value-search"),a=i(".product-products-selector");"product"===t?(t="products",a.is(".enhanced")&&a.prop("multiple")&&(a.selectWoo("destroy").removeClass("enhanced"),a.prop("multiple",!1),i.tmEPOAdmin.create_products_search(e)),a.prop("multiple",!1)):"products"===t&&(a.is(".enhanced")&&!a.prop("multiple")&&(a.selectWoo("destroy").removeClass("enhanced"),a.prop("multiple",!0),i.tmEPOAdmin.create_products_search(e)),a.prop("multiple",!0)),n.is(".enhanced")&&(n.selectWoo("destroy").removeClass("enhanced"),"products"===t?(n.removeData("action"),n.addClass("enhanced-dropdown"),a.triggerHandler("change.cpf"),i.tmEPOAdmin.create_enhanced_dropdown(e)):(n.data("action","wc_epo_search_products_in_categories"),n.addClass("wc-product-search"),i.tmEPOAdmin.create_products_search(e))),i(".product-"+t+"-selector").trigger("change.cpf")}),i(t).on("change.cpf",".product-default-value-search",function(){var e,t,n=i(this),a=n.val(),o=i(".product-mode"),l={action:"wc_epo_get_product_categories",product_id:a,security:h.get_products_categories_nonce};a&&i.post(h.ajax_url,l,function(l){n.data("categoryIds","success"===l.result?l.category_ids:[]),n.data("categoryIds")&&("categories"===o.val()&&a!==n.attr("data-current-selected")?(e=i(".product-categories-selector").find(":selected").toArray().map(function(e){return parseInt(i(e).val(),10)}),t=!1,i.each(n.data("categoryIds"),function(n,a){if(-1!==i.inArray(parseInt(a,10),e))return t=!0,!1}),t?(n.attr("data-current-selected",a),n.data("current-selected-text",n.find(":selected").text())):(n.find("option").remove(),this.removeAttr("data-current-selected"),this.removeData("current-selected-text"),this.removeData("categoryIds"),this.removeData("include"))):(n.attr("data-current-selected",a),n.data("current-selected-text",n.find(":selected").text())))})}),i(t).on("change.cpf",".product-products-selector",function(){var e=i(this),t=i(".product-default-value-search"),n=e.find(":selected").clone().removeAttr("selected").removeAttr("data-select2-id");t.removeData("action"),t.find("option").remove(),t.append(n),t.val(t.attr("data-current-selected")).trigger("change.cpf")}),i(t).on("change.cpf",".product-categories-selector",function(){var e,t=i(this).find(":selected").toArray().map(function(e){return parseInt(i(e).val(),10)}),n=i(".product-default-value-search");n.data("include",t),n.data("action","wc_epo_search_products_in_categories"),n.data("categoryIds")&&(e=!1,i.each(n.data("categoryIds"),function(n,a){if(-1!==i.inArray(parseInt(a,10),t))return e=!0,!1}),e||(n.find("option").remove(),n.removeAttr("data-current-selected"),n.removeData("current-selected-text"),n.removeData("categoryIds")))}),i().ajaxChosen&&i("select.ajax_chosen_select_tmProductIds").ajaxChosen({method:"GET",url:h.ajax_url,dataType:"json",afterTypeDelay:100,data:{action:"woocommerce_json_search_products",security:h.search_products_nonce}},function(e){var t={};return i.each(e,function(e,i){t[e]=i}),t}),i("body").on("woocommerce-product-type-change",function(){var e,t=i("#product-type");i.tmEPOAdmin.initSectionsCheck(),t.length&&("variable"!==t.val()&&"variable-subscription"!==t.val()&&(e=i(".builder_layout .element-variations")).length&&(e.closest(".builder-wrapper").remove(),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.section_logic_init(),i.tmEPOAdmin.initSectionsCheck(),i.tmEPOAdmin.toggleVariationButton(),i.tmEPOAdmin.var_remove("tm-style-variation-added")),i.tmEPOAdmin.toggleVariationButton())}),i(t).on("click.cpf",".meta-disable-categories",function(){i.tmEPOAdmin.disableCategories()}),i(t).on("change.cpf",".product_page_tm-global-epo #product_catdiv input:checkbox, .product_page_tm-global-epo #tmProductIds, .product_page_tm-global-epo #tc-enabled-options, .product_page_tm-global-epo #tc-disabled-options",function(){i.tmEPOAdmin.checkIfApplied()}),i.tmEPOAdmin.addEventsDone=1)},initialitize:function(){i.tmEPOAdmin.setGlobalVariationObject("initialitize_on")},initialitize_on:function(){i.tmEPOAdmin.isinit=!0,i.tmEPOAdmin.pre_element_logic_init_obj={},i.tmEPOAdmin.pre_element_logic_init_obj_options={},i.tmEPOAdmin.pre_element_logic_init(!0),i.tmEPOAdmin.pre_element_logic_init_done=!0,i.tmEPOAdmin.is_original=h.is_original_post,i.tmEPOAdmin.current_edit_label=!1,i.tmEPOAdmin.force_current_edit_label=!1,i.tmEPOAdmin.toggleVariationButton(),i.tmEPOAdmin.addEvents(),i.tmEPOAdmin.check_section_logic(),i.tmEPOAdmin.check_element_logic(),i.tmEPOAdmin.sectionLogicStart(),i.tmEPOAdmin.elementLogicStart(),i(".builder-wrapper.tm-slider-wizard").each(function(){var e=i(this);i.tmEPOAdmin.createSlider(e)}),i("#taxonomy-product_cat").before(i("#tc-disabled-categories").removeClass("hidden")),i.tmEPOAdmin.disableCategories(),i("#product_catdiv").before(i('<div class="tc-info-box hidden"></div>')),i.tmEPOAdmin.checkIfApplied(),i.tmEPOAdmin.initSectionsCheck(),i.tmEPOAdmin.fixFormSubmit(),i.tmEPOAdmin.makeResizables(i(".builder-wrapper")),i.tmEPOAdmin.makeResizables(i(".bitem")),i.tmEPOAdmin.pre_element_logic_init_done=!1,i.tmEPOAdmin.isinit=!1,i(".builder_layout").removeClass("tm-hidden")},initialitize_on_after:function(){i.tmEPOAdmin.isinit=!0,i.tmEPOAdmin.pre_element_logic_init_obj={},i.tmEPOAdmin.pre_element_logic_init_obj_options={},i.tmEPOAdmin.pre_element_logic_init(!0),i.tmEPOAdmin.pre_element_logic_init_done=!0,i.tmEPOAdmin.is_original=h.is_original_post,i.tmEPOAdmin.current_edit_label=!1,i.tmEPOAdmin.force_current_edit_label=!1,i.tmEPOAdmin.var_remove("tm-style-variation-added"),i.tmEPOAdmin.toggleVariationButton(),i.tmEPOAdmin.addSortables(),i.tmEPOAdmin.check_section_logic(),i.tmEPOAdmin.check_element_logic(),i.tmEPOAdmin.sectionLogicStart(),i.tmEPOAdmin.elementLogicStart(),i(".builder-wrapper.tm-slider-wizard").each(function(){var e=i(this);i.tmEPOAdmin.createSlider(e)}),i.tmEPOAdmin.initSectionsCheck(),i.tmEPOAdmin.fixFormSubmit(),i.tmEPOAdmin.makeResizables(i(".builder-wrapper")),i.tmEPOAdmin.makeResizables(i(".bitem")),i.tmEPOAdmin.pre_element_logic_init_done=!1,i.tmEPOAdmin.isinit=!1},makeResizables:function(e){var t,n=Object.keys(i.tmEPOAdmin.builderSize),a=[];0!==(e=i(e)).length&&(n.forEach(function(e){a.push(parseFloat(i.tmEPOAdmin.builderSize[e].replace("%",""),10))}),e.not(".tma-nomove").toArray().forEach(function(e){var n;e=i(e),n=e.is(".bitem")?e.closest(".bitem-wrapper").first():e.closest(".builder_layout"),e.is(".ui-resizable")&&e.resizable().resizable("destroy"),e.resizable({maxWidth:n.width(),minWidth:n.width()/8,start:function(e,n){n.originalElement.addClass("tm-label-info-hidden"),t=parseFloat(i.tmEPOAdmin.builderSize[n.originalElement.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0]].replace("%",""),10)},stop:function(o,l){var d,r,s,c,m,p=100*l.size.width/n.width(),_=a.filter(function(e){return e<=p}),f=a.filter(function(e){return e>=p}),h=l.originalElement;h.removeClass("ui-highlight tm-label-info-hidden"),_=_[_.length-1],void 0===(f=f[0])&&(f=a[a.length-1]),void 0===_&&(_=t>=f?a[a.length-1]:a[1]),p-_>(f-_)/2?(r="w"+f.toString().replace(".","-"),h.css("width",f+"%")):(r="w"+_.toString().replace(".","-"),h.css("width",_+"%")),d=h.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],s=i.tmEPOAdmin.builderSize[r],r!==d&&(h.removeClass(String(d)),h.addClass(String(r)),e.is(".bitem")?h.find(".bitem-inner .size").text(s):h.find(".section-inner .size").text(s),c=h.closest(".builder-wrapper").index(),m=i.tmEPOAdmin.find_index(u[c].section.is_slider,h),e.is(".bitem")?i.tmEPOAdmin.setFieldValue(c,m,"div_size",r):(u[c].section.sections_size.default=r,u[c].size=s)),e.is(".builder-wrapper")&&i.tmEPOAdmin.makeResizables(e.find(".bitem"))},resize:function(e,i){var o,l=100*i.size.width/n.width(),d=a.filter(function(e){return e<=l}),r=a.filter(function(e){return e>=l}),s=i.originalElement;d=d[d.length-1],r=r[0],void 0===d&&(d=a[a.length-1]),void 0===r&&(r=a[0]),o=(r-d)/2,t>=r?r-o<l?s.removeClass("ui-highlight"):s.addClass("ui-highlight"):r-o>l?s.removeClass("ui-highlight"):s.addClass("ui-highlight"),i.size.height=i.originalSize.height}})}))},cpf_logic_element_onchange:function(e,t){var n,a,o,l,d,r,s,c,m=i(this);e instanceof i&&(m=e),void 0===t&&(t=!(t=i(this).closest(".section_elements, .builder-wrapper, .bitem, .builder-element-wrap")).is(".section_elements")&&!t.is(".builder-wrapper")),n=t?i.tmEPOAdmin.elementLogicObject:i.tmEPOAdmin.sectionLogicObject,a=m.val(),o=m.children("option:selected").attr("data-section"),l=m.children("option:selected").attr("data-type"),d=void 0!==(d=n)[o]&&(void 0!==(d=n[o].values)[a]&&n[o].values[a]),r=m.closest(".tm-logic-rule").find(".tm-logic-value"),c=(s=m.closest(".tm-logic-rule").find(".cpf-logic-operator")).val(),d?(d=i(d),r.empty().append(d),s.find("[value='is']").show(),s.find("[value='isnot']").show(),"variation"===l||"multiple"===l?("startswith"!==c&&"endswith"!==c&&"greaterthan"!==c&&"lessthan"!==c&&"greaterthanequal"!==c&&"lessthanequal"!==c||s.val("isempty"),s.find("[value='startswith']").hide(),s.find("[value='endswith']").hide(),s.find("[value='greaterthan']").hide(),s.find("[value='lessthan']").hide(),s.find("[value='greaterthanequal']").hide(),s.find("[value='lessthanequal']").hide(),s.trigger("change.cpf")):(s.find("[value='startswith']").show(),s.find("[value='endswith']").show(),s.find("[value='greaterthan']").show(),s.find("[value='lessthan']").show(),s.find("[value='greaterthanequal']").show(),s.find("[value='lessthanequal']").show())):a===o?("is"!==c&&"isnot"!==c&&"startswith"!==c&&"endswith"!==c&&"greaterthan"!==c&&"lessthan"!==c||s.val("isempty"),s.find("[value='is']").hide(),s.find("[value='isnot']").hide(),s.find("[value='startswith']").hide(),s.find("[value='endswith']").hide(),s.find("[value='greaterthan']").hide(),s.find("[value='lessthan']").hide(),s.find("[value='greaterthanequal']").hide(),s.find("[value='lessthanequal']").hide(),s.trigger("change.cpf")):(s.find("[value='is']").show(),s.find("[value='isnot']").show(),s.find("[value='startswith']").show(),s.find("[value='endswith']").show(),s.find("[value='greaterthan']").show(),s.find("[value='lessthan']").show(),s.find("[value='greaterthanequal']").show(),s.find("[value='lessthanequal']").show())},cpf_logic_operator_onchange:function(e){var t,n,a=i(this);e instanceof i&&(a=e),t=a.val(),n=a.closest(".tm-logic-rule").find(".tm-logic-value"),"isempty"===t||"isnotempty"===t?n.hide():n.show()},createSlider:function(e){e.tmtabs({headers:".tm-slider-wizard-headers",header:".tm-slider-wizard-header",selectedtab:0,showonhover:function(){return i.tmEPOAdmin.isElementDragged},useclasstohide:!0,afteraddtab:function(t,n){var a,o=e.index();i.tmEPOAdmin.builder_items_sortable(n),a=e.is(".tm-slider-wizard")?e.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(","):"",u[o].section.sections_slides.default=a},deletebutton:!0,deleteconfirm:!0,beforedeletetab:function(t,n){var a=e.index(),o=n.find(".bitem").length,l=i.tmEPOAdmin.find_index(!0,n.find(".bitem").first());u[a].fields.splice(l,o),u[a].section.sections.default=parseInt(u[a].section.sections.default,10)-o,u[a].section.sections.default=u[a].section.sections.default.toString()},afterdeletetab:function(){var t,n=e.index();t=e.is(".tm-slider-wizard")?e.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(","):"",u[n].section.sections_slides.default=t,i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.section_logic_init(),i.tmEPOAdmin.initSectionsCheck()},beforemovetab:function(e,t){i.tmEPOAdmin.sliderTabMoveBefore=[],t.find(".bitem").toArray().forEach(function(e){i.tmEPOAdmin.sliderTabMoveBefore.push({field_index:i.tmEPOAdmin.find_index(!0,i(e)),disabledFieldIndex:i.tmEPOAdmin.find_index(!0,i(e),".bitem",".element-is-disabled")})})},aftermovetab:function(t,n,a,o){var l=e.index(),d=a.find(".bitem").length,r=i.tmEPOAdmin.find_index(!0,a.find(".bitem").first());u[l].fields.splice.apply(u[l].fields,[r,0].concat(u[l].fields.splice(o,d))),u[l].section.sections_slides.default=i(".builder-wrapper").eq(l).find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(","),i.tmEPOAdmin.sliderTabMoveAfter=[],a.find(".bitem").toArray().forEach(function(e){i.tmEPOAdmin.sliderTabMoveAfter.push({field_index:i.tmEPOAdmin.find_index(!0,i(e)),disabledFieldIndex:i.tmEPOAdmin.find_index(!0,i(e),".bitem",".element-is-disabled")})}),i.tmEPOAdmin.sliderTabMoveAfter.forEach(function(e,t){i.tmEPOAdmin.builderItemsSortableObj.start.section=u[l].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.start.section_eq=l.toString(),i.tmEPOAdmin.builderItemsSortableObj.start.element=i.tmEPOAdmin.sliderTabMoveBefore[t].field_index.toString(),i.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=i.tmEPOAdmin.sliderTabMoveBefore[t].disabledFieldIndex,i.tmEPOAdmin.builderItemsSortableObj.end.section=u[l].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.end.section_eq=l.toString(),i.tmEPOAdmin.builderItemsSortableObj.end.element=e.field_index.toString(),i.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=e.disabledFieldIndex,i.tmEPOAdmin.logic_reindex()}),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.section_logic_init(),i.tmEPOAdmin.initSectionsCheck()}}),u[e.index()].section.is_slider=!0},sections_type_onChange:function(e){var t,n,a,o,l=u[e].section.sections_type.default,d=i(".builder-wrapper").eq(e);"slider"!==l||d.hasClass("tm-slider-wizard")?"slider"!==l&&d.hasClass("tm-slider-wizard")&&(d.find(".bitem-wrapper").wrapAll('<div class="tmtemp"></div>'),d.find(".bitem-wrapper .bitem").appendTo(d.find(".tmtemp")),d.find(".bitem-wrapper").remove(),d.find(".tmtemp").addClass("bitem-wrapper").removeClass("tmtemp"),i.tmEPOAdmin.builder_items_sortable(d.find(".bitem-wrapper")),d.find(".tm-slider-wizard-headers").remove(),d.removeClass("tm-slider-wizard"),u[e].section.sections_slides.default="",u[e].section.is_slider=!1):(t=d.find(".bitem-wrapper"),o=d.find(".btitle"),d.addClass("tm-slider-wizard"),n='<div class="tm-box"><h4 class="tm-slider-wizard-header" data-id="tm-slide0">1</h4></div>',a='<div class="tm-box tm-add-box"><h4 class="tm-add-tab"><span class="tcfa tcfa-plus"></span></h4></div>',o.after('<div class="transition tm-slider-wizard-headers">'+n+a+"</div>"),t.addClass("tm-slider-wizard-tab tm-slide0"),i.tmEPOAdmin.createSlider(d),u[e].section.sections_slides.default=d.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(","),u[e].section.is_slider=!0)},variationEventsSuccess:function(){setTimeout(function(){i.tmEPOAdmin.setGlobalVariationObject("reindex")},600),i(t).unbind("ajaxSuccess",i.tmEPOAdmin.variationEventsSuccess),i.tmEPOAdmin.var_remove("tma-remove_variation-added")},variationsCheckEventsSuccess:function(){setTimeout(function(){i.tmEPOAdmin.variationsCheckForChanges=1,i.tmEPOAdmin.tm_variations_check()},600),i(t).unbind("ajaxSuccess",i.tmEPOAdmin.variationsCheckEventsSuccess),i.tmEPOAdmin.var_remove("tma-remove_variation-added")},addVariationEvents:function(){!0!==i.tmEPOAdmin.var_is("tma-variation-events-added")&&(!0!==i.tmEPOAdmin.var_is("tma-remove_variation-added")&&i("#variable_product_options").on("click.tma",".remove_variation",function(){i(t).ajaxSuccess(i.tmEPOAdmin.variationEventsSuccess),i.tmEPOAdmin.var_is("tma-remove_variation-added",!0),i(t).ajaxSuccess(i.tmEPOAdmin.variationsCheckEventsSuccess)}),!0!==i.tmEPOAdmin.var_is("tma-remove_variation-added")&&i(".wc-metaboxes-wrapper").on("click","a.bulk_edit",function(){"delete_all"===i("select#field_to_edit").val()&&(i(t).ajaxSuccess(i.tmEPOAdmin.variationEventsSuccess),i.tmEPOAdmin.var_is("tma-remove_variation-added",!0),i(t).ajaxSuccess(i.tmEPOAdmin.variationsCheckEventsSuccess))}),i("#variable_product_options").on("woocommerce_variations_added",function(){i.tmEPOAdmin.setGlobalVariationObject("reindex"),i(t).ajaxSuccess(i.tmEPOAdmin.variationsCheckEventsSuccess)}),i("#woocommerce-product-data").on("woocommerce_variations_saved",function(){i.tmEPOAdmin.setGlobalVariationObject("reindex"),i(t).ajaxSuccess(i.tmEPOAdmin.variationsCheckEventsSuccess)}),i(t).on("click.cpf",".save_attributes",function(){i(t).ajaxSuccess(i.tmEPOAdmin.variationsCheckEventsSuccess)}),i.tmEPOAdmin.var_is("tma-variation-events-added",!0))},toggleVariationButton:function(){var e,t,n,a=i("#product-type");a.length&&("variable"===a.val()||"variable-subscription"===a.val()?(i(".builder_add_section").addClass("inline"),i(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),i(".tma-variations-wrap").removeClass("tm-hidden"),i.tmEPOAdmin.addVariationEvents(),t=!1,(e=i(".builder_layout .element-variations")).length?"1"===i.tmEPOAdmin.getFieldValue(i.tmEPOAdmin.variationSection,"variations_disabled")&&(t=!0,e=i(".builder_layout .element-variations"),i.tmEPOAdmin.var_is("tm-style-variation-forced",!0)):(i.tmEPOAdmin.var_is("tm-style-variation-forced",!0),i.tmEPOAdmin.builder_add_variation_onClick(),t=!0,e=i(".builder_layout .element-variations")),e.length&&((n=e.closest(".builder-wrapper")).find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),n.addClass("tma-nomove tma-variations-wrap"),i.tmEPOAdmin.var_is("tm-style-variation-added",!0),e.addClass("tma-nomove"),e.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.bitem-settings .minus,.tm-label-delete").remove(),t?(i.tmEPOAdmin.setFieldValue(i.tmEPOAdmin.variationSectionIndex,i.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),i(".builder_add_section").addClass("inline"),i(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),i(".tma-variations-wrap").addClass("tm-hidden")):(i.tmEPOAdmin.setFieldValue(i.tmEPOAdmin.variationSectionIndex,i.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),i(".builder_add_section").removeClass("inline"),i(".builder_add_variation").removeClass("inline").addClass("tm-hidden"),i(".tma-variations-wrap").removeClass("tm-hidden")),i.tmEPOAdmin.variationsCheckForChanges=1,i.tmEPOAdmin.tm_variations_check()),i(".tma-variations-wrap").length>1&&i(".tma-variations-wrap").not(":first").each(function(){var e,t;e=(t=i(this).closest(".builder-wrapper")).index(),t.remove(),u.splice(e,1),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.section_logic_init(),i.tmEPOAdmin.initSectionsCheck()})):(i(".builder_add_section").removeClass("inline"),i(".builder_add_variation").removeClass("inline").addClass("tm-hidden")))},tcSerializeJsOptionsArray:function(e){var t=[].concat.apply([],e.map(function(e){return Object.keys(e.section).map(function(t){return e&&"object"==typeof e.section[t]?e.section[t]:null}).filter(function(e){return null!==e&&void 0!==e})})),i=[].concat.apply([],e.map(function(e){return[].concat.apply([],e.fields.map(function(e){return[].concat.apply([],e.filter(function(e){return null!==e}).map(function(e){return e&&"multiple"===e.id?[].concat.apply([],e.multiple):e}))}))}));return e=[].concat.apply([],[t,i]),e=e.map(function(e){return e?void 0!==e.checked?!0===e.checked?{name:e.tags.name,value:e.default}:{name:e.tags.name,value:""}:{name:e.tags.name,value:e.default}:{}}).filter(function(e){return null!==e&&void 0!==e})},tcSerializeJsOptionsObject:function(e){var t={},n=i.tmEPOAdmin.tcSerializeJsOptionsArray(e);return i("#tm_meta_priority").length&&n.push({name:"tm_meta[priority]",value:i("#tm_meta_priority").val()}),i.each(n,function(){void 0!==t[this.name]?"[]"===this.name.slice(-2)?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):""===t[this.name]&&(t[this.name]=this.value||""):null!==this.value&&void 0!==this.value&&this.value.push?t[this.name]=[this.value]:t[this.name]=this.value||""}),t},prepareForJson:function(e){var t,n,a,o={};return Object.keys(e).forEach(function(l){0===l.indexOf("tm_meta[")&&((t=l.split(/[[\]]{1,2}/)).pop(),t=t.map(function(e){return""===e?null:e}),a=t.length>0&&null===t[t.length-1],t=t.filter(function(e){return null!==e&&void 0!==e?e:null}),n="object"!=typeof e[l]&&a?[e[l]]:e[l],o=i.tmEPOAdmin.constructObject(t,n,o))}),o},constructObject:function(e,t,n){var a=e.shift();return e.length>0?(Object.prototype.hasOwnProperty.call(n,a)||(n[a]={}),n[a]=i.tmEPOAdmin.constructObject(e,t,n[a])):n[a]=t,n},createTmMetaSerialized:function(){var e,t,n,a=i("input#wp-preview"),o=i("#tmformfieldsbuilderwrap");i(".tm_meta_serialized").remove(),i(".tm_meta_serialized_wpml").remove(),t=i.tmEPOAdmin.is_original?"tm_meta_serialized":"tm_meta_serialized_wpml",e=i.tmEPOAdmin.tm_escape(E.stringify(i.tmEPOAdmin.prepareForJson(i.tmEPOAdmin.tcSerializeJsOptionsObject(u)))),n=i("<textarea class='tm_meta_serialized tm-hidden' name='"+t+"'></textarea>").val(e),o.prepend(n),a.length>0&&""!==a.val()&&i(".tm_meta_serialized").remove()},fixFormSubmit:function(){var e,t,n=i("#post");1===n.length?n.on("submit",function(){return i.tmEPOAdmin.createTmMetaSerialized(),!0}):_.data&&void 0!==_.data.subscribe&&(e=!1,"function"==typeof(t=_.data.subscribe)&&t(function(){var t=_.data.select("core/editor").isSavingPost(),n=_.data.select("core/editor").didPostSaveRequestSucceed(),a=_.data.select("core/editor").didPostSaveRequestFail();!e&&t&&(e=!0,i.tmEPOAdmin.createTmMetaSerialized()),e&&(n||a)&&(e=!1,setTimeout(function(){i(".tm_meta_serialized").remove(),i(".tm_meta_serialized_wpml").remove()},600))}))},initSectionsCheck:function(){var e=i(".builder-wrapper").length;1===e&&i(".builder-wrapper.tma-variations-wrap.tm-hidden").length&&(e=0),e?(i(".builder-add-section-action").show(),i(".builder-selector").show(),i(".tc-welcome").hide(),i(".builder_layout").show()):(i(".builder-add-section-action").hide(),i(".builder-selector").hide(),i(".tc-welcome").show(),i(".builder_layout").hide())},disableCategories:function(){i(".meta-disable-categories").is(":checked")?i("#taxonomy-product_cat").slideUp():i("#taxonomy-product_cat").slideDown()},checkIfApplied:function(){var e,t,n,a,o;i("body").is(".product_page_tm-global-epo")&&(e=i("#tm_meta_disableCategories:checked").length>0,t=i("#product_catdiv input:checkbox").not(i("#tm_meta_disableCategories")).filter(":checked").length>0,n=i("#tmProductIds").val(),a=i("#tc-enabled-options").val(),o=i("#tc-disabled-options").val(),n=!(!n||null===n)&&n.length>0,a=!(!a||null===a)&&a.length>0,o=!(!o||null===o)&&o.length>0,e?n||a||o?i(".tc-info-box").removeClass("tc-error tc-all-products").addClass("hidden").html(""):i(".tc-info-box").removeClass("hidden tc-all-products").addClass("tc-error").html(h.i18n_form_not_applied_to_all):t?i(".tc-info-box").removeClass("tc-error tc-all-products").addClass("hidden").html(""):i(".tc-info-box").removeClass("hidden error").addClass("tc-all-products").html(h.i18n_form_is_applied_to_all))},check_section_logic:function(e){var t;(Number.isFinite(e)||e instanceof i||!i.tmEPOAdmin.isinit||!i.tmEPOAdmin.done_check_section_logic)&&(e instanceof i&&(e=parseInt(e.index(),10)),void 0===e?t=u:(t=[],e=i.epoAPI.math.toFloat(e),t[e]=u[e]),Object.keys(t).forEach(function(e){var i,n=t[e];void 0!==n.section&&((i=n.section.sections_uniqid.default)&&""!==i&&void 0!==i&&!1!==i||(u[e].section.sections_uniqid.default=a("",!0)))}),i.tmEPOAdmin.done_check_section_logic=!0)},check_element_logic:function(e,t){var n,o,l,d,r=[],s=!1;(Number.isFinite(e)||e instanceof i||!i.tmEPOAdmin.isinit||!i.tmEPOAdmin.done_check_section_logic)&&(e instanceof i&&(t=e.closest(".builder-wrapper").index(),e=i.tmEPOAdmin.find_index(u[t].section.is_slider,e)),void 0===t&&void 0!==e||(void 0===e?(n=u,s=!0):(n=[],t=i.epoAPI.math.toFloat(t),e=i.epoAPI.math.toFloat(e),n[t]=i.extend(!0,{},u[t]),l=n[t].fields[e],n[t].fields=[],n[t].fields[e]=l),Object.keys(n).forEach(function(e){o=n[e].fields,Object.keys(o).forEach(function(t){var n;l=o[t],d=i.tmEPOAdmin.getFieldValue(l,"element_type"),n=i.tmEPOAdmin.getFieldValue(l,"uniqid",d),(s&&-1!==r.indexOf(n)||!n||""===n||void 0===n||!1===n)&&i.tmEPOAdmin.setFieldValue(e,t,"uniqid",a("",!0),d),s&&r.push(i.tmEPOAdmin.getFieldValue(u[e].fields[t],"uniqid",d))})}),i.tmEPOAdmin.done_check_section_logic=!0))},sectionLogicStart:function(e){var t,n;void 0===e?t=u:(t=[],e=i.epoAPI.math.toFloat(e),t[e]=i.extend(!0,{},u[e])),Object.keys(t).forEach(function(e){i.tmEPOAdmin.section_logic_init(e);try{n=t[e].section.sections_clogic.default||"null",n=i.epoAPI.util.parseJSON(n),n=i.tmEPOAdmin.logic_check_section_rules(n),u[e].section.sections_clogic.default=E.stringify(n),u[e].section.rules_toggle=n.toggle,u[e].section.rules_what=n.what}catch(e){}})},elementLogicStart:function(e,t){var n,a,o,l,d,r;void 0===e?o=u:(o=[],t=i.epoAPI.math.toFloat(t),e=i.epoAPI.math.toFloat(e),o[t]=i.extend(!0,{},u[t]),d=o[t].fields[e],o[t].fields=[],o[t].fields[e]=d),Object.keys(o).forEach(function(e){void 0!==(l=o[e].fields)&&Object.keys(l).forEach(function(t){d=l[t],i.tmEPOAdmin.element_logic_init(t,e);try{r=i.tmEPOAdmin.getFieldValue(d,"element_type"),a=i.tmEPOAdmin.getFieldValue(d,"logic",r)||"null",n=i.tmEPOAdmin.getFieldValue(d,"clogic",r)||"null",n=i.epoAPI.util.parseJSON(n),a&&"null"!==a&&(n=i.tmEPOAdmin.logic_check_element_rules(n,e,t)),i.tmEPOAdmin.setFieldValue(e,t,"clogic",E.stringify(n),r)}catch(e){}})})},panelsReorder:function(e){i(e).children(".options-wrap").each(function(e,t){i(t).find(".tm-default-radio,.tm-default-checkbox").val(e)})},panelsSortable:function(e){0!==i(e).length&&i.tmEPOAdmin.is_original&&e.sortable({handle:".move",cancel:"input,select,button:not(.move)",cursor:"move",tolerance:"pointer",forcePlaceholderSize:!0,placeholder:"panel_wrap pl",stop:function(e,t){i.tmEPOAdmin.panelsReorder(i(t.item).closest(".panels_wrap"))}})},builder_panel_delete_all_onClick:function(e){var t,n=i(this).closest(".onerow").find(".tcpagination"),a=i(".flasho.tc-wrapper").find(".panels_wrap");e.preventDefault(),i(this).trigger("hideTtooltip"),n.tcPagination("destroy"),a.children().length>1&&((t=a.find(".options-wrap")).each(function(e){if(0===e)return!0;i(this).remove(),a.find(".numorder").each(function(e){i(this).html(parseInt(e,10)+1)})}),t.find("input").val(""),i.tmEPOAdmin.panelsReorder(a))},builder_image_delete_onClick:function(e){var t=i(this);e.preventDefault(),t.trigger("hideTtooltip"),t.closest(".tm_cell_images").find("input."+t.attr("rel")).val(""),t.closest("span").find("img").attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")},builder_panel_delete_onClick:function(e){var t=i(this).closest(".panels_wrap");e.preventDefault(),i(this).trigger("hideTtooltip"),t.children().length>1&&i(this).closest(".options-wrap").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){i(this).remove(),t.find(".numorder").each(function(e){i(this).html(parseInt(e,10)+1)}),t.children(".options-wrap").each(function(e){i(this).find("[id]").each(function(){var t=i(this).attr("name").replace(/[[\]]/g,"");i(this).attr("id",t+"_"+e)})}),i.tmEPOAdmin.panelsReorder(t)})},builder_panel_mass_add_onClick:function(e){var t,n=i(this);e.preventDefault(),n.is(".disabled")||(n.addClass("disabled"),t='<div class="tm-panel-populate-wrapper"><textarea class="tm-panel-populate"></textarea><button type="button" class="tc tc-button builder-panel-populate">'+h.i18n_populate+"</button></div>",n.after(t))},builder_panel_populate_onClick:function(e){var t=i(".flasho.tc-wrapper").find(".panels_wrap"),n=t.children(),a=i(""),o=i(".tm-panel-populate").val().split(/\n/),l=[];e.preventDefault(),i(this).remove(),o.forEach(function(e){/\S/.test(e)&&l.push(i.epoAPI.util.trim(e))}),l.forEach(function(e){var o,l=e.split("|"),d=l.length;0!==d&&(1===d&&(l[1]=0),l[0]=i.epoAPI.util.trim(l[0]),l[1]=parseFloat(i.epoAPI.util.trim(l[1])),Number.isFinite(l[1])||(l[1]=""),o=i.tmEPOAdmin.add_panel_row(l,t,n),a=a.add(o))}),a.length&&(t.append(a),a.find(".tm_option_enabled").prop("checked",!0).val("1").trigger("changechoice"),i.tcToolTip(a.find(".tm-tooltip"))),i(".builder-panel-mass-add").removeClass("disabled"),i(".tm-panel-populate-wrapper").remove(),i.tmEPOAdmin.paginattion_init("last"),i.tmEPOAdmin.tm_upload()},add_panel_row:function(e,t,n){var a=n.last().tcClone();return a?(i.tmEPOAdmin.builder_clone_elements_after_events(a),a.find("[name]").val(""),a.find(".tm_option_title").val(e[0]),a.find(".tm_option_value").val(i("<div/>").html(e[0]).text()),a.find(".tm_option_price").val(e[1]),e[2]&&(a.find(".tm_option_price_type").val(e[2]),!1===a.find(".tm_option_price_type").val()&&a.find(".tm_option_price_type").val("")),e[3]&&(a.find(".tm_option_description").val(e[3]),!1===a.find(".tm_option_description").val()&&a.find(".tm_option_description").val("")),a.find(".tm_upload_image img").attr("src",""),a.find("input.tm_option_image").val(""),a.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(n.length),a):i("")},builder_panel_add_onClick:function(e){var t=i(this).prev(".panels_wrap"),n=t.children(),a=n.last().tcClone();e.preventDefault(),a&&(a.find("[name]").val(""),a.find(".tm_upload_image img").attr("src",""),a.find("input.tm_option_image").val(""),a.find(".tm-default-radio,.tm-default-checkbox").prop("checked",!1).val(n.length),i.tmEPOAdmin.builder_clone_elements_after_events(a),t.append(a),a.find(".tm_option_enabled").prop("checked",!0).val("1").trigger("changechoice"),i.tcToolTip(a.find(".tm-tooltip")),i.tmEPOAdmin.paginattion_init("last"),i.tmEPOAdmin.tm_upload())},builder_add_section_onClick:function(t,n,o){var l,d,r,s,c=i.epoAPI.template.html(A.tc_builder_section,{});return t&&t.preventDefault(),!(!c||!(l=i(c)))&&(l.addClass("w100"),l.find(".tm-builder-sections-uniqid").val(a("",!0)),d=i.tmEPOAdmin.getFieldObject(l),s={},Object.keys(d).forEach(function(e){s[d[e].id]=d[e]}),r={fields:[],section:s,size:i.tmEPOAdmin.builderSize[s.sections_size.default],sections_internal_name:s.sections_internal_name.default},l.find(".section_elements").empty(),l.find(".tm-internal-name").remove(),n?(l.appendTo(".builder_layout"),u.push(r)):i(".builder_layout .tma-variations-wrap").length>0?(i(".builder_layout .tma-variations-wrap").after(l),u.splice(1,0,r)):(l.prependTo(".builder_layout"),u.unshift(r)),i.tmEPOAdmin.check_section_logic(l),i.tmEPOAdmin.section_logic_init(l),o||(i.tmEPOAdmin.builder_items_sortable(l.find(".bitem-wrapper")),i.tmEPOAdmin.builder_reorder_multiple(),i(this).is("a")&&i(e).tcScrollTo(l)),i.tmEPOAdmin.initSectionsCheck(),i.tmEPOAdmin.makeResizables(l),l)},builder_add_element_onClick:function(e){var t=i(this),n=i.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+h.element_data+"</div>",title:h.i18n_add_element}),a=i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"70%",height:"70%",top:"15%",left:"15%",classname:"flasho tc-wrapper tc-builder-add-element",data:n});e&&e.preventDefault(),i(".tc-builder-add-element .tc-element-button").on("click.cpf",function(e){var n=t.closest(".builder-wrapper"),o=i(this).attr("data-element");e.preventDefault(),t.is(".tc-prepend")?i.tmEPOAdmin.builder_clone_element(o,n,"prepend"):i.tmEPOAdmin.builder_clone_element(o,n),i.tmEPOAdmin.logic_reindex(),a.destroy()})},builder_add_section_and_element_onClick:function(e){var t=i.tmEPOAdmin.builder_floatbox_template_import({id:"tc-floatbox-content",html:'<div class="tm-inner">'+h.element_data+"</div>",title:h.i18n_add_element}),n=i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!1,refresh:"fixed",width:"70%",height:"70%",top:"15%",left:"15%",classname:"flasho tc-wrapper tc-builder-add-section-and-element",data:t});e&&e.preventDefault(),i(".tc-builder-add-section-and-element .tc-element-button").on("click.cpf",function(e){var t,a=i.tmEPOAdmin.builder_add_section_onClick(!1,!0);e.preventDefault(),a&&(t=i(this).attr("data-element"),i.tmEPOAdmin.builder_clone_element(t,a),i.tmEPOAdmin.logic_reindex(),n.destroy())})},tm_variations_check:function(){var e,t;i(".builder_layout .element-variations").length&&1===i.tmEPOAdmin.variationsCheckForChanges&&f&&(i("#tc-admin-extra-product-options").block({message:null}),e={action:"woocommerce_tm_variations_check",post_id:f.post_id,security:f.check_attributes_nonce},i.post(f.ajax_url,e,function(e){u[0].variations_html=e.html,i(".tma-variations-wrap .tm-all-attributes").html(e.html),e.jsobject&&(u[0].jsobject=e.jsobject,u[0].fields[0].find(function(e,i){return"multiple"===e.id&&(t=i),"multiple"===e.id}),void 0!==t?u[0].fields[0][t]=e.jsobject:u[0].fields[0].push(e.jsobject)),i("#tc-admin-extra-product-options").unblock(),i("#tc-admin-extra-product-options").trigger("woocommerce_tm_variations_check_loaded"),i.tmEPOAdmin.variationsCheckForChanges=0,i.tmEPOAdmin.builder_reorder_multiple()},"json"))},builder_variation_delete_onClick:function(){i.tmEPOAdmin.var_is("tm-style-variation-forced",!0),i(".builder_add_section").addClass("inline"),i(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),i(".tma-variations-wrap").length>1&&i(".tma-variations-wrap").not(":first").each(function(){var e,t;e=(t=i(this).closest(".builder-wrapper")).index(),t.remove(),u.splice(e,1),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.section_logic_init(),i.tmEPOAdmin.initSectionsCheck()}),i(".tma-variations-wrap").addClass("tm-hidden"),i.tmEPOAdmin.setFieldValue(i.tmEPOAdmin.variationSectionIndex,i.tmEPOAdmin.variationFieldIndex,"variations_disabled","1"),i.tmEPOAdmin.initSectionsCheck()},builder_add_variation_onClick:function(e){var t,n;e&&e.preventDefault(),!0!==i.tmEPOAdmin.var_is("tm-style-variation-added")?(t=i.tmEPOAdmin.builder_add_section_onClick(!1,!1,!0))&&(t.find(".tm-add-element-action,.tmicon.clone,.tmicon.size,.tmicon.move,.tmicon.plus,.tmicon.minus").remove(),t.addClass("tma-nomove tma-variations-wrap"),i.tmEPOAdmin.var_is("tm-style-variation-added",!0),n=i.tmEPOAdmin.builder_clone_element("variations",i(".builder_layout").find(".builder-wrapper").first()),i.tmEPOAdmin.setVariationSection(),!0===i.tmEPOAdmin.var_is("tm-style-variation-forced")?(i(".builder_add_section").addClass("inline"),i(".builder_add_variation").addClass("inline").removeClass("tm-hidden"),i(".tma-variations-wrap").addClass("tm-hidden"),i.tmEPOAdmin.setFieldValue(i.tmEPOAdmin.variationSectionIndex,i.tmEPOAdmin.variationFieldIndex,"variations_disabled","1")):(i(".builder_add_variation").addClass("tm-hidden"),i(".builder_add_section").removeClass("inline"),i(".tma-variations-wrap").removeClass("tm-hidden"),i.tmEPOAdmin.var_is("tm-style-variation-forced",!1),i.tmEPOAdmin.setFieldValue(i.tmEPOAdmin.variationSectionIndex,i.tmEPOAdmin.variationFieldIndex,"variations_disabled","")),n.find(".bitem-settings .size,.bitem-settings .clone,.tm-label-move,.bitem-settings .plus,.bitem-settings .minus,.tm-label-delete").remove(),n.addClass("tma-nomove"),n.find(".builder-remove-for-variations").remove(),n.find(".builder_hide_for_variation").hide(),i.tmEPOAdmin.pre_element_logic_init_set(),i.tmEPOAdmin.logic_reindex_force(),i.tmEPOAdmin.variationsCheckForChanges=1,i.tmEPOAdmin.tm_variations_check()):!0===i.tmEPOAdmin.var_is("tm-style-variation-forced")&&(i.tmEPOAdmin.var_is("tm-style-variation-forced",!1),i(".builder_add_variation").addClass("tm-hidden"),i(".builder_add_section").removeClass("inline"),i(".tma-variations-wrap").removeClass("tm-hidden"),i.tmEPOAdmin.setFieldValue(i.tmEPOAdmin.variationSectionIndex,i.tmEPOAdmin.variationFieldIndex,"variations_disabled",""),i.tmEPOAdmin.initSectionsCheck())},var_is:function(e,t){if(!t)return i("body").data(e);i("body").data(e,t)},var_remove:function(e){e&&i("body").removeData(e)},tm_escape:function(e){return encodeURIComponent(e)},tm_unescape:function(e){return decodeURIComponent(e)},get_element_logic_init:function(e){return i.tmEPOAdmin.pre_element_logic_init_done||i.tmEPOAdmin.pre_element_logic_init(e),i.tmEPOAdmin.isinit?i.tmEPOAdmin.pre_element_logic_init_done=!0:i.tmEPOAdmin.pre_element_logic_init_done=!1,i.tmEPOAdmin.pre_element_logic_init_obj},get_element_logic_options_init:function(e){return i.tmEPOAdmin.pre_element_logic_init_done||i.tmEPOAdmin.pre_element_logic_init(e),i.tmEPOAdmin.isinit?i.tmEPOAdmin.pre_element_logic_init_done=!0:i.tmEPOAdmin.pre_element_logic_init_done=!1,i.tmEPOAdmin.pre_element_logic_init_obj_options},find_index:function(e,t,i,n){var a,o=0;return e&&(o=t.closest(".bitem-wrapper").prevAll(".bitem-wrapper").find(".bitem").length),i&&n?(a=t.parent().find(i).not(n),parseInt(o,10)+parseInt(a.index(t),10)):parseInt(o,10)+parseInt(t.index(),10)},setGlobalVariationObject:function(t,n){var a,o;f?(i("#tc-admin-extra-product-options").block({message:null}),a={action:"woocommerce_tm_get_variations_array",post_id:f.post_id,security:f.check_attributes_nonce},o=e.ajaxurl||f.ajax_url,i.post(o,a,function(e){e&&(O=e,!0===t?i.tmEPOAdmin.pre_element_logic_init_set(n):"reindex"===t?i.tmEPOAdmin.logic_reindex_force():"initialitize_on"===t?i.tmEPOAdmin.initialitize_on():"initialitize_on_after"===t&&i.tmEPOAdmin.initialitize_on_after())},"json").always(function(){i("#tc-admin-extra-product-options").unblock()})):"initialitize_on"===t?(O||(O={}),i.tmEPOAdmin.initialitize_on()):"initialitize_on_after"===t&&(O||(O={}),i.tmEPOAdmin.initialitize_on_after())},pre_element_logic_init:function(e){O?i.tmEPOAdmin.pre_element_logic_init_set(e):i.tmEPOAdmin.setGlobalVariationObject(!0,e)},getFieldValue:function(e,t,n){var a;if(n&&!0!==n?t=n+"_"+t:!0===n&&(n=i.tmEPOAdmin.getFieldValue(e,"element_type"))&&(t=n+"_"+t),void 0!==(a=e.find(function(e){return e.id===t}))&&"object"==typeof a)return a.default},getFieldMultiple:function(e,t,n){var a,o,l;if(t="options_"+t,n&&!0!==n?t=n+"_"+t:!0===n&&(n=i.tmEPOAdmin.getFieldValue(e,"element_type"))&&(t=n+"_"+t),t="multiple_"+t,e.find(function(e,t){return"multiple"===e.id&&(a=t),"multiple"===e.id}),void 0!==a&&(o=e[a].multiple,(l=o.map(function(e){return e.find(function(e){return e.id===t})}).filter(function(e){return null!==e&&void 0!==e}))&&"object"==typeof l))return l},setFieldValue:function(e,t,n,a,o){var l;o&&!0!==o?n=o+"_"+n:!0===o&&(o=i.tmEPOAdmin.getFieldValue(u[e].fields[t],"element_type"))&&(n=o+"_"+n),u[e].fields[t].find(function(e,t){return e.id===n&&(l=t),e.id===n}),void 0!==l&&(u[e].fields[t][l].default=a)},setFieldValueMultiple:function(e,t,n,a,o){var l,d,r;n.toString.isNumeric()?r=n:(n="options_"+n,o&&!0!==o?n=o+"_"+n:!0===o&&(o=i.tmEPOAdmin.getFieldValue(u[e].fields[t],"element_type"))&&(n=o+"_"+n),n="multiple_"+n),u[e].fields[t].find(function(e,t){return"multiple"===e.id&&(l=t),"multiple"===e.id}),void 0!==l&&(d=u[e].fields[t][l].multiple,void 0===r?d.find(function(e,t){return e.id===n&&(r=t),e.id===n}):u[e].fields[t][l].multiple[r].default=a)},setVariationSection:function(){u.find(function(e,t){var n,a;return void 0!==e&&void 0!==e.fields&&(a=e.fields.find(function(e,t){var i;return void 0!==(i=e.find(function(e){return"element_type"===e.id&&"variations"===e.default}))&&(n=t),i})),void 0!==a&&(i.tmEPOAdmin.variationSectionIndex=t,i.tmEPOAdmin.variationFieldIndex=n,i.tmEPOAdmin.variationSection=u[i.tmEPOAdmin.variationSectionIndex].fields[i.tmEPOAdmin.variationFieldIndex],u[i.tmEPOAdmin.variationSectionIndex].section.tma_variations_wrap=!0),void 0!==a})},pre_element_logic_init_set:function(e){var t,n,o,l,d,r,s,c,m,p,_,f,h,v,b,g,A,E,P,w,x,y,k,C;O&&(i.tmEPOAdmin.pre_element_logic_init_obj={},i.tmEPOAdmin.pre_element_logic_init_obj_options={},t={},n={},o=[],i.tmEPOAdmin.setVariationSection(),Object.keys(u).forEach(function(S){void 0!==(y=u[S].section)&&(l=y.sections_uniqid.default,-1!==o.indexOf(l)&&(u[S].section.sections_uniqid.default=a("",!0),l=u[S].section.sections_uniqid.default),o.push(l),t[l]=[],e&&i.tmEPOAdmin.check_section_logic(S),w=y.sections_internal_name.default||"Section",y.tma_variations_wrap||(t[l][0]='<option data-type="section" data-section="'+l+'" value="'+l+'">'+w+" ("+l+")</option>"),d=u[S].fields.filter(function(e){var t=i.tmEPOAdmin.getFieldValue(e,"element_type");return"variations"===t||-1!==i.inArray(t,i.tmEPOAdmin.canTakeLogic)&&"1"===i.tmEPOAdmin.getFieldValue(e,"enabled",t)}),r=u[S].fields.filter(function(e){var t=i.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===i.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===i.tmEPOAdmin.getFieldValue(e,"enabled",t)}),s=[],c=[],Object.keys(d).forEach(function(e){if(k=d[e],x=i.tmEPOAdmin.getFieldValue(k,"element_type"),m=i.tmEPOAdmin.getFieldValue(k,"header_title",x),C=i.tmEPOAdmin.getFieldValue(k,"uniqid",x),p=r.findIndex(function(e){var t=i.tmEPOAdmin.getFieldValue(e,"element_type");return C===i.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&("variations"===t||-1!==i.inArray(t,i.tmEPOAdmin.canTakeLogic)&&"1"===i.tmEPOAdmin.getFieldValue(e,"enabled",!0))}),_=i.tmEPOAdmin.getFieldValue(k,"enabled",x),f="1"===i.tmEPOAdmin.getFieldValue(k,"enabled",x),_&&!f)return!0;void 0!==m&&(void 0!==(h=m)&&0!==h.length||(h=""),(v=i.tmEPOAdmin.getFieldValue(k,"internal_name",x))!==h&&(h=h+" ("+v+")"),b="variations"===x?"variation":-1!==i.inArray(x,["radiobuttons","checkboxes","product","selectbox"])?"multiple":"text",t[l][p+1]='<option data-type="'+b+'" data-section="'+l+'" value="'+p+'">'+h+"</option>","variations"===x?(c=[],i(O.variations).each(function(e,t){g=[],i(t.attributes).each(function(e,t){var n=i.map(t,function(e){return e});i(n).each(function(e,t){g.push(t)})}),g=g.join(" - "),A=g;try{A=i.tmEPOAdmin.tm_unescape(g)}catch(e){A=g}c.push('<option value="'+i.tmEPOAdmin.tm_escape(t.variation_id)+'">'+A+"</option>")}),s[p]='<select data-element="'+p+'" data-section="'+l+'" class="cpf-logic-value">'+c.join("")+"</select>"):-1!==i.inArray(x,["radiobuttons","checkboxes","selectbox"])?(E=i.tmEPOAdmin.getFieldMultiple(k,"title",x),P=i.tmEPOAdmin.getFieldMultiple(k,"value",x),c=[],Object.keys(E).forEach(function(e){c.push('<option value="'+i.tmEPOAdmin.tm_escape(P[e].default)+'">'+E[e].default+"</option>")}),s[p]='<select data-element="'+p+'" data-section="'+l+'" class="cpf-logic-value">'+c.join("")+"</select>"):s[p]='<input data-element="'+p+'" data-section="'+l+'" class="cpf-logic-value" type="text" value="">')}),n[l]={values:s})}),i.tmEPOAdmin.pre_element_logic_init_obj=n,i.tmEPOAdmin.pre_element_logic_init_obj_options=t)},element_logic_init:function(e,t,n){var a,o,l,d,r,s,c=[];e instanceof i&&(t=e.closest(".builder-wrapper").index(),e=i.tmEPOAdmin.find_index(u[t].section.is_slider,e)),t=i.epoAPI.math.toFloat(t),r=i.epoAPI.math.toFloat(e),s=i.tmEPOAdmin.getFieldValue(u[t].fields[r],"uniqid",!0),a=u[t].fields.filter(function(e){var t=i.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===i.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===i.tmEPOAdmin.getFieldValue(e,"enabled",t)}).findIndex(function(e){var t=i.tmEPOAdmin.getFieldValue(e,"element_type");return s===i.tmEPOAdmin.getFieldValue(e,"uniqid",t)&&-1!==i.inArray(t,i.tmEPOAdmin.canTakeLogic)&&"1"===i.tmEPOAdmin.getFieldValue(e,"enabled",!0)}),i.tmEPOAdmin.check_section_logic(),i.tmEPOAdmin.check_element_logic(r,t),l=i.extend(!0,{},i.tmEPOAdmin.get_element_logic_init()),d=i.extend(!0,{},i.tmEPOAdmin.get_element_logic_options_init()),(o=u[t].section.sections_uniqid.default)&&l[o]&&l[o].values[a]?(delete l[o].values[a],delete d[o][a+1],delete d[o][0]):o&&d[o]&&d[o][0]&&delete d[o][0],i.each(d,function(e,t){t&&i.each(t,function(e,t){t&&c.push(t)})}),i.tmEPOAdmin.elementLogicObject.init||(i.tmEPOAdmin.elementLogicObject.init=!0),i.tmEPOAdmin.elementLogicObject=i.extend(i.tmEPOAdmin.elementLogicObject,l),n&&i.tmEPOAdmin.logic_append(n,c,"element",t,r)},section_logic_init:function(e,t){var n,a,o,l=[],d={};e instanceof i?e=parseInt(e.index(),10):void 0!==e&&(e=i.epoAPI.math.toFloat(e)),void 0===e?o=u:(o=[])[e]=i.extend(!0,{},u[e]),i.tmEPOAdmin.check_section_logic(e),Object.keys(o).forEach(function(e){void 0!==u[e].section&&(d=i.extend(!0,{},i.tmEPOAdmin.get_element_logic_init(!0)),n=i.extend(!0,{},i.tmEPOAdmin.get_element_logic_options_init(!0)),(a=u[e].section.sections_uniqid.default)&&d[a]&&(delete d[a],delete n[a]),i.each(n,function(e,t){t&&i.each(t,function(e,t){t&&l.push(t)})}),i.tmEPOAdmin.sectionLogicObject.init||(i.tmEPOAdmin.sectionLogicObject.init=!0),i.tmEPOAdmin.sectionLogicObject=i.extend(i.tmEPOAdmin.sectionLogicObject,d),t&&i.tmEPOAdmin.logic_append(t,l,"section",e))})},logic_check_section_rules:function(e){var t,a;return"object"==typeof e&&null!==e||(e={}),void 0===e.toggle&&(e.toggle="show"),void 0===e.what&&(e.what="any"),void 0===e.rules&&(e.rules=[]),t=o(e),a=i.tmEPOAdmin.sectionLogicObject,i.each(e.rules,function(e,i){void 0!==a[i.section]&&void 0!==a[i.section].values[i.element]||i.section===i.element||delete t.rules[e]}),t.rules=n(t.rules),t},logic_check_element_rules:function(e,t,a){var l,d,r;return"object"==typeof e&&e||(e={}),void 0===e.toggle&&(e.toggle="show"),void 0===e.what&&(e.what="any"),void 0===e.rules&&(e.rules=[]),l=o(e),d=i.tmEPOAdmin.elementLogicObject,i.each(e.rules,function(e,n){void 0!==d[n.section]&&void 0!==d[n.section].values[n.element]||n.section===n.element||(void 0!==t&&void 0!==a&&(r=i(".builder_layout").find(".builder-wrapper").eq(t),(r=r.find(".bitem").eq(a)).addClass("tm-wrong-rule")),delete l.rules[e])}),l.rules=n(l.rules),l},logic_append:function(e,t,n,a,o){var l,d,r,s,c,m,p,_,f,v;if(e=i(e),l=i(e).find(".tm-logic-wrapper"),!t||0===t.length)return l.html('<div class="errortitle"><p>'+h.i18n_cannot_apply_rules+"</p></div>"),!1;try{d="1"===("element"===n?i.tmEPOAdmin.getFieldValue(u[a].fields[o],"logic",!0)||"":u[a].section.sections_logic.default||"")?"element"===n?i.tmEPOAdmin.getFieldValue(u[a].fields[o],"clogic",!0)||"null":u[a].section.sections_clogic.default||"null":"null",r=i.epoAPI.util.parseJSON(d),v="element"===n?i.tmEPOAdmin.logic_check_element_rules(r):i.tmEPOAdmin.logic_check_section_rules(r),"element"===n?i.tmEPOAdmin.setFieldValue(a,o,"clogic",E.stringify(v),!0):u[a].section.sections_clogic.default=E.stringify(v)}catch(e){v=!1}l.empty(),s=i('<div class="tc-row tm-logic-rule"><div class="tc-cell tc-col-4 tm-logic-element"></div><div class="tc-cell tc-col-2 tm-logic-operator"></div><div class="tc-cell tc-col-4 tm-logic-value"></div><div class="tc-cell tc-col-2 tm-logic-func"><button type="button" class="tmicon tcfa tcfa-plus add cpf-add-rule"></button> <button type="button" class="tmicon tcfa tcfa-times delete cpf-delete-rule"></button></div></div>'),c=i('<select class="cpf-logic-element">'+t.join("")+"</select>"),m="",Object.keys(i.tmEPOAdmin.logicOperators).forEach(function(e){m=m+'<option value="'+e+'">'+i.tmEPOAdmin.logicOperators[e]+"</option>"}),m=i('<select class="cpf-logic-operator">'+m+"</select>"),s.find(".tm-logic-element").append(c),s.find(".tm-logic-operator").append(m),v&&void 0!==v.rules&&v.rules.length?(p=i('<div class="temp">'),i.each(v.rules,function(e,t){t&&"object"==typeof t&&(_=s.clone(),f=_.find(".cpf-logic-element").find('option[data-section="'+t.section+'"][value="'+t.element+'"]'),i(f).length&&(i(f)[0].selected=!0),i.tmEPOAdmin.cpf_logic_element_onchange(_.find(".cpf-logic-element"),"element"===n),_.find(".cpf-logic-operator").val(t.operator),i.tmEPOAdmin.cpf_logic_operator_onchange(_.find(".cpf-logic-operator"),"element"===n),_.find(".cpf-logic-value").is("select")?_.find(".cpf-logic-value").val(i.tmEPOAdmin.tm_escape(i.tmEPOAdmin.tm_unescape(t.value))):_.find(".cpf-logic-value").val(i.tmEPOAdmin.tm_unescape(t.value)),p.append(_))}),p=p.children(),l.append(p)):(s.appendTo(l),s.find(".cpf-logic-element").trigger("change.cpf",["element"===n]),s.find(".cpf-logic-operator").trigger("change.cpf",["element"===n]))},logic_get_JSON:function(e){var t,n,a,o,l,d=i(e).find(".builder-logic-div"),r=e.find(".tm-builder-sections-uniqid").val(),s={},c=d.find(".epo-rule-toggle").val(),m=d.find(".epo-rule-what").val();return s.section=r,s.toggle=c,s.what=m,s.rules=[],d.find(".tm-logic-wrapper").children(".tm-logic-rule").each(function(e,d){d=i(d),t=d.find(".cpf-logic-element"),n=t.children("option:selected").attr("data-section"),a=t.val(),o=d.find(".cpf-logic-operator").val(),l=d.find(".cpf-logic-value").val(),d.find(".cpf-logic-value").is("select")||(l=i.tmEPOAdmin.tm_escape(l)),s.rules.push({section:n,element:a,operator:o,value:l})}),E.stringify(s)},element_logic_get_JSON:function(e){var t,n,a,o,l,d=i(e).find(".builder-logic-div"),r=e.find(".tm-builder-element-uniqid").val(),s={},c=d.find(".epo-rule-toggle").val(),m=d.find(".epo-rule-what").val();return s.element=r,s.toggle=c,s.what=m,s.rules=[],d.find(".tm-logic-wrapper").children(".tm-logic-rule").each(function(e,d){d=i(d),t=d.find(".cpf-logic-element"),n=t.children("option:selected").attr("data-section"),a=t.val(),o=d.find(".cpf-logic-operator").val(),l=d.find(".cpf-logic-value").val(),s.rules.push({section:n,element:a,operator:o,value:l})}),E.stringify(s)},cpf_add_rule:function(e){var t=i(this).closest(".tm-logic-rule"),n=t.tcClone(!0);e.preventDefault(),n&&t.after(n)},cpf_delete_rule:function(e){var t=i(this),n=t.closest(".tm-logic-wrapper");e.preventDefault(),t.trigger("hideTtooltip"),n.children().length>1&&t.closest(".tm-logic-rule").css({margin:"0 auto"}).animate({opacity:0,height:0,width:0},300,function(){i(this).remove()})},section_logic_reindex:function(){var e=i.tmEPOAdmin.builderItemsSortableObj;Object.keys(u).forEach(function(t){var a,l=t,d=[],r=u[t].section.sections_clogic.default||"null";return!u[t].section.sections_logic.default||(!((r=i.epoAPI.util.parseJSON(r))&&void 0!==r.rules&&r.rules.length>0)||void(e.end.section_eq===l?(i.each(r.rules,function(n,l){a=o(l),l.element>e.start.element&&l.secion===e.start.section?(a.element=parseInt(a.element,10)-1,d[n]=i.tmEPOAdmin.validate_rule(a,t)):d[n]=i.tmEPOAdmin.validate_rule(a,t)}),0===(d=n(d)).length&&(u[t].section.sections_logic.default=""),r.rules=d,u[t].section.sections_clogic.default=E.stringify(r)):(i.each(r.rules,function(n,l){a=o(l),"check"!==e.start.section&&(l.section===e.start.section&&l.section===e.end.section?l.element===e.start.element?(a.section=e.end.section,a.element=e.end.element):parseInt(l.element,10)>parseInt(e.start.element,10)&&parseInt(l.element,10)<=parseInt(e.end.element,10)?a.element=parseInt(a.element,10)-1:parseInt(l.element,10)<parseInt(e.start.element,10)&&parseInt(l.element,10)>=parseInt(e.end.element,10)&&(a.element=parseInt(a.element,10)+1):l.section===e.start.section&&l.section!==e.end.section?l.element===e.start.element?(a.section=e.end.section,a.element=e.end.element):parseInt(l.element,10)>parseInt(e.start.element,10)&&(a.element=parseInt(a.element,10)-1):l.section!==e.start.section&&l.section===e.end.section&&parseInt(l.element,10)>=parseInt(e.end.element,10)&&(a.element=parseInt(a.element,10)+1)),"delete"===e.end.section&&"delete"===a.element||(d[n]=i.tmEPOAdmin.validate_rule(a,t))}),0===(d=n(d)).length&&(u[t].section.sections_logic.default=""),r.rules=d,u[t].section.sections_clogic.default=E.stringify(r))))})},element_logic_reindex:function(){var e,t,a,l,d,r,s=i.tmEPOAdmin.builderItemsSortableObj;(d=s.start.disabledFieldIndex)&&(s.start.element=d.toString()),(d=s.end.disabledFieldIndex)&&(s.end.element=d.toString()),Object.keys(u).forEach(function(d){Object.keys(u[d].fields).forEach(function(c){return t=u[d].fields[c],r=i.tmEPOAdmin.getFieldValue(t,"element_type"),!i.tmEPOAdmin.getFieldValue(t,"logic",r)||(a=[],l=i.tmEPOAdmin.getFieldValue(t,"clogic",r),!((l=i.epoAPI.util.parseJSON(l))&&void 0!==l.rules&&l.rules.length>0)||(i.each(l.rules,function(t,n){if(e=o(n),void 0===n.element)return!0;n.element=n.element.toString(),"check"!==s.start.section&&(n.section===s.start.section&&n.section===s.end.section?n.element===s.start.element?e.element=s.end.element:parseInt(n.element,10)>parseInt(s.start.element,10)&&parseInt(n.element,10)<=parseInt(s.end.element,10)?e.element=parseInt(e.element,10)-1:parseInt(n.element,10)<parseInt(s.start.element,10)&&parseInt(n.element,10)>=parseInt(s.end.element,10)&&(e.element=parseInt(e.element,10)+1):n.section===s.start.section&&n.section!==s.end.section?n.element===s.start.element?(e.section=s.end.section,e.element=s.end.element):!i.tmEPOAdmin.builderItemsSortableObj.start.disabled&&parseInt(n.element,10)>parseInt(s.start.element,10)&&(e.element=parseInt(e.element,10)-1):n.section!==s.start.section&&n.section===s.end.section&&parseInt(n.element,10)>=parseInt(s.end.element,10)&&(e.element=parseInt(e.element,10)+1)),"delete"===s.end.section&&"delete"===e.element||(a[t]=i.tmEPOAdmin.validate_rule(e,d,c))}),0===(a=n(a)).length&&i.tmEPOAdmin.setFieldValue(d,c,"logic","",r),l.rules=a,void i.tmEPOAdmin.setFieldValue(d,c,"clogic",E.stringify(l),r)))})})},validate_rule:function(e,t,n){var a,o,l,d,r,s,c;return!O||!e||"object"!=typeof e||void 0===e.element||void 0===e.operator||void 0===e.section||void 0===e.value&&"isempty"!==e.operator&&"isnotempty"!==e.operator?[]:-1===(a=u.findIndex(function(t){return t.section.sections_uniqid.default===e.section}))?[]:(c=u[a].fields.filter(function(e){var t=i.tmEPOAdmin.getFieldValue(e,"element_type");return"1"===i.tmEPOAdmin.getFieldValue(e,"enabled",t)||void 0===i.tmEPOAdmin.getFieldValue(e,"enabled",t)}),void 0!==(o=c[e.element])?(s=i.tmEPOAdmin.getFieldValue(o,"element_type"),l=!1,-1!==i.inArray(s,["radiobuttons","checkboxes","selectbox"])?(d=i.tmEPOAdmin.getFieldMultiple(o,"value",s),Object.keys(d).some(function(t,n){return i.tmEPOAdmin.tm_escape(d[n].default)===e.value?l=!0:d[n].default===e.value&&(e.value=i.tmEPOAdmin.tm_escape(e.value),l=!0),l})):"variations"===s&&("is"===e.operator||"isnot"===e.operator)?i(O.variations).each(function(t,n){if(i.tmEPOAdmin.tm_escape(n.variation_id)===e.value)return l=!0,!1}):l=!0):l=!0,r=i(".builder_layout").find(".builder-wrapper").eq(t),void 0!==n&&(r=r.find(".bitem").eq(n)),r.length>0?l||void 0!==n&&""===i.tmEPOAdmin.getFieldValue(u[t].fields[n],"logic",s)?(r.removeClass("tm-wrong-rule"),e):(r.addClass("tm-wrong-rule"),[]):[])},logic_reindex:function(){var e=i.tmEPOAdmin.builderItemsSortableObj;e.start.section===e.end.section&&e.start.section_eq===e.end.section_eq&&e.start.element===e.end.element||(i.tmEPOAdmin.section_logic_reindex(),i.tmEPOAdmin.element_logic_reindex()),i.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},logic_reindex_force:function(){i.tmEPOAdmin.builderItemsSortableObj.start.section="check",i.tmEPOAdmin.builderItemsSortableObj.start.section_eq="check",i.tmEPOAdmin.builderItemsSortableObj.start.element="check",i.tmEPOAdmin.builderItemsSortableObj.end.section="check2",i.tmEPOAdmin.builderItemsSortableObj.end.section_eq="check2",i.tmEPOAdmin.builderItemsSortableObj.end.element="check2",i.tmEPOAdmin.section_logic_reindex(),i.tmEPOAdmin.element_logic_reindex(),i.tmEPOAdmin.builderItemsSortableObj={start:{},end:{}}},builder_items_sortable:function(e){i.tmEPOAdmin.is_original&&e.sortable({handle:".move",cursor:"move",items:".bitem",start:function(e,t){var n,a,o,l,d;t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.outerWidth()),i.tmEPOAdmin.isElementDragged=!0,i(t.item).hasClass("ditem")?(i.tmEPOAdmin.builderItemsSortableObj.start.section="drag",i.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",i.tmEPOAdmin.builderItemsSortableObj.start.element="drag"):(d=(n=i(t.item).closest(".builder-wrapper")).index(),a=u[d].section.is_slider,o=i.tmEPOAdmin.find_index(a,i(t.item)),l=i.tmEPOAdmin.find_index(a,i(t.item),".bitem",".element-is-disabled"),u[d].section.sections.default=parseInt(u[d].section.sections.default,10)-1,u[d].section.sections.default=u[d].section.sections.default.toString(),a&&(u[d].section.sections_slides.default=n.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(",")),i.tmEPOAdmin.builderItemsSortableObj.start.section=u[d].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.start.section_eq=d.toString(),i.tmEPOAdmin.builderItemsSortableObj.start.element=o.toString(),i.tmEPOAdmin.builderItemsSortableObj.start.disabledFieldIndex=l),i(".builder_layout .bitem-wrapper").not(".tma-variations-wrap .bitem-wrapper").addClass("highlight")},stop:function(e,t){var n,a,o,l,d;i.tmEPOAdmin.isElementDragged=!1,d=(n=i(t.item).closest(".builder-wrapper")).index(),a=u[d].section.is_slider,o=i.tmEPOAdmin.find_index(a,i(t.item)),l=i.tmEPOAdmin.find_index(a,i(t.item),".bitem",".element-is-disabled"),i(t.item).hasClass("ditem")||(i(".builder-wrapper.tm-zindex").css("zIndex","").removeClass("tm-zindex"),u[d].section.sections.default=parseInt(u[d].section.sections.default,10)+1,u[d].section.sections.default=u[d].section.sections.default.toString(),a&&(u[d].section.sections_slides.default=n.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(","))),i.tmEPOAdmin.builderItemsSortableObj.end.section=u[d].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.end.section_eq=d.toString(),i.tmEPOAdmin.builderItemsSortableObj.end.element=o.toString(),i.tmEPOAdmin.builderItemsSortableObj.end.disabledFieldIndex=l,u[d].fields.splice(o,0,u[i.tmEPOAdmin.builderItemsSortableObj.start.section_eq].fields.splice(i.tmEPOAdmin.builderItemsSortableObj.start.element,1)[0]),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.logic_reindex(),i(".builder_layout .bitem-wrapper").removeClass("highlight")},tolerance:"pointer",forcePlaceholderSize:!0,placeholder:"bitem pl2",cancel:".panels_wrap,.tma-nomove",dropOnEmptyType:!0,revert:200,connectWith:".builder-wrapper:not(.tma-nomove) .bitem-wrapper"})},builder_delete_do:function(){var e,t,n,a,o,l,d,r,s=i(this);o=(e=s.closest(".builder-wrapper")).index(),t=s.closest(".bitem"),n=u[o].section.is_slider,a=i.tmEPOAdmin.find_index(n,t),u[o].section.sections.default=parseInt(u[o].section.sections.default,10)-1,u[o].section.sections.default=u[o].section.sections.default.toString(),r=u[o].fields[a],l=i.tmEPOAdmin.getFieldValue(r,"element_type"),d="1"===i.tmEPOAdmin.getFieldValue(r,"enabled",l),i.tmEPOAdmin.builderItemsSortableObj.start.section=u[o].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.start.section_eq=o.toString(),i.tmEPOAdmin.builderItemsSortableObj.start.element=a.toString(),i.tmEPOAdmin.builderItemsSortableObj.end.section="delete",i.tmEPOAdmin.builderItemsSortableObj.end.section_eq="delete",i.tmEPOAdmin.builderItemsSortableObj.end.element="delete",d||(i.tmEPOAdmin.builderItemsSortableObj.start.disabled=!0),t.remove(),u[o].fields.splice(a,1),i.tmEPOAdmin.logic_reindex(),n&&(u[o].section.sections_slides.default=e.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(",")),i.tmEPOAdmin.builder_reorder_multiple()},builder_delete_onClick:function(e){e.preventDefault(),i(this).trigger("blur"),i.tmEPOAdmin.doConfirm(h.i18n_builder_delete,i.tmEPOAdmin.builder_delete_do,this)},builder_fold_onClick:function(){var e,t=i(this);t.is(".tma-handle")&&(t=t.find(".fold")),e=t.closest(".tma-handle-wrap").find(".tma-handle-wrapper").first(),t.data("folded")||void 0===t.data("folded")?(t.data("folded",!1),t.removeClass("tcfa-caret-up").addClass("tcfa-caret-down"),e.removeClass("tm-hidden")):(t.data("folded",!0),t.removeClass("tcfa-caret-down").addClass("tcfa-caret-up"),e.addClass("tm-hidden"))},builder_section_fold_onClick:function(){var e=i(this),t=e.closest(".builder-wrapper");e.data("folded")?(e.data("folded",!1),t.removeClass("tm-hide-bitems"),e.removeClass("tcfa-caret-up").addClass("tcfa-caret-down")):(e.data("folded",!0),t.addClass("tm-hide-bitems"),e.removeClass("tcfa-caret-down").addClass("tcfa-caret-up")),e.closest(".builder-wrapper").find(".float.builder_drag_elements").remove()},builder_section_delete_do:function(){var e,t;e=(t=i(this).closest(".builder-wrapper")).index(),t.remove(),u.splice(e,1),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.section_logic_init(),i.tmEPOAdmin.initSectionsCheck()},builder_section_delete_onClick:function(e){e.preventDefault(),i(this).trigger("blur"),i.tmEPOAdmin.doConfirm(h.i18n_builder_delete,i.tmEPOAdmin.builder_section_delete_do,this)},builder_plus_onClick:function(){var e,t,n=i(this).parentsUntil(".bitem").parent().first(),a=n.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],o=Object.keys(i.tmEPOAdmin.builderSize),l=o[o.findIndex(function(e){return e===a})+1],d=i.tmEPOAdmin.builderSize[l];void 0!==l&&(n.removeClass(String(a)),n.addClass(String(l)).css("width",""),n.find(".size").text(d),e=n.closest(".builder-wrapper").index(),t=i.tmEPOAdmin.find_index(u[e].section.is_slider,n),i.tmEPOAdmin.setFieldValue(e,t,"div_size",l))},builder_minus_onClick:function(){var e,t,n=i(this).parentsUntil(".bitem").parent().first(),a=n.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],o=Object.keys(i.tmEPOAdmin.builderSize),l=o[o.findIndex(function(e){return e===a})-1],d=i.tmEPOAdmin.builderSize[l];void 0!==l&&(n.removeClass(String(a)),n.addClass(String(l)).css("width",""),n.find(".size").text(d),e=n.closest(".builder-wrapper").index(),t=i.tmEPOAdmin.find_index(u[e].section.is_slider,n),i.tmEPOAdmin.setFieldValue(e,t,"div_size",l))},builder_section_plus_onClick:function(){var e,t=i(this).closest(".builder-wrapper"),n=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],a=Object.keys(i.tmEPOAdmin.builderSize),o=a[a.findIndex(function(e){return e===n})+1],l=i.tmEPOAdmin.builderSize[o];void 0!==o&&(t.removeClass(String(n)),t.addClass(String(o)).css("width",""),t.find(".section-settings .size").text(l),e=t.index(),u[e].section.sections_size.default=o,u[e].size=l,i.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_minus_onClick:function(){var e,t=i(this).closest(".builder-wrapper"),n=t.attr("class").split(" ").filter(function(e){return 0===e.indexOf("w")})[0],a=Object.keys(i.tmEPOAdmin.builderSize),o=a[a.findIndex(function(e){return e===n})-1],l=i.tmEPOAdmin.builderSize[o];void 0!==o&&(t.removeClass(String(n)),t.addClass(String(o)).css("width",""),t.find(".section-settings .size").text(l),e=t.index(),u[e].section.sections_size.default=o,u[e].size=l,i.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_item_onClick:function(){var e,t,n,a,o,l,d,r=i.epoAPI.template.html(A.tc_builder_section,{});a=i(this).closest(".builder-wrapper"),o=a.index(),(l=i(r)).addClass(u[o].section.sections_size.default),l.addClass("appear"),!0===u[o].section.tma_variations_wrap&&(l.find(".builder-remove-for-variations").remove(),l.find(".builder_hide_for_variation").hide(),l.find(".tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce").hide()),d=l.find(".section_elements"),i.tmEPOAdmin.copyContent(d,o),i.tmEPOAdmin.check_section_logic(o),e=i.tmEPOAdmin.sectionLogicObject,t=i.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:h.i18n_edit_settings,uniqidtext:h.i18n_section_uniqid+":",uniqid:u[o].section.sections_uniqid.default}),i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"80%",height:"80%",classname:"flasho tc-wrapper"+(a.is(".tma-variations-wrap")?" tma-variations-section":""),data:t,cancelEvent:function(t){n||(n=!0,i.tmEPOAdmin.sectionLogicObject=e,i.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),t.destroy(),i("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){n||(n=!0,i.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),i.tmEPOAdmin.changeBuilder(d,o),u[o].section.sections_clogic.default=i.tmEPOAdmin.logic_get_JSON(d),i.tmEPOAdmin.sections_type_onChange(o),i.tmEPOAdmin.logic_reindex_force(),e.destroy(),i("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),n=!1,i("body").addClass("floatbox-open"),d.appendTo("#tc-floatbox-content").removeClass("closed"),i.tmEPOAdmin.section_logic_init(o,d),setTimeout(function(){var e;e=d.find(".tm-builder-clogic").val()||"null",e=i.epoAPI.util.parseJSON(e),e=i.tmEPOAdmin.logic_check_element_rules(e),d.find(".epo-rule-toggle").val(e.toggle),d.find(".epo-rule-what").val(e.what)},1),i.tmEPOAdmin.set_fields_logic(d),d.find(".activate-sections-logic").trigger("change"),d.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),d.tmcheckboxes(),i.tmEPOAdmin.builder_clone_after_events(d),i.tcToolTip(i("#tc-floatbox-content").find(".tm-tooltip")),i.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper")},changeBuilder:function(e,t,n){var a,o,l,d=i.tmEPOAdmin.getFieldObject(e);void 0!==n?(a=i.tmEPOAdmin.getFieldValue(u[t].fields[n],"element_type"),o=u[t].fields[n].filter(function(e){return"element_type"===e.id||"div_size"===e.id||e.id===a+"_internal_name"}),u[t].fields[n]=[].concat.apply(o,d)):(o=[u[t].section.sections_internal_name],d=[].concat.apply(o,d),l={},Object.keys(d).forEach(function(e){l[d[e].id]=d[e]}),l.is_slider=u[t].section.is_slider,l.rules_toggle=u[t].section.rules_toggle,l.rules_what=u[t].section.rules_what,u[t].section=l)},copyContent:function(e,t,n){var a,o,l,d,r=e.find(".panels_wrap");a=void 0!==n?u[t].fields[n]:u[t].section,Object.keys(a).forEach(function(t){var n,s;"object"==typeof a[t]&&("multiple"===a[t].id?Object.keys(a[t].multiple).forEach(function(i){0===(o=e.find(".options-wrap")).eq(i).length&&o.eq(0).tcClone().appendTo(r).find(":input").not("button").val("").prop("checked",!1).find(".tm_option_enabled").prop("checked",!0).val("1").trigger("changechoice"),Object.keys(a[t].multiple[i]).forEach(function(o){n=a[t].multiple[i][o].tags.name,n=n.replace("[]",""),n=n.substr(0,n.lastIndexOf("[")),s=a[t].multiple[i][o].default,(l=e.find(".options-wrap").eq(i).find("[name^='"+n+"']")).attr("data-builder",E.stringify(a[t].multiple[i][o])),l.attr("name",a[t].multiple[i][o].tags.name).attr("data-field-id",a[t].multiple[i][o].id).removeAttr("id").val(s).trigger("change"),void 0!==a[t].multiple[i][o].checked&&("multiple_checkboxes_options_default_value"===a[t].multiple[i][o].id||"multiple_radiobuttons_options_default_value"===a[t].multiple[i][o].id||"multiple_selectbox_options_default_value"===a[t].multiple[i][o].id?l.val(i):l.val(a[t].multiple[i][o].tags.value),!0===a[t].multiple[i][o].checked?l.prop("checked",!0):l.prop("checked",!1))}),o=e.find(".options-wrap").eq(i)}):(n=a[t].tags.name,s=a[t].default,l=e.find("[name='"+n+"']"),"product"===a[t].fill&&a[t].options&&a[t].options.push&&(a[t].options.forEach(function(e){l.append(i('<option selected="selected" value="'+e.value+'">'+e.text+"</option>"))}),l.attr("data-exclude",h.post_id+","+h.original_post_id)),"category"===a[t].fill&&s&&s.push&&s.forEach(function(e){l.find('option[value="'+e+'"]').attr("selected","selected")}),l.is(".product-default-value-search")&&("products"===e.find(".product-mode:checked").val()||"product"===e.find(".product-mode:checked").val()?(l.removeClass("wc-product-search").addClass("enhanced-dropdown"),d=e.find(".product-products-selector").find(":selected").clone().removeAttr("selected").removeAttr("data-select2-id"),l.find("option").remove(),l.append(d)):""!==s&&(d=a[t].current_selected_text?a[t].current_selected_text:s,l.attr("data-current-selected",s),l.data("current-selected-text",d),l.append(i('<option selected="selected" value="'+s+'">'+d+"</option>")),l.addClass("wc-product-search")),""!==s&&l.attr("data-current-selected",s)),l.attr("data-builder",E.stringify(a[t])).attr("data-field-id",a[t].id),l.is(":radio")?l.toArray().forEach(function(e,i){var n;a[t].options?(l.eq(i).val(a[t].options[i].value),n=a[t].options[i].value):n=l.eq(i).val(),n===s?(l.eq(i).prop("checked",!0),l.eq(i).trigger("change")):l.eq(i).prop("checked",!1)}):(l.val(s).trigger("change"),void 0!==a[t].checked&&(l.val(a[t].tags.value),!0===a[t].checked?l.prop("checked",!0):l.prop("checked",!1))),a[t].disabled&&(l.addClass("tm-wmpl-disabled").prop("disabled",!0),l.closest(".message0x0").addClass("tm-setting-row-disabled"))))})},builder_item_onClick:function(){var e,t,n,a,o,l,d,r,s,c,m,p,_,f=i(this).closest(".bitem"),v=i.epoAPI.template.html(A.tc_builder_elements,{});r=f.closest(".builder-wrapper"),l=r.index(),s=u[l].section.is_slider,d=i.tmEPOAdmin.find_index(s,f),c=i.tmEPOAdmin.getFieldValue(u[l].fields[d],"element_type"),m=i(v).filter(".bitem.element-"+c).tcClone(!0),t=i.tmEPOAdmin.getFieldValue(u[l].fields[d],"enabled",c),t="variations"===c||"1"===t||void 0===t?"1":"0",!0===u[l].section.tma_variations_wrap&&m.find("tma-tab-extra, .tma-tab-logic,.tma-tab-css,.tma-tab-woocommerce").remove(),p=m.find(".hstc2").find(".inside:first"),"variations"===c&&p.find(".tm-all-attributes").html(u[l].variations_html),i.tmEPOAdmin.copyContent(p,l,d),i.tmEPOAdmin.check_element_logic(d,l),e=i.tmEPOAdmin.elementLogicObject,_=i.tmEPOAdmin.getFieldValue(u[l].fields[d],"uniqid",c),n=i.tmEPOAdmin.builder_floatbox_template({id:"tc-floatbox-content",html:"",title:h.i18n_edit_settings,uniqidtext:"variations"===c||void 0===_?"":h.i18n_element_uniqid+":",uniqid:"variations"===c||void 0===_?"":_}),i.tcFloatBox({closefadeouttime:0,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"80%",height:"80%",classname:"flasho tc-wrapper"+("variations"===c?" tma-variations-section":""),data:n,cancelEvent:function(t){a||(a=!0,(o=p.find(".tcpagination")).data("tc-pagination")&&o.tcPagination("destroy"),i.tmEPOAdmin.elementLogicObject=e,i.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),t.destroy(),i("body").removeClass("floatbox-open"))},cancelClass:".floatbox-cancel",updateEvent:function(e){var n,r,m,_,h,v;a||(a=!0,(o=p.find(".tcpagination")).data("tc-pagination")&&o.tcPagination("destroy"),i.tmEPOAdmin.removeTinyMCE(".flasho.tc-wrapper"),i.tmEPOAdmin.changeBuilder(p,l,d),i.tmEPOAdmin.setFieldValue(l,d,"clogic",i.tmEPOAdmin.element_logic_get_JSON(p),c),i.tmEPOAdmin.set_field_title(f,l,d),i.tmEPOAdmin.logic_reindex_force(),"0"===(n="variations"===c||0===p.find(".is_enabled").length||p.find(".is_enabled").is(":checked")?"1":"0")?f.addClass("element-is-disabled"):f.removeClass("element-is-disabled"),t!==n&&(r=u[l].section.sections_uniqid.default,m=d,_=i.tmEPOAdmin.find_index(s,f,".bitem",".element-is-disabled"),Object.keys(u[l].fields).forEach(function(e){h=i.tmEPOAdmin.getFieldValue(u[l].fields[e],"clogic",!0)||"null",h=i.epoAPI.util.parseJSON(h),h=i.tmEPOAdmin.logic_check_rules_reindex(f,h,m,_,r,n),i.tmEPOAdmin.setFieldValue(l,e,"clogic",E.stringify(h),!0)}),Object.keys(u).forEach(function(e){(e=parseInt(e,10))!==l&&(v=u[e].section.sections_clogic.default||"null",v=i.epoAPI.util.parseJSON(v),v=i.tmEPOAdmin.logic_check_rules_reindex(i(".builder-wrapper").eq(e),v,m,_,r,n),u[e].section.sections_clogic.default=E.stringify(v),Object.keys(u[e].fields).forEach(function(t){h=i.tmEPOAdmin.getFieldValue(u[e].fields[t],"clogic",!0)||"null",h=i.epoAPI.util.parseJSON(h),h=i.tmEPOAdmin.logic_check_rules_reindex(i(".builder-wrapper").eq(e).find(".bitem").eq(t),h,m,_,r,n),i.tmEPOAdmin.setFieldValue(e,t,"clogic",E.stringify(h),!0)}))})),e.destroy(),i("body").removeClass("floatbox-open"))},updateClass:".floatbox-update"}),a=!1,i("body").addClass("floatbox-open"),p.appendTo("#tc-floatbox-content"),i("#tc-floatbox-content").find(".inside").addClass("tm-hidden").after(i('<div class="floatbox-loading">'+h.i18n_loading+"</div>")),setTimeout(function(){var e;i.tmEPOAdmin.element_logic_init(d,l,p),p.find(".activate-element-logic").trigger("change"),p.find(".tm_option_enabled").trigger("changechoice"),e=p.find(".tm-builder-clogic").val()||"null",e=i.epoAPI.util.parseJSON(e),e=i.tmEPOAdmin.logic_check_element_rules(e),p.find(".epo-rule-toggle").val(e.toggle),p.find(".epo-rule-what").val(e.what),p.find(":radio:checked").not(".panels_wrap :radio").trigger("change"),"variations"===c&&(p.find(".builder-remove-for-variations").remove(),p.find(".builder_hide_for_variation").hide()),p.tmcheckboxes(),i.tmEPOAdmin.builder_clone_after_events(p),"variations"===c?i.tmEPOAdmin.variations_display_as():i.tmEPOAdmin.tm_upload(),i.tmEPOAdmin.set_fields_logic(p),i.tcToolTip(i("#tc-floatbox-content").find(".tm-tooltip")),i.tmEPOAdmin.tm_weekdays(i("#tc-floatbox-content")),i.tmEPOAdmin.tm_months(i("#tc-floatbox-content")),i.tmEPOAdmin.tm_url(),i.tmEPOAdmin.tm_pricetype_selector(),i.tmEPOAdmin.tm_option_price_type(),i.tmEPOAdmin.addTinyMCE(".flasho.tc-wrapper"),i.tmEPOAdmin.paginattion_init(),i("#tc-floatbox-content").find(".inside").removeClass("tm-hidden"),p.find(".tm-tabs").tmtabs({dataopenattribute:"data-tab"}),i("#tc-floatbox-content").find(".floatbox-loading").remove()},1)},set_fields_logic:function(e){e.find(".message0x0[data-required]").toArray().forEach(function(t){var n,a,o="AND";t=i(t),(n=t.data("required")).relation&&(o=n.relation,delete n.relation),a=function(){var a=!0;Object.keys(n).some(function(l){var d=n[l].operator,r=n[l].value;return"OR"===o&&(a=!0),(a=a&&function(){var n=i(l),a="",o=!0;return e.find(l).length?(n.is(":checkbox")?n.is(":checked")&&(a=n.val()):a=n.is(":radio")?e.find(l).filter(":checked").val():n.val(),o="object"==typeof r?-1!==i.inArray(a,r):a===r,(o="is"===d?o:!o)?t.removeClass("tm-hidden"):t.addClass("tm-hidden"),o):o}())||t.addClass("tm-hidden"),"OR"===o&&a})},Object.keys(n).forEach(function(t){e.on("change.required changerequired",t,a)}),a()})},logic_check_rules_reindex:function(e,t,a,l,d,r){var s;return"object"==typeof t&&null!==t||(t={}),void 0===t.toggle&&(t.toggle="show"),void 0===t.what&&(t.what="any"),void 0===t.rules&&(t.rules=[]),s=o(t),a=parseInt(a,10),l=parseInt(l,10),r=parseInt(r,10),i.each(t.rules,function(t,i){var n=i.section,o=i.element;n===d&&o.toString().isNumeric()&&(o=parseInt(o,10),a===o?0===r?(delete s.rules[t],e.addClass("tm-wrong-rule")):1===r&&(o+=1,s.rules[t].element=o.toString()):a<o&&(0===r?(o-=1,s.rules[t].element=o.toString()):1===r&&(o+=1,s.rules[t].element=o.toString())))}),s.rules=n(s.rules),s},getFieldObject:function(e){var t,n,a,o,l,d,r=[];return e.find(":input").not("button").not(".panels_wrap :input").toArray().forEach(function(e){(e=i(e)).is(":radio")&&!e.is(":checked")||void 0!==(t=e.attr("name"))&&0===t.indexOf("tm_meta[")&&((n=t.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!==e&&void 0!==e?e:null}).splice(2,1)[0],l={id:n,default:e.val(),type:e.prop("nodeName").toLowerCase(),tags:{name:t}},(e.is(":checkbox")||e.is(":radio"))&&(l.checked=e.is(":checked"),l.tags.value=e.attr("value"),l.checked?l.default=e.attr("value"):l.default=""),e.attr("data-builder")&&(("product"===(d=i.epoAPI.util.parseJSON(e.attr("data-builder"))).fill||"category"===d.fill||e.is(".product-products-selector")||e.is(".product-categories-selector"))&&(l.options=e.children("option:selected").toArray().map(function(e){return{text:i(e).text(),value:i(e).val()}})),e.is(".product-categories-selector")?l.fill="category":e.is(".product-products-selector")&&(l.fill="product"),d&&(l=Object.assign(d,l))),e.attr("data-current-selected")&&(l.current_selected=e.attr("data-current-selected"),l.current_selected_text=e.data("current-selected-text")),r.push(l))}),e.find(".panels_wrap :input").not("button").length>0&&(a=[],e.find(".panels_wrap .options-wrap").each(function(e,r){o=[],i(r).find(":input").not("button").each(function(e,a){a=i(a),void 0!==(t=a.attr("name"))&&0===t.indexOf("tm_meta[")&&((n=t.split(/[[\]]{1,2}/)).pop(),n=n.map(function(e){return""===e?null:e}).filter(function(e){return null!==e&&void 0!==e?e:null}).splice(2,1)[0],l={id:n,default:a.val(),type:a.prop("nodeName").toLowerCase(),tags:{name:t}},(a.is(":checkbox")||a.is(":radio"))&&(l.checked=a.is(":checked"),l.tags.value=a.attr("value"),l.checked?l.default=a.attr("value"):l.default=""),a.attr("data-builder")&&(d=i.epoAPI.util.parseJSON(a.attr("data-builder")))&&(l=Object.assign(d,l)),o.push(l))}),a.push(o)}),r.push({id:"multiple",multiple:a})),r},builder_clone_element:function(e,t,n){var o,l,d,r,s,c=i.epoAPI.template.html(A.tc_builder_elements,{});if(c)return n||(n="append"),t=i(t),(o=i(c).filter(".bitem.element-"+e).tcClone(!0))?(o.find(".tm-builder-element-uniqid").val(a("",!0)),i(".builder-wrapper").length<=0&&(i.tmEPOAdmin.builder_add_section_onClick(),t=i(".builder-wrapper").first()),r=t.index(),t.find(".bitem-wrapper").find(".ditem").length>0?t.find(".bitem-wrapper").find(".ditem").replaceWith(o):("append"===n&&t.find(".bitem-wrapper").not(".tm-hide").append(o),"prepend"===n&&t.find(".bitem-wrapper").not(".tm-hide").prepend(o)),u[r].section.sections.default=parseInt(u[r].section.sections.default,10)+1,u[r].section.sections.default=u[r].section.sections.default.toString(),(l=u[r].section.is_slider)&&(u[r].section.sections_slides.default=t.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(",")),"prepend"!==n&&"append"!==n||(d=i.tmEPOAdmin.find_index(l,o),i.tmEPOAdmin.builderItemsSortableObj.start.section="drag",i.tmEPOAdmin.builderItemsSortableObj.start.section_eq="drag",i.tmEPOAdmin.builderItemsSortableObj.start.element="drag",i.tmEPOAdmin.builderItemsSortableObj.end.section=u[r].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.end.section_eq=t.index().toString(),i.tmEPOAdmin.builderItemsSortableObj.end.element=d.toString()),s=i.tmEPOAdmin.getFieldObject(o),u[r].fields.splice(d,0,s),o.find(".builder-element-wrap").empty(),o.find(".builder_element_type").remove(),o.find(".div_size").remove(),o.find(".tm-internal-name").remove(),i.tmEPOAdmin.check_element_logic(o),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.makeResizables(o),o):void 0},doConfirm:function(e,t,n,a){var o=i.epoAPI.template.html(_.template("tc-floatbox"),{id:"tc-floatbox-content",title:e,html:"",uniqid:"",update:h.i18n_yes,cancel:h.i18n_no}),l=!1;i.tcFloatBox({closefadeouttime:0,overlayopacity:.6,animateOut:"",fps:1,ismodal:!0,refresh:"fixed",width:"50%",height:"auto",classname:"flasho tc-wrapper tc-question",data:o,cancelEvent:function(e){l||(l=!0,e.destroy())},cancelClass:".floatbox-cancel",updateEvent:function(e){l||(l=!0,t.apply(n,a),e.destroy())},updateClass:".floatbox-update",isconfirm:!0})},builder_clone_do:function(){var e,t,n,l,d,r,s,c;t=(e=i(this).closest(".bitem")).data("original_title"),(n=e.tcClone()).data("original_title",t),n&&(e.after(n),s=(c=n.closest(".builder-wrapper")).index(),l=u[s].section.is_slider,d=i.tmEPOAdmin.find_index(l,n),u[s].section.sections.default=parseInt(u[s].section.sections.default,10)+1,u[s].section.sections.default=u[s].section.sections.default.toString(),l&&(u[s].section.sections_slides.default=c.find(".bitem-wrapper").map(function(e,t){return i(t).children(".bitem").not(".pl2").length}).get().join(",")),r=i.tmEPOAdmin.find_index(e,e),u[s].fields.splice(r,0,o(u[s].fields[r])),i.tmEPOAdmin.setFieldValue(s,d,"uniqid",a("",!0),!0),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.builderItemsSortableObj.start.section="clone",i.tmEPOAdmin.builderItemsSortableObj.start.section_eq="clone",i.tmEPOAdmin.builderItemsSortableObj.start.element="clone",i.tmEPOAdmin.builderItemsSortableObj.end.section=u[s].section.sections_uniqid.default,i.tmEPOAdmin.builderItemsSortableObj.end.section_eq=s.toString(),i.tmEPOAdmin.builderItemsSortableObj.end.element=d.toString(),i.tmEPOAdmin.logic_reindex(),i.tmEPOAdmin.makeResizables(n))},builder_clone_onClick:function(e){e.preventDefault(),i.tmEPOAdmin.doConfirm(h.i18n_builder_clone,i.tmEPOAdmin.builder_clone_do,this,[i(this)])},builder_section_clone_do:function(){var e,t,n,l,d;(t=(e=i(this).closest(".builder-wrapper")).tcClone())&&(l=e.index(),n=[],e.find(".bitem").each(function(e,t){n[e]=i(t).data("original_title")}),e.after(t),d=e.index(),u.splice(l,0,o(u[l])),u[d].section.sections_uniqid.default=a("",!0),t.find(".bitem").each(function(e,t){i(t).data("original_title",n[e])}),u[d].section.is_slider&&i.tmEPOAdmin.createSlider(t),i.tmEPOAdmin.builder_reorder_multiple(),i.tmEPOAdmin.builder_items_sortable(t.find(".bitem-wrapper")),i.tmEPOAdmin.check_section_logic(d),i.tmEPOAdmin.check_element_logic(),i.tmEPOAdmin.section_logic_init(d),i.tmEPOAdmin.makeResizables(t),i.tmEPOAdmin.makeResizables(t.find(".bitem")))},builder_section_clone_onClick:function(e){e.preventDefault(),i.tmEPOAdmin.doConfirm(h.i18n_builder_clone,i.tmEPOAdmin.builder_section_clone_do,this,[i(this)])},builder_floatbox_template:function(e,t){return i.epoAPI.template.html(_.template(t||"tc-floatbox"),{id:e.id,title:e.title,html:e.html,uniqidtext:e.uniqidtext||"",uniqid:e.uniqid,update:e.update||h.i18n_update,cancel:e.cancel||h.i18n_cancel})},builder_floatbox_template_import:function(e){return i.epoAPI.template.html(_.template("tc-floatbox-import"),{id:e.id,title:e.title,html:e.html,cancel:h.i18n_cancel})},nameChange:function(e,t){var i=/\[[0-9]+\]\[\]/g,n=/\[[0-9]+\]/g;return null!==e.match(i)?e=e.replace(i,"["+t+"][]"):null!==e.match(n)&&(e=e.replace(n,"["+t+"]")),e},builder_reorder_multiple:function(){var e;[].concat.apply([],u.map(function(e){return e.fields.map(function(e){return e.map(function(e){return"element_type"===e.id?e.default:null}).filter(function(e){return null!==e})[0]})})).filter(function(e,t,i){return i.indexOf(e)===t}).forEach(function(t){var n=0;(e=u.map(function(e){return e.fields.map(function(e){return e.find(function(e){return"element_type"===e.id&&e.default===t})?e:null})})).forEach(function(e,t){e.forEach(function(e,a){var o,l;e&&(void 0!==(o=e.find(function(e,t){return"multiple"===e.id&&(l=t),"multiple"===e.id}))&&"object"==typeof o&&(o=o.multiple).forEach(function(e,o){e.forEach(function(e,d){u[t].fields[a][l].multiple[o][d].tags.name=i.tmEPOAdmin.nameChange(u[t].fields[a][l].multiple[o][d].tags.name,n)})}),n+=1)})})})},getEnhancedSelectFormatString:function(){return{language:{errorLoading:function(){return p.i18n_searching},inputTooLong:function(e){var t=e.input.length-e.maximum;return 1===t?p.i18n_input_too_long_1:p.i18n_input_too_long_n.replace("%qty%",t)},inputTooShort:function(e){var t=e.minimum-e.input.length;return 1===t?p.i18n_input_too_short_1:p.i18n_input_too_short_n.replace("%qty%",t)},loadingMore:function(){return p.i18n_load_more},maximumSelected:function(e){return 1===e.maximum?p.i18n_selection_too_long_1:p.i18n_selection_too_long_n.replace("%qty%",e.maximum)},noResults:function(){return p.i18n_no_matches},searching:function(){return p.i18n_searching}}}},create_products_search:function(t){t.find(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var t,n,a={allowClear:!0,placeholder:i(this).data("placeholder"),dropdownCssClass:"tc-dropdown",minimumInputLength:i(this).data("minimum_input_length")?i(this).data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:p.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:i(this).data("action")||"woocommerce_json_search_products_and_variations",security:p.search_products_nonce,exclude:i(this).data("exclude"),include:i(this).data("include"),limit:i(this).data("limit"),display_stock:i(this).data("display_stock"),tcmode:"builder"}},processResults:function(e){var t=[];return e&&i.each(e,function(e,i){t.push({id:e,text:i})}),{results:t}},cache:!0}};a=i.extend(a,i.tmEPOAdmin.getEnhancedSelectFormatString()),i(this).selectWoo(a).addClass("enhanced"),i(this).on("select2:open",function(){var t=i(e).scrollTop();i(e).scrollTop(t+1),i(e).scrollTop(t)}),i(this).data("sortable")?(t=i(this),(n=i(this).next(".select2-container").find("ul.select2-selection__rendered")).sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){i(n.find(".select2-selection__choice").get().reverse()).each(function(){var e=i(this).data("data").id,n=t.find('option[value="'+e+'"]')[0];t.prepend(n)})}})):i(this).prop("multiple")&&i(this).on("change",function(){var e=i(this).children();e.sort(function(e,t){var i=e.text.toLowerCase(),n=t.text.toLowerCase();return i>n?1:i<n?-1:0}),i(this).html(e)})})},create_categories_search:function(t){t.find(":input.wc-category-search").filter(":not(.enhanced)").each(function(){var t=i.extend({allowClear:!0,placeholder:i(this).data("placeholder"),dropdownCssClass:"tc-dropdown"},i.tmEPOAdmin.getEnhancedSelectFormatString());i(this).selectWoo(t).addClass("enhanced"),i(this).on("select2:open",function(){var t=i(e).scrollTop();i(e).scrollTop(t+1),i(e).scrollTop(t)})})},create_enhanced_dropdown:function(e){e.find(":input.enhanced-dropdown").filter(":not(.enhanced)").each(function(){var e={allowClear:!0,placeholder:i(this).data("placeholder"),dropdownCssClass:"tc-dropdown"};e=i.extend(e,i.tmEPOAdmin.getEnhancedSelectFormatString()),i(this).selectWoo(e).addClass("enhanced")})},create_normal_dropdown:function(e){e.find("select").filter(":not(.enhanced, .enhanced-dropdown, .wc-category-search, .wc-product-search)").not(".builder-logic-div select, .panels_wrap select, .options-wrap select").each(function(){var e={allowClear:!1,minimumResultsForSearch:-1,dropdownCssClass:"tc-dropdown"};e=i.extend(e,i.tmEPOAdmin.getEnhancedSelectFormatString()),i(this).selectWoo(e).addClass("enhanced")})},builder_clone_elements_after_events:function(e){e.find("input.tm-color-picker").spectrum("destroy"),e.find(".sp-replacer").remove(),e.find("input.tm-color-picker").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,showAlpha:!1,showPalette:!1,clickoutFiresChange:!0,showButtons:!1,preferredFormat:"hex",theme:"epo"})},builder_clone_after_events:function(e){i.tmEPOAdmin.builder_clone_elements_after_events(e),i.tmEPOAdmin.panelsSortable(e.find(".panels_wrap")),i.tmEPOAdmin.create_normal_dropdown(e),i.tmEPOAdmin.create_enhanced_dropdown(e),i.tmEPOAdmin.create_products_search(e),i.tmEPOAdmin.create_categories_search(e)},paginattion_init:function(e){var t,n,a,o,l=i("#tc-floatbox-content"),d=l.find(".tcpagination");0!==d.length&&(t=l.find(".panels_wrap"),n=t.find(".options-wrap"),a=parseInt(d.attr("data-perpage"),10),o=Math.ceil(n.length/a),d.data("tc-pagination")&&d.tcPagination("destroy"),e="last"===e?o:"current"===e?d.data("pagination_current")||1:1,d.data("pagination_current",e),d.tcPagination({totalPages:o,startPage:e,visiblePages:10,onPageClick:function(e,t){i.tmEPOAdmin.paginationOnClick(d,t,a,n)}}))},paginationOnClick:function(e,t,i,n){t=parseInt(t,10),e.data("pagination_current",t),n.addClass("tm-hidden"),n.filter(function(e){return e>=i*(t-1)&&i*t-1>=e}).removeClass("tm-hidden")},addTinyMCE:function(e){var t,n,a,o,l,d={theme:"modern",menubar:!1,wpautop:!0,indent:!1,toolbar1:"bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link,unlink",plugins:"fullscreen,image,wordpress,wpeditimage,wplink"},u={buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,fullscreen"},p="object"==typeof r&&void 0!==r.mceInit&&"excerpt"in r.mceInit?r.mceInit.excerpt:d,_="object"==typeof r&&void 0!==r.qtInit&&"excerpt"in r.mceInit?r.qtInit.excerpt:u;i(e)&&void 0!==m&&(o=i("#wp-excerpt-editor-tools").html(),l=i("#wp-excerpt-editor-tools").attr("class"),i(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,d){(n=i(d).attr("id"))||(i(d).attr("id",i(d).attr("name").replace(/[[\]]/g,"")),n=i(d).attr("id")),n&&(t=i.extend({},p,{selector:"#"+n}),a=i.extend({},_,{id:n}),"object"==typeof r&&(r.mceInit[n]=t,r.qtInit[n]=a),i(d).addClass("wp-editor-area").wrap('<div id="wp-'+n+'-wrap" class="wp-core-ui wp-editor-wrap tmce-active tm_editor_wrap"></div>').before('<div class="'+l+'">'+o+"</div>").wrap('<div class="wp-editor-container"></div>'),i(".tm_editor_wrap").find(".wp-switch-editor").each(function(e,t){var a,o,l;i(t).attr("id")&&(o=(a=i(t).attr("id")).length,l=a.substr(o-4),i(t).attr("id",n+"-"+l),i(t).attr("data-wp-editor-id",n))}),i(".tm_editor_wrap").find(".insert-media").attr("data-editor",n),m.init(t),s&&c&&(c(a),s._buttonsInit()),i(d).closest(".tm_editor_wrap").find("a.insert-media").data("editor",n).attr("data-editor",n))}))},removeTinyMCE:function(e){var t,n,a,o="";i(e)&&void 0!==m&&i(e).find("textarea").not(":disabled").not(".tm-no-editor").each(function(e,l){(t=i(l).attr("id"))&&m&&m.editors&&(n=i(l).val(),a=void 0!==m&&m.editors[t]&&!m.editors[t].isHidden(),void 0!==m.editors[t]&&(o=m.editors[t].getContent(),m.editors[t].remove()),i(l).closest(".tm_editor_wrap").find(".quicktags-toolbar,.wp-editor-tools").remove(),i(l).unwrap().unwrap(),a?""===o?i(l).val(""):i(l).val(o):i(l).val(n))})},set_field_title:function(e,t,n){var a,o;0!==e.length&&(o=i.tmEPOAdmin.getFieldValue(u[t].fields[n],"element_type"),void 0===(a=i.tmEPOAdmin.getFieldValue(u[t].fields[n],"header_title","header"!==o))||""===a?e.find(".tm-label").html(h.i18n_no_title):e.find(".tm-label").html(a))},tm_upload_button_remove_onClick:function(){var e=i(this).prevAll("input").first(),t=i(this).nextAll(".tm_upload_image").first().find(".tm_upload_image_img");i(e).val(""),i(t).attr("src","")},variations_display_as:function(e){var t,n,a,o;(t=e?i(this).is(".tm-changes-product-image")?i(this).closest(".tm-attribute").find(".variations-display-as"):i(this):i("#tc-floatbox-content .variations-display-as")).each(function(e,t){var l;n=i(t).closest(".tm-attribute"),a=n.find(".tm-term"),o=n.find(".tm-changes-product-image"),"select"===(l=i(t).val())?n.find(".tma-hide-for-select-box").hide().addClass("tc-row-hidden"):n.find(".tma-hide-for-select-box").show().removeClass("tc-row-hidden"),"image"===l||"color"===l||"radiostart"===l||"radioend"===l?n.find(".tma-show-for-swatches").show().removeClass("tc-row-hidden"):n.find(".tma-show-for-swatches").hide().addClass("tc-row-hidden"),a.each(function(e,t){switch(i(t).hide().find(".tma-term-color,.tma-term-image,.tma-term-custom-image").hide(),l){case"select":case"radio":"images"===o.val()&&o.val(""),o.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===o.val()&&i(t).show().find(".tma-term-custom-image").show();break;case"image":case"radiostart":case"radioend":o.children("option[value='images']").prop("disabled",!1).show(),i(t).show().find(".tma-term-image").show(),"custom"===o.val()&&i(t).show().find(".tma-term-custom-image").show();break;case"color":"images"===o.val()&&o.val(""),o.children("option[value='images']").attr("disabled","disabled").hide(),"custom"===o.val()&&i(t).show().find(".tma-term-custom-image").show(),i(t).show().find(".tma-term-color").show()}})}),(t=i("#tc-floatbox-content")).find(".tm_option_image").not(".tm_option_imagep").each(function(e){t.find(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",i(this).val())}),t.find(".tm_option_imagep").each(function(e){t.find(".tm_upload_image").not(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",i(this).val())})},tm_upload:function(){var e,t,n,a=i("#tc-floatbox-content"),o=a.find(".use_images").not(".tm-changes-product-image"),l=a.find(".use_colors"),d=a.find(".tm-use-images"),r=a.find(".tm-use-colors"),s=a.find(".tm-changes-product-image"),c=a.find(".swatchmode"),m=i("#tc-floatbox-content .tm-show-when-use-images"),u=i("#tc-floatbox-content .tm-show-when-use-color"),p=a.find(".builder-element-wrap").find(".tm_upload_button").not(".tm_upload_buttonp,.tm_upload_buttonl"),_=a.find(".builder-element-wrap").find(".tm_upload_image").not(".tm_upload_imagep,.tm_upload_imagel"),f=a.find(".builder-element-wrap").find(".tm_upload_buttonp"),h=a.find(".builder-element-wrap").find(".tm_upload_imagep"),v=a.find(".builder-element-wrap").find(".tm_upload_buttonl"),b=a.find(".builder-element-wrap").find(".tm_upload_imagel"),g=a.find(".builder-element-wrap").find(".tm_cell_images"),O=a.find(".builder-element-wrap .panels_wrap").find(".sp-replacer");p.hide(),_.hide(),f.hide(),h.hide(),v.hide(),b.hide(),g.hide(),O.hide(),""!==o.val()&&""!==l.val()&&(r.show(),d.show()),""===o.val()&&""===l.val()&&(r.show(),d.show()),""!==o.val()&&""===l.val()&&(r.hide(),d.show()),""===o.val()&&""!==l.val()&&(r.show(),d.hide()),"images"===s.val()&&""===o.val()&&(e=a.find(".tm_option_image").not(".tm_option_imagep"),t=a.find(".tm_option_imagep"),n=a.find(".tm_upload_imagep .tm_upload_image_img"),s.val("custom"),e.each(function(e){t.eq(e).val(i(this).val()),n.attr("src",i(this).val())})),o.length&&"images"===o.val()?s.find("option[value='images']").prop("disabled",!1).show():("images"===s.val()&&s.val(""),s.find("option[value='images']").attr("disabled","disabled").hide()),setTimeout(function(){s.selectWoo("destroy").removeClass("enhanced"),i.tmEPOAdmin.create_normal_dropdown(s.parent()),s.trigger("change.select2")},100),("images"===o.val()||"start"===o.val()||"end"===o.val()||"images"===o.val()&&"images"===s.val())&&(p.show(),_.show(),g.show()),"custom"===s.val()&&(f.show(),h.show(),g.show()),""!==o.val()?(m.show(),i("#tc-floatbox-content .tm-use-lightbox").is(":checked")&&(v.show(),b.show())):m.hide(),"color"===l.val()?(u.show(),"swatch_img"!==c.val()&&"swatch_img_lbl"!==c.val()&&"swatch_img_desc"!==c.val()&&"swatch_img_lbl_desc"!==c.val()||c.val(""),c.find("option[value='swatch_img']").attr("disabled","disabled").hide(),c.find("option[value='swatch_img_lbl']").attr("disabled","disabled").hide(),c.find("option[value='swatch_img_desc']").attr("disabled","disabled").hide(),c.find("option[value='swatch_img_lbl_desc']").attr("disabled","disabled").hide()):(c.find("option[value='swatch_img']").prop("disabled",!1).show(),c.find("option[value='swatch_img_lbl']").prop("disabled",!1).show(),c.find("option[value='swatch_img_desc']").prop("disabled",!1).show(),c.find("option[value='swatch_img_lbl_desc']").prop("disabled",!1).show(),"images"!==o.val()&&u.hide()),"color"!==l.val()&&"start"!==l.val()&&"end"!==l.val()||(g.show(),O.show()),a.find(".tm_option_image").not(".tm_option_imagec, .tm_option_imagep, .tm_option_imagel").each(function(e){a.find(".tm_upload_image").not(".tm_upload_imagec, .tm_upload_imagep, .tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",i(this).val())}),a.find(".tm_option_imagec").each(function(e){a.find(".tm_upload_imagec").eq(e).find(".tm_upload_image_img").attr("src",i(this).val())}),a.find(".tm_option_imagep").each(function(e){a.find(".tm_upload_imagep").eq(e).find(".tm_upload_image_img").attr("src",i(this).val())}),a.find(".tm_option_imagel").each(function(e){a.find(".tm_upload_imagel").eq(e).find(".tm_upload_image_img").attr("src",i(this).val())})},tm_weekdays:function(e){i(e?e:"body").find(".tm-weekdays").each(function(e,t){var n=i(t).val().split(","),a=i(t).next(".tm-weekdays-picker-wrap");i(a).find(".tm-weekday-picker").each(function(e,t){-1!==n.indexOf(i(t).val())?(i(t).attr("checked","checked").prop("checked",!0),i(t).closest(".tm-weekdays-picker").addClass("tm-checked")):(i(t).prop("checked",!1),i(t).closest(".tm-weekdays-picker").removeClass("tm-checked"))})})},tm_weekday_picker:function(){var e=i(this).closest(".tm-weekdays-picker-wrap").prev(".tm-weekdays"),t=i(e).val().split(","),n=t.indexOf(i(this).val());i(this).is(":checked")?-1===n&&t.push(i(this).val()):-1!==n&&t.splice(n,1),t=i.map(t,function(e){return""===e?null:e}),i(e).val(t.join(",")),i.tmEPOAdmin.tm_weekdays(i(e).parent())},tm_months:function(e){i(e?e:"body").find(".tm-months").each(function(e,t){var n=i(t).val().split(","),a=i(t).next(".tm-months-picker-wrap");i(a).find(".tm-month-picker").each(function(e,t){-1!==n.indexOf(i(t).val())?(i(t).attr("checked","checked").prop("checked",!0),i(t).closest(".tm-months-picker").addClass("tm-checked")):(i(t).prop("checked",!1),i(t).closest(".tm-months-picker").removeClass("tm-checked"))})})},tm_month_picker:function(){var e=i(this).closest(".tm-months-picker-wrap").prev(".tm-months"),t=i(e).val().split(","),n=t.indexOf(i(this).val());i(this).is(":checked")?-1===n&&t.push(i(this).val()):-1!==n&&t.splice(n,1),t=i.map(t,function(e){return""===e?null:e}),i(e).val(t.join(",")),i.tmEPOAdmin.tm_months(i(e).parent())},tm_pricetype_selector:function(e){"math"===i(e?this:"#tc-floatbox-content .tm-pricetype-selector").val()?i(".tc-element-setting-price, .tc-element-setting-sale-price").attr("autocomplete","off"):i(".tc-element-setting-price, .tc-element-setting-sale-price").removeAttr("autocomplete")},tm_option_price_type:function(e){"math"===i(e?this:"#tc-floatbox-content .tm_option_price_type").val()?i(".tm_option_price, .tm_option_sale_price").attr("autocomplete","off"):i(".tm_option_price, .tm_option_sale_price").removeAttr("autocomplete")},tm_url:function(e){var t=i("#tc-floatbox-content"),n=i(this),a=t.find(".builder-element-wrap").find(".tc-cell-url");e||(n=i("#tc-floatbox-content .use_url")),"url"===n.val()?a.show():a.hide()},upload:function(e){var t,n,a,o;if(e.preventDefault(),!_||!_.media)return!1;t=i(this).prev("input"),n=i(this).nextAll(".tm_upload_image").first().find("img"),t.data("tm_upload_frame")?t.data("tm_upload_frame").open():(a=_.media.controller.Library.extend({defaults:b.defaults({id:"insert-image",title:"Insert Image Url",allowLocalEdits:!0,displaySettings:!0,displayUserSettings:!0,multiple:!0,type:"image"},_.media.controller.Library.prototype.defaults)}),(o=_.media({button:{text:"Select"},state:"insert-image",states:[new a]})).on("close",function(){}),o.on("select",function(){var e=o.state("insert-image"),i=e.get("selection");i&&(n.attr("src",""),t.val(""),i.each(function(i){var a,o=e.display(i).toJSON(),l=i.toJSON(),d=l.caption;_.media.view.settings.captions||delete l.caption,o=_.media.string.props(o,l),a={id:l.id,post_content:l.description,post_excerpt:d},o.linkUrl&&(a.url=o.linkUrl),"image"===l.type?(b.each({align:"align",size:"image-size",alt:"image_alt"},function(e,t){o[t]&&(a[e]=o[t])}),a["image-size"]&&i.attributes.sizes[a["image-size"]]&&(a.url=i.attributes.sizes[a["image-size"]].url)):a.post_title=o.title,n.attr("src",a.url),t.val(a.url)}))}),o.on("open",function(){var e=o.state().get("library").toJSON(),n=!0;i.each(e,function(e,a){var l;a.url===t.val()?(l=_.media.attachment(a.id),o.state().get("selection").add(l?[l]:[]),i(".attachment-display-settings").find("select.size").val("full"),n=!1):a.sizes&&i.each(a.sizes,function(e,d){d.url===t.val()&&(l=_.media.attachment(a.id),o.state().get("selection").add(l?[l]:[]),i(".attachment-display-settings").find("select.size").val(e),n=!1)}),n&&i(".attachment-display-settings").find("select.size").val("full")})}),t.data("tm_upload_frame",o),o.open())},populatePriceVariables:function(e){var t,n,a,l,d=o(u.map(function(e,t){return e.fields.map(function(e,i){var n,a=e.find(function(e){return"element_type"===e.id});return a.default&&(a=a.default),(n=e.filter(function(e){return null!==e}).find(function(e){return e.id===a+"_uniqid"}))&&(n=n.default),{sectionIndex:t,fieldIndex:i,uniqid:n,type:a}})})),r=i(".tm-element-uniqid").attr("data-uniqid");t=i('<h4 class="tc-var-header">'+h.i18n_formula_global_variables+"</h4>"),e.append(t),t=i('<ul class="tc-var-list"></ul>'),e.append(t),t.append('<li class="tc-var-field" data-value="{quantity}"><span>'+h.i18n_formula_quantity+"</span></li>"),t.append('<li class="tc-var-field" data-value="{product_price}"><span>'+h.i18n_formula_product_price+"</span></li>"),t=i('<h4 class="tc-var-header">'+h.i18n_formula_this_element+"</h4>"),e.append(t),t=i('<ul class="tc-var-list"></ul>'),e.append(t),t.append('<li class="tc-var-field" data-value="{this.value}"><span>'+h.i18n_formula_this_value+"</span></li>"),t.append('<li class="tc-var-field" data-value="{this.value.length}"><span>'+h.i18n_formula_this_value_length+"</span></li>"),t.append('<li class="tc-var-field" data-value="{this.count}"><span>'+h.i18n_formula_this_count+"</span></li>"),t.append('<li class="tc-var-field" data-value="{this.count.quantity}"><span>'+h.i18n_formula_this_count_quantity+"</span></li>"),t.append('<li class="tc-var-field" data-value="{this.quantity}"><span>'+h.i18n_formula_this_quantity+"</span></li>"),d.length&&(t=i('<h4 class="tc-var-header">'+h.i18n_formula_other_elements+"</h4>"),e.append(t),t=i('<div class="tc-clearfix tm-epo-switch-wrapper"><div class="formula-field-mode-selector"><input checked="checked" name="formulamode" class="formula-field-mode" id="formulafieldmode0" value="price" type="radio" ><label for="formulafieldmode0"><span class="tc-radio-text">'+h.i18n_formula_field_price+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode1" value="value" type="radio" ><label for="formulafieldmode1"><span class="tc-radio-text">'+h.i18n_formula_field_value+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode2"  value="quantity" type="radio" ><label for="formulafieldmode2"><span class="tc-radio-text">'+h.i18n_formula_field_quantity+'</span></label><input name="formulamode" class="formula-field-mode" id="formulafieldmode3" value="count" type="radio" ><label for="formulafieldmode3"><span class="tc-radio-text">'+h.i18n_formula_field_count+"</span></label></div></div>"),e.append(t),t=i('<ul class="tc-var-list other"></ul>'),e.append(t),d.forEach(function(e){e.forEach(function(e){e.uniqid!==r&&void 0!==e.uniqid&&(a=i.tmEPOAdmin.getFieldValue(u[e.sectionIndex].fields[e.fieldIndex],"internal_name",e.type),l=i.tmEPOAdmin.getFieldValue(u[e.sectionIndex].fields[e.fieldIndex],"header_title",e.type),"product"!==e.type&&(void 0===l&&(l=""),""!==l&&(l=" ("+l+")"),n=a+l,t.append('<li title="'+e.uniqid+'" class="tc-var-field" data-value="{field.'+e.uniqid+'.price}"><span>'+n+"</span></li>")))})}))}},i(function(){A=i.epoAPI.applyFilter("tc_adjust_admin_template_engine",A),d=e.woocommerce_admin,r=e.tinyMCEPreInit,s=e.QTags,c=e.quicktags,m=e.tinyMCE,l=e.TMEPOOPTIONSJS.data,p=e.wc_enhanced_select_params,void 0!==(u=o(l))&&u||(u=[]),i.tmEPOAdmin.initialitize(),i.tcToolTip(),f&&i(".tc-admin-extra-product-options_tab").on("click.cpf",function(){i.tmEPOAdmin.makeResizables(i(".builder-wrapper")),i.tmEPOAdmin.makeResizables(i(".bitem")),i(this).off("click.cpf")})})}(window,document,window.jQuery);