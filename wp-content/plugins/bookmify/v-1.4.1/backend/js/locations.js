!function(o){"use strict";var e={cloneForm:o(".bookmify_be_content .bookmify_be_popup_form_wrap").clone(),page:1},i=bookmifyConfig,t={iaoAlertTime:"5000",iaoAlertPosition:"bottom-right",alertSuccessIcon:'<span class="icon_holder success"><i class="xcon-ok"></i></span>',deletedText:'<span class="text">'+i.deletedText+"</span>",savedText:'<span class="text">'+i.savedText+"</span>",addedText:'<span class="text">'+i.addedText+"</span>",errorField:'<span class="error_note">'+i.errorField+"</span>",ajaxurl:i.ajaxUrl,cacheElements:function(){this.cache={wrap:o(".bookmify_be_locations"),list:o(".bookmify_be_locations .location_list"),listItems:o(".bookmify_be_locations .location_item"),listItemsContents:o(".bookmify_be_locations .location_item .bookmify_be_list_item_content"),buttonAdd:o(".bookmify_be_add_new_location a.add_new"),buttonDelete:o(".bookmify_be_locations .location_item .buttons_holder .btn_item .bookmify_be_delete"),buttonSave:o(".bookmify_be_locations .location_item .locations_buttons_holder a"),buttonOpener:o(".bookmify_be_locations .location_item .buttons_holder .btn_item .bookmify_be_edit"),buttonCloser:o(".bookmify_be_locations .location_item .closer_button a"),buttonMediaUploader:o(".bookmify_be_locations .bookmify_thumb_edit"),buttonPagination:o(".bookmify_be_pagination.location li a"),allInputs:o('input[type="text"]')}},init:function(){o(".bookmify_be_locations").length&&o(".bookmify_be_content .bookmify_be_popup_form_wrap").remove(),this.cacheElements(),this.allNanoAppendToBody(),this.closeInputDropdown(),this.closeInputDropdownOnAction(),this.ajaxPagination(),this.deleteLocation(),this.openerLocation(),this.insertLocation(),this.imgToSvg()},allNanoAppendToBody:function(){var e=o(".bookmify_be_all_nano.location"),i=e.html();o("body").append(i),e.remove()},imgToSvg:function(){o("img.bookmify_be_svg").each(function(){var e=o(this),i=e.attr("class"),t=e.attr("src");o.get(t,function(t){var n=o(t).find("svg");void 0!==i&&(n=n.attr("class",i+" replaced-svg")),n=n.removeAttr("xmlns:a"),e.replaceWith(n)},"xml")})},closerButton:function(){var e=this;o(".bookmify_be_popup_form_wrap.enable").find("span.closer").on("click",function(){e.closePopupForm()})},closerEsc:function(){o(document).keyup(function(o){o.key})},closersPopup:function(){this.closerEsc(),this.closerButton()},closePopupForm:function(){o(".nano").removeClass("focused"),o("input").removeClass("input_clicked");var e=o(".bookmify_be_popup_form_wrap.enable");o("body").removeClass("disable_scroll"),e.removeClass("enable"),setTimeout(function(){e.remove()},300)},cancelItem:function(){var e=this;o(".bookmify_be_popup_form_button a.cancel").off().on("click",function(){return e.closePopupForm(),!1})},closeInputDropdown:function(){o(".nano").removeClass("focused"),o('input[type="text"]').removeClass("input_clicked")},closeInputDropdownOnAction:function(){var e=this;o(".bookmify_be_customfields").on("click",function(){e.closeInputDropdown()})},openerLocation:function(){var e=this;e.cache.buttonOpener.off().on("click",function(i){i.preventDefault();var t=o(this),n=t.closest(".bookmify_be_list_item"),a={action:"ajaxQueryEditLocation",bookmify_data:n.data("location-id")};return t.hasClass("loading")||(t.addClass("loading"),n.addClass("loading"),o.ajax({type:"POST",url:e.ajaxurl,cache:!0,data:a,success:function(o){t.removeClass("loading"),n.removeClass("loading"),e.getRequestedLocationPopup(o)},error:function(){}})),!1})},getRequestedLocationPopup:function(e){var i=o.parseJSON(e).bookmify_be_data;o("body").addClass("disable_scroll").append(i),o("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_location"),this.imgToSvg(),this.mediaUpload(),this.madeInputDropdown(),this.saveLocation(),this.cancelItem(),o("body > .bookmify_be_popup_form_wrap").addClass("enable"),this.closersPopup()},deleteLocation:function(){var e=this;e.cache.buttonDelete.off().on("click",function(i){i.preventDefault();var t=o(this),n=t.parents(".location_item"),a=n.data("location-id");return t.addClass("clicked"),e.deleteLocationConfirm(n,a,t),e.closeInputDropdown(),!1})},deleteLocationConfirm:function(i,t,n){var a=this,s=o("#bookmify_be_confirm");s.addClass("opened location_confirm");var c=o("#bookmify_be_confirm.location_confirm").find("a.yes"),l=o("#bookmify_be_confirm.location_confirm").find("a.no");c.off().on("click",function(c){c.preventDefault(),n.removeClass("clicked"),n.addClass("await"),n.addClass("loading"),i.addClass("loading");var l={action:"ajaxQueryDeleteLocation",bookmify_data:t,bookmify_page:e.page};return o.ajax({type:"POST",url:a.ajaxurl,cache:!0,data:l,success:function(e){var i=o.parseJSON(e),t=o(".bookmify_be_page_title h3 span.count"),n=o(".bookmify_be_locations_list");n.html(i.bookmify_be_data),t.html(i.number);var s=n.find(".location_list .location_item");setTimeout(function(){s.each(function(e,i){setTimeout(function(){o(i).addClass("fadeInTop done")},100*e)})},150),a.init(),o.iaoAlert({msg:a.alertSuccessIcon+a.deletedText,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition})}}),s.removeClass("opened location_confirm"),!1}),l.on("click",function(){return s.removeClass(),n.removeClass("clicked"),!1}),o(document).keydown(function(o){if(27===o.keyCode)return s.removeClass(),n.removeClass("clicked"),!1})},saveLocation:function(){var i=o(".bookmify_be_popup_form_location .bookmify_be_popup_form_button a.save"),t=this;i.off().on("click",function(){var i=o(this),n=i.closest(".bookmify_be_popup_form_location"),a="insert",s=0;if(n.find(".required_field").each(function(){var e=o(this);""===e.val()&&(e.parent().find(".error_note").remove(),e.parent().addClass("required_error").append(t.errorField),s++)}),0!==s)return t.scrollToTop(500),!1;i.addClass("await");var c=n.data("entity-id"),l=[],r={};r.id=c,r.title=n.find(".bookmify_be_form_wrap .location_name").val(),r.address=n.find(".bookmify_be_form_wrap .location_address").val(),r.info=n.find(".bookmify_be_form_wrap .location_info").val(),r.imgID=n.find(".bookmify_be_form_wrap .bookmify_be_img_id").val(),r.employeesIDs=n.find(".bookmify_be_form_wrap .location_employees_ids").val(),l.push(r),c&&(a="update");var p={action:"ajaxQueryInsertOrUpdateLocation",bookmify_data:JSON.stringify(l),insertOrUpdate:a,bookmify_page:e.page,do:1};return o.ajax({type:"POST",url:t.ajaxurl,cache:!0,data:p,success:function(o){i.removeClass("await"),t.getUpdatedLocationsList(o,a)},error:function(){}}),!1}),o(".bookmify_be_popup_form_location input.required_field").keyup(function(){var e=o(this);""!==e.val()&&e.parent().hasClass("required_error")&&(e.parent().removeClass("required_error"),e.parent().find(".error_note").remove())})},getUpdatedLocationsList:function(e,i){var t=this,n=o.parseJSON(e),a=o(".bookmify_be_locations_list"),s=o(".bookmify_be_page_title h3 span.count");t.closePopupForm(),"update"===i?setTimeout(function(){o.iaoAlert({msg:t.alertSuccessIcon+t.savedText,type:"success",alertTime:t.iaoAlertTime,position:t.iaoAlertPosition})},301):setTimeout(function(){o.iaoAlert({msg:t.alertSuccessIcon+t.addedText,type:"success",alertTime:t.iaoAlertTime,position:t.iaoAlertPosition})},301),a.html(n.bookmify_be_data),s.html(n.number);var c=a.find(".location_list .location_item");setTimeout(function(){c.each(function(e,i){setTimeout(function(){o(i).addClass("fadeInTop done")},100*e)})},150),t.init()},insertLocation:function(){var i=this;o(".bookmify_be_add_new_location a").off().on("click",function(){var t=e.cloneForm.clone();return o("body").addClass("disable_scroll").append(t),o("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_location"),i.imgToSvg(),i.mediaUpload(),i.madeInputDropdown(),i.saveLocation(),i.cancelItem(),o("body > .bookmify_be_popup_form_wrap").addClass("enable"),i.closersPopup(),!1})},mediaUpload:function(){o("body > .bookmify_be_popup_form_wrap .bookmify_thumb_edit").off().on("click",function(e){e.preventDefault(),e.stopPropagation(),o(".nano").removeClass("focused"),o("input").removeClass("input_clicked");var i=o(this).closest(".input_img"),t=i.find('input[class="bookmify_be_img_id"]'),n=i.find(".bookmify_thumb_wrap"),a=i.find(".bookmify_thumb_remove"),s="",c=wp.media({library:{type:"image"},multiple:!1});return c.on("select",function(){var e=c.state().get("selection").toJSON();e.length&&(void 0!==e[0].sizes.thumbnail?e[0].sizes.thumbnail.url:e[0].url,s=void 0!==e[0].sizes.large?e[0].sizes.large.url:e[0].url,t.val(e[0].id),n.addClass("has_image").css({"background-image":"url("+s+")"}),o(this).hide(),a.show())}),c.open(),!1}),o("body > .bookmify_be_popup_form_wrap .bookmify_thumb_remove a").off().on("click",function(e){e.preventDefault(),e.stopPropagation();var i=o(this).closest(".input_img"),t=i.find('input[class="bookmify_be_img_id"]'),n=i.find(".bookmify_thumb_wrap");return t.val(""),n.removeClass("has_image").css({"background-image":"none"}),o(this).parent().hide(),!1})},ajaxPagination:function(){var i=this;i.cache.buttonPagination.off().on("click",function(t){t.preventDefault(),o(".nano").removeClass("focused"),o("input").removeClass("input_clicked");var n=o(this),a=n.parent();e.page=n.data("page");var s=0;return a.hasClass("prev")?(e.page=n.parent().parent().find("li.active a").data("page")-1,s=1):a.hasClass("next")&&(e.page=n.parent().parent().find("li.active a").data("page")+1,s=1),a.hasClass("active")||i.doAjaxCallPagination(),1===s&&i.doAjaxCallPagination(),i.cache.list.addClass("loading"),o([document.documentElement,document.body]).animate({scrollTop:o(".bookmify_be_content").offset().top-32},300),!1})},doAjaxCallPagination:function(){var i=this,t={action:"locationsListAjax",bookmify_page:e.page};o.ajax({type:"POST",url:i.ajaxurl,cache:!0,data:t,success:function(o){i.paginationAjaxProcess(o)},error:function(){}})},paginationAjaxProcess:function(e){var i=o.parseJSON(e),t=o(".bookmify_be_locations_list");t.html(i.bookmify_be_data),this.cache.list.removeClass("loading");var n=t.find(".location_item");setTimeout(function(){n.each(function(e,i){setTimeout(function(){o(i).addClass("fadeInTop done")},100*e)})},150),this.init()},madeInputDropdown:function(){var e=o(".nano.location_employees"),i=o('.bookmify_be_popup_form_location .location_employees_holder input[type="text"]'),t=e.find('input[type="checkbox"]');function n(e){var i=e,n=i.attr("data-placeholder"),a=i.siblings(".bot_btn");a.off().on("click",function(){i.siblings(".location_employees_ids").val(""),i.siblings(".bookmify_be_new_value").html(""),t.prop("checked",!1),i.attr("placeholder",n),a.removeClass("opened"),o(".nano").removeClass("focused"),o("input").removeClass("input_clicked")})}function a(o){var e=o,i=e.siblings("input.location_employees_ids"),t=e.siblings(".bot_btn");" "===i.val()||""===i.val()?t.removeClass("opened"):t.addClass("opened")}i.each(function(){var e=o(this);a(e),n(e)}),i.on("click",function(i){i.stopPropagation();var s=o(this),c=s.closest(".bookmify_be_popup_form_location").data("entity-id"),l=s.siblings(".location_employees_ids").val().split(","),r=1;t.prop("checked",!1),e.attr("data-id",c),o.each(l,function(o,i){r++,e.find('input[type="checkbox"][value="'+i+'"]').prop("checked",!0)}),t.length===r&&(e.find(".bookmify_be_check_all_items").prop("checked",!0),e.find("li").addClass("checked"));var p=o(".nano.location_employees");if(s.hasClass("input_clicked"))o(".nano").removeClass("focused"),o("input").removeClass("input_clicked");else{o(".nano").removeClass("focused"),o("input").removeClass("input_clicked"),s.addClass("input_clicked"),p.addClass("focused"),p.css({width:s.outerWidth()+"px"});new Popper(s,p,{placement:"bottom-start",onUpdate:function(){p.css({width:s.outerWidth()+"px"})}})}!function(i){e.find("ul.employees_list li").off().on("click",function(){var s,c,l,r=o(this).index(),p=o(this).find('input[type="checkbox"]');p.is(":checked")?0===r?t.prop("checked",!1):(p.prop("checked",!1),e.find('ul.employees_list li:first input[type="checkbox"]').prop("checked",!1)):0===r?t.prop("checked",!0):(p.prop("checked",!0),e.find('ul.employees_list li:first input[type="checkbox"]').prop("checked",!1)),a(i),function(i){var t=[];e.find("ul.employees_list li").each(function(){var e=o(this),i=e.find(".bookmify_be_check_item").val();0!==e.index()&&(e.find('input[type="checkbox"]').is(":checked")?(t=o.grep(t,function(o){return o!==i}),e.addClass("checked"),t.push(e.find(".bookmify_be_check_item").val())):(e.removeClass("checked"),t=o.grep(t,function(o){return o!==i})))});var s=i.attr("data-placeholder");if(o.isEmptyObject(t))i.attr("placeholder",s),i.siblings(".bookmify_be_new_value").html("");else{var c="";if(i.attr("placeholder",""),t.length>1){var l=e.find("ul.employees_list li").length-1;c='<span class="number">'+t.length+" / "+l+"</span>"}var r='<span class="text">'+e.find("input[value="+t[0]+"]").closest("li").find("span.name").html()+"</span>";i.siblings(".bookmify_be_new_value").html("").html(r+c)}i.parent().find("input.location_employees_ids").val("").val(t),a(i),n(i)}(i),n(i),s=e.find(".employees_list li").not(":first").find('input[type="checkbox"]'),c=e.find(".employees_list li").not(":first").find('input[type="checkbox"]:checked'),l=e.find('.employees_list li:first input[type="checkbox"]'),c.length===s.length?l.prop("checked",!0):l.prop("checked",!1)})}(s)}),o(window).on("click",function(){o(".nano").removeClass("focused"),o("input").removeClass("input_clicked")}),o(".nano.location_employees").on("click",function(o){o.stopPropagation()}),e.on("click",function(o){o.stopPropagation()}),n(i)},scrollToTop:function(e){o(".bookmify_be_popup_form_wrap").animate({scrollTop:0},e)}};o(function(){t.init()})}(jQuery);