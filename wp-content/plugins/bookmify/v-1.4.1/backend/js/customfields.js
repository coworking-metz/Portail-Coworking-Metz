!function(e){"use strict";var o={cloneForm:e(".bookmify_be_content .bookmify_be_popup_form_wrap").clone()},i=bookmifyConfig,t={iaoAlertTime:"5000",iaoAlertPosition:"bottom-right",alertSuccessIcon:'<span class="icon_holder success"><i class="xcon-ok"></i></span>',deletedText:'<span class="text">'+i.deletedTextCF+"</span>",savedText:'<span class="text">'+i.savedTextCF+"</span>",addedText:'<span class="text">'+i.addedTextCF+"</span>",reorderedText:'<span class="text">'+i.reorderedTextCF+"</span>",errorField:'<span class="error_note">'+i.errorField+"</span>",ajaxurl:i.ajaxUrl,init:function(){e(".bookmify_be_customfields").length&&e(".bookmify_be_content .bookmify_be_popup_form_wrap").remove(),t.removeNanoDropdown(),t.removeNanoDropdownOnAction(),t.allNanoAppendToBody(),t.imgToSvg(),t.insertCF(),t.openerCF(),t.deleteCF(),t.reorderCF(),e.protip()},allNanoAppendToBody:function(){var o=e(".bookmify_be_all_nano.customfield"),i=o.html();e("body").append(i),o.remove()},removeNanoDropdown:function(){e(".nano").removeClass("focused"),e('input[type="text"]').removeClass("input_clicked")},removeNanoDropdownOnAction:function(){e(".bookmify_be_customfields").on("click",function(){t.removeNanoDropdown()})},openerCF:function(){var o=this;e(".bookmify_be_list.cfs_list .bookmify_be_edit").off().on("click",function(i){i.preventDefault();var t=e(this),n=t.closest(".bookmify_be_list_item"),s={action:"ajaxQueryEditCF",bookmify_data:n.data("cf-id")};return t.hasClass("loading")||(t.addClass("loading"),n.addClass("loading"),e.ajax({type:"POST",url:o.ajaxurl,cache:!0,data:s,success:function(e){t.removeClass("loading"),n.removeClass("loading"),o.getRequestedCFPopup(e)},error:function(){}})),!1})},getRequestedCFPopup:function(o){var i=this,t=e.parseJSON(o).bookmify_be_data;e("body").addClass("disable_scroll").append(t),e("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_customfields"),i.imgToSvg(),i.addCFOption(),i.deleteCFOption(),i.servicePopperCF(),i.reorderCFOptions(),i.saveCF(),i.cancelItem(),setTimeout(function(){e("body > .bookmify_be_popup_form_wrap").addClass("enable"),i.closersPopup()},10)},imgToSvg:function(){e("img.bookmify_be_svg").each(function(){var o=e(this),i=o.attr("class"),t=o.attr("src");e.get(t,function(t){var n=e(t).find("svg");void 0!==i&&(n=n.attr("class",i+" replaced-svg")),n=n.removeAttr("xmlns:a"),o.replaceWith(n)},"xml")})},closerButton:function(){var o=this;e(".bookmify_be_popup_form_wrap.enable").find("span.closer").on("click",function(){o.closePopupForm()})},closerEsc:function(){e(document).keyup(function(e){e.key})},closersPopup:function(){this.closerEsc(),this.closerButton()},closePopupForm:function(){e(".nano").removeClass("focused"),e("input").removeClass("input_clicked");var o=e(".bookmify_be_popup_form_wrap.enable");e("body").removeClass("disable_scroll"),o.removeClass("enable"),setTimeout(function(){o.remove()},300)},cancelItem:function(){var o=this;e(".bookmify_be_popup_form_button a.cancel").off().on("click",function(){return o.closePopupForm(),!1})},insertCF:function(){var i=this;e(".bookmify_be_cf_type_buttons").find("a.add").off().on("click",function(){var t=e(this).data("field-type"),n=o.cloneForm.clone();e("body").addClass("disable_scroll").append(n);var s=e("body > .bookmify_be_popup_form_wrap");s.attr("data-entity-type",t).addClass("bookmify_be_popup_form_customfields");var a="label_only",r="no",c="no",l="yes",d="no",p="no",f="no",u="no",_="no",m="no";switch(t){case"checkbox":d="yes",a="",r="yes";break;case"radiobuttons":p="yes",a="",r="yes";break;case"selectbox":f="yes",a="",r="yes";break;case"text":u="yes";break;case"textarea":_="yes";break;case"textcontent":m="yes",c="yes",l="no"}return"no"===r&&s.find(".bottom").remove(),"label_only"===a?s.find(".label_options").remove():s.find(".label_only").remove(),"no"===c?s.find(".label_wrap.textarea").remove():s.find(".label_wrap.text").remove(),"no"===l&&s.find(".required_wrap").remove(),"no"===d&&s.find("h3 span.heading_checkbox").remove(),"no"===p&&s.find("h3 span.heading_radiobuttons").remove(),"no"===f&&s.find("h3 span.heading_selectbox").remove(),"no"===u&&s.find("h3 span.heading_text").remove(),"no"===_&&s.find("h3 span.heading_textarea").remove(),"no"===m&&s.find("h3 span.heading_textcontent").remove(),i.imgToSvg(),i.addCFOption(),i.deleteCFOption(),i.servicePopperCF(),i.reorderCFOptions(),i.saveCF(),i.cancelItem(),setTimeout(function(){s.addClass("enable"),i.closersPopup()},10),!1})},deleteCF:function(){e(".bookmify_be_customfields .cfs_item .bookmify_be_delete").off().on("click",function(o){o.preventDefault();var i=e(this),n=i.parents(".cfs_item"),s=n.data("cf-id");return i.addClass("clicked"),t.deleteCFConfirm(n,s,i),t.removeNanoDropdown(),!1})},deleteCFConfirm:function(o,i,n){var s=e("#bookmify_be_confirm");s.addClass("opened cf_confirm");var a=e("#bookmify_be_confirm.cf_confirm").find("a.yes"),r=e("#bookmify_be_confirm.cf_confirm").find("a.no"),c=this;a.off().on("click",function(a){a.preventDefault(),n.removeClass("clicked"),n.addClass("await"),o.addClass("loading");var r={action:"ajaxQueryDeleteCF",bookmify_data:i};return e.ajax({type:"POST",url:t.ajaxurl,cache:!0,data:r,success:function(i){var t=e.parseJSON(i);e(".bookmify_be_page_title h3 span.count").html(t.number),n.removeClass("await"),o.removeClass("opened").slideUp(300),o.parent().removeClass("opened"),setTimeout(function(){o.remove()},301),e.iaoAlert({msg:c.alertSuccessIcon+c.deletedText,type:"success",alertTime:c.iaoAlertTime,position:c.iaoAlertPosition})}}),s.removeClass("opened cf_confirm"),!1}),r.on("click",function(){return s.removeClass(),n.removeClass("clicked"),!1}),e(document).keydown(function(e){if(27===e.keyCode)return s.removeClass(),n.removeClass("clicked"),!1})},scrollToTop:function(o){e(".bookmify_be_popup_form_wrap").animate({scrollTop:0},o)},saveCF:function(){var o=e(".bookmify_be_popup_form_customfields a.save"),i=this;o.off().on("click",function(o){o.preventDefault();var n=e(this),s=n.closest(".bookmify_be_popup_form_customfields"),a=0;if(s.find(".required_field").each(function(){var o=e(this);""===o.val()&&(o.parent().find(".error_note").remove(),o.parent().addClass("required_error").append(i.errorField),a++)}),0!==a)return i.scrollToTop(500),!1;n.addClass("await");var r=s.data("entity-id"),c=s.data("entity-type"),l="update",d=[],p={};switch(c){case"checkbox":case"radiobuttons":case"selectbox":p.options=[],s.find(".bookmify_be_options_list .bookmify_be_options_list_item").each(function(){p.options.push(e(this).find(".label_wrap input").val())})}p.id=r,p.type=c,p.label=s.find(".top .label_wrap .cf_label").val(),p.req=s.find(".top .required_wrap input:checked").val(),p.ser=s.find(".cf_services_ids").val(),d.push(p),r&&void 0!==r||(l="insert");var f={action:"ajaxQueryInsertOrUpdateCF",bookmify_data:JSON.stringify(d),insertOrUpdate:l};return e.ajax({type:"POST",url:t.ajaxurl,cache:!0,data:f,success:function(e){t.saveCFAjaxProcess(e,l),n.removeClass("await")}}),t.removeNanoDropdown(),!1}),e(".bookmify_be_popup_form_customfields .required_field").keyup(function(){var o=e(this);""!==o.val()&&o.parent().hasClass("required_error")&&(o.parent().removeClass("required_error"),o.parent().find(".error_note").remove())})},saveCFAjaxProcess:function(o,i){var t=this,n=e.parseJSON(o),s=e(".bookmify_be_customfields_list"),a=e(".bookmify_be_page_title h3 span.count");t.closePopupForm(),setTimeout(function(){e.iaoAlert({msg:t.alertSuccessIcon+t.savedText,type:"success",alertTime:t.iaoAlertTime,position:t.iaoAlertPosition})},301),s.html(n.bookmify_be_data),a.html(n.number);var r=s.find(".cfs_list .cfs_item");setTimeout(function(){r.each(function(o,i){setTimeout(function(){e(i).addClass("fadeInTop done")},100*o)})},150),t.init()},reorderCF:function(){e(".bookmify_be_customfields .cfs_list").sortable({opacity:.7,cursor:"move",axis:"y",handle:".bookmify_drag_handle",update:function(){var o=[];e(".bookmify_be_customfields .cfs_item").each(function(){var i=e(this).data("cf-id");o.push(i)}),e.ajax({type:"POST",url:t.ajaxurl,cache:!0,data:{action:"ajaxQueryReorderCF",bookmify_data:o},success:function(){e.iaoAlert({msg:t.alertSuccessIcon+t.reorderedText,type:"success",alertTime:t.iaoAlertTime,position:t.iaoAlertPosition,fadeTime:"1000"})}}),t.removeNanoDropdown()}})},addCFOption:function(){e(".bookmify_be_popup_form_customfields .cf_add_option a").off().on("click",function(o){o.preventDefault();var i=e(this).closest(".bookmify_be_popup_form_customfields").find(".bookmify_be_options_list"),n=e(".bookmify_be_customfields .clonable_option").html();return i.append(n),t.deleteCFOption(),t.removeNanoDropdown(),t.saveCF(),!1})},deleteCFOption:function(){e(".bookmify_be_popup_form_customfields .bookmify_be_options_list_item .bookmify_be_delete").off().on("click",function(o){o.preventDefault();var i=e(this).parents(".buttons_holder").parent();return i.slideUp(300),setTimeout(function(){i.remove()},301),t.removeNanoDropdown(),!1})},reorderCFOptions:function(){e(".bookmify_be_popup_form_customfields .bookmify_be_options_list").each(function(){e(this).sortable({opacity:.7,cursor:"move",axis:"y",handle:".bookmify_drag_handle",update:function(){t.removeNanoDropdown(),t.saveCF()}})})},servicePopperCF:function(){var o=e(".nano.cf_services"),i=e('.cf_services_holder .bookmify_be_custom_select input[type="text"]'),t=o.find('input[type="checkbox"]');function n(o){var i=o.attr("data-placeholder"),n=o.siblings(".bot_btn");n.off().on("click",function(){o.siblings(".cf_services_ids").val(""),o.siblings(".bookmify_be_new_value").html(""),t.prop("checked",!1),o.attr("placeholder",i),n.removeClass("opened"),e(".nano").removeClass("focused"),e("input").removeClass("input_clicked")})}function s(e){var o=e.siblings(".cf_services_ids"),i=e.siblings(".bot_btn");" "===o.val()||""===o.val()?i.removeClass("opened"):i.addClass("opened")}i.each(function(){var o=e(this);s(o),n(o)}),i.on("click",function(i){i.stopPropagation();var a=e(this),r=a.closest(".bookmify_be_popup_form_customfield").data("entity-id"),c=a.siblings(".cf_services_ids").val().split(","),l=1;t.prop("checked",!1),o.attr("data-id",r),e.each(c,function(e,i){l++,o.find('input[type="checkbox"][value="'+i+'"]').prop("checked",!0)}),t.length===l&&(o.find(".bookmify_be_check_all_items").prop("checked",!0),o.find("li").addClass("checked"));var d=e(".nano.cf_services");if(a.hasClass("input_clicked"))e(".nano").removeClass("focused"),e("input").removeClass("input_clicked");else{e(".nano").removeClass("focused"),e("input").removeClass("input_clicked"),a.addClass("input_clicked"),d.addClass("focused"),d.css({width:a.outerWidth()+"px"});new Popper(a,d,{placement:"bottom-start",onUpdate:function(){d.css({width:a.outerWidth()+"px"})}})}!function(i){o.find("ul.services_list li").off().on("click",function(){var a,r,c,l=e(this).index(),d=e(this).find('input[type="checkbox"]');d.is(":checked")?0===l?t.prop("checked",!1):(d.prop("checked",!1),o.find('ul.services_list li:first input[type="checkbox"]').prop("checked",!1)):0===l?t.prop("checked",!0):(d.prop("checked",!0),o.find('ul.services_list li:first input[type="checkbox"]').prop("checked",!1)),s(i),function(i){var t=[];o.find("ul.services_list li").each(function(){var o=e(this),i=o.find(".bookmify_be_check_item").val();0!==o.index()&&(o.find('input[type="checkbox"]').is(":checked")?(t=e.grep(t,function(e){return e!==i}),o.addClass("checked"),t.push(o.find(".bookmify_be_check_item").val())):(o.removeClass("checked"),t=e.grep(t,function(e){return e!==i})))});var a=i.attr("data-placeholder");if(e.isEmptyObject(t))i.attr("placeholder",a),i.siblings(".bookmify_be_new_value").html("");else{var r="";if(i.attr("placeholder",""),t.length>1){var c=o.find("ul.services_list li").length-1;r='<span class="number">'+t.length+" / "+c+"</span>"}var l='<span class="text">'+o.find("input[value="+t[0]+"]").closest("li").find("span.name").html()+"</span>";i.siblings(".bookmify_be_new_value").html("").html(l+r)}i.parent().find(".cf_services_ids").val("").val(t),s(i),n(i)}(i),n(i),a=o.find(".services_list li").not(":first").find('input[type="checkbox"]'),r=o.find(".services_list li").not(":first").find('input[type="checkbox"]:checked'),c=o.find('.services_list li:first input[type="checkbox"]'),r.length===a.length?c.prop("checked",!0):c.prop("checked",!1)})}(a)}),e(window).on("click",function(){e(".nano").removeClass("focused"),e("input").removeClass("input_clicked")}),e(".nano.cf_services").on("click",function(e){e.stopPropagation()}),o.on("click",function(e){e.stopPropagation()}),n(i)}};e(document).ready(function(){t.init()})}(jQuery);