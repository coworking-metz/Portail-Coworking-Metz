!function(e){"use strict";var o={categoryIDs:[],serviceIDs:[],employeeIDs:[],locationIDs:[],sortBy:""},t={cloneForm:e(".bookmify_be_content .bookmify_be_popup_form_wrap").clone()},s=bookmifyConfig,a={iaoAlertTime:"5000",iaoAlertPosition:"bottom-right",alertSuccessIcon:'<span class="icon_holder success"><i class="xcon-ok"></i></span>',alertWarningIcon:'<span class="icon_holder warning"><i class="xcon-attention-alt"></i></span>',savedShortcode:'<span class="text">'+s.savedShortcode+"</span>",deletedShortcode:'<span class="text">'+s.deletedShortcode+"</span>",addedShortcode:'<span class="text">'+s.addedShortcode+"</span>",errorField:'<span class="error_note">'+s.errorField+"</span>",cantDeleteCategory:s.cantDeleteCategory,cantDeleteShortcodee:s.cantDeleteShortcodee,assetsURI:s.assetsURL,ajaxurl:s.ajaxUrl,init:function(){e(".bookmify_be_shortcodes").length&&e(".bookmify_be_content .bookmify_be_popup_form_wrap").remove(),this.imgToSvg(),this.insertShortcode(),this.openerShortcode(),this.deleteShortcode()},imgToSvg:function(){e("img.bookmify_be_svg").each(function(){var o=e(this),t=o.attr("class"),s=o.attr("src");e.get(s,function(s){var a=e(s).find("svg");void 0!==t&&(a=a.attr("class",t+" replaced-svg")),a=a.removeAttr("xmlns:a"),o.replaceWith(a)},"xml")})},insertShortcode:function(){var o=this;e(".bookmify_be_add_new_shortcode a").off().on("click",function(){var s=t.cloneForm.clone();e("body").addClass("disable_scroll").append(s),e("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_shortcode");var a=e("body > .bookmify_be_popup_form_wrap");return o.imgToSvg(),o.getAllData(a),o.saveShortcode(),o.categoryPopper(),o.employeePopper(),o.servicePopper(),o.locationPopper(),o.sortPopper(),o.cancelItem(),a.addClass("enable"),o.closersPopup(),!1})},openerShortcode:function(){var o=this;e(".bookmify_be_shortcodes .bookmify_be_edit").off().on("click",function(t){t.preventDefault();var s=e(this),a=s.closest(".bookmify_be_list_item"),i={action:"ajaxQueryEditShortcode",bookmify_data:a.data("shortcode-id")};return s.hasClass("loading")||(s.addClass("loading"),a.addClass("loading"),e.ajax({type:"POST",url:o.ajaxurl,cache:!1,data:i,success:function(e){s.removeClass("loading"),a.removeClass("loading"),o.getRequestedShortcodePopup(e)},error:function(){}})),!1})},getRequestedShortcodePopup:function(o){var t=e.parseJSON(o).bookmify_be_data;e("body").addClass("disable_scroll").append(t);var s=e("body > .bookmify_be_popup_form_wrap");s.addClass("bookmify_be_popup_form_shortcode"),this.getAllData(s),this.imgToSvg(),this.saveShortcode(),this.categoryPopper(),this.employeePopper(),this.servicePopper(),this.locationPopper(),this.sortPopper(),this.cancelItem(),s.addClass("enable"),this.closersPopup()},getAllData:function(e){o.categoryIDs=[],o.serviceIDs=[],o.employeeIDs=[],o.locationIDs=[],o.sortBy="";var t=e.find('input[name="category_ids"]').val(),s=e.find('input[name="service_ids"]').val(),a=e.find('input[name="employee_ids"]').val(),i=e.find('input[name="location_ids"]').val(),n=e.find('input[name="sorting_by"]').val();t&&(o.categoryIDs=t.split(","),this.categoryListToNewValue("no")),s&&(o.serviceIDs=s.split(","),this.serviceListToNewValue("no")),a&&(o.employeeIDs=a.split(","),this.employeeListToNewValue("no")),i&&(o.locationIDs=i.split(","),this.locationListToNewValue("no")),o.sortBy=n,this.filterAjaxCall()},deleteShortcode:function(){var o=this;e(".bookmify_be_shortcodes .bookmify_be_delete").off().on("click",function(){var t=e(this),s=t.data("entity-id"),a=t.parents(".shortcode_item");return t.addClass("clicked"),o.deleteConfirmShortcode(a,s,t),!1})},deleteConfirmShortcode:function(o,t,s){var a=this,i=e("#bookmify_be_confirm");i.addClass("opened shortcode_confirm");var n=e("#bookmify_be_confirm.shortcode_confirm").find("a.yes"),r=e("#bookmify_be_confirm.shortcode_confirm").find("a.no");n.off().on("click",function(n){n.preventDefault(),s.removeClass("clicked"),i.removeClass("opened shortcode_confirm"),s.addClass("loading"),o.addClass("loading");var r={action:"ajaxQueryDeleteShortcode",bookmify_shortcode_id:t};e.ajax({type:"POST",url:a.ajaxurl,cache:!0,data:r,success:function(t){var s=e.parseJSON(t);return e(".bookmify_be_page_title h3 span.count").html(s.number),o.slideUp(500),setTimeout(function(){o.remove()},501),e(".bookmify_be_shortcode_list ul.shortcode_list").removeClass("opened"),a.openerShortcode(),setTimeout(function(){e.iaoAlert({msg:a.alertSuccessIcon+a.deletedShortcode,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition})},501),!1}})}),r.on("click",function(){return i.removeClass(),s.removeClass("clicked"),!1})},saveShortcode:function(){var o=this;e(".bookmify_be_popup_form_shortcode .bookmify_be_popup_form_button a.save").off().on("click",function(){var t=e(this),s=t.closest(".bookmify_be_popup_form_shortcode").find("form"),a=t.closest(".bookmify_be_popup_form_shortcode").data("entity-id"),i=0;if(s.find(".required_field").each(function(){var t=e(this);""===t.val()&&(t.parent().find(".error_note").remove(),t.parent().addClass("required_error").append(o.errorField),i++)}),0!==i)return o.scrollToTop(500),!1;a||(a=""),t.addClass("await");var n=s.find("input.sh_title").val();return o.saveShortcodeAjax(s,a,t,n),!1}),e(".bookmify_be_popup_form_shortcode input.required_field").keyup(function(){var o=e(this);""!==o.val()&&o.parent().hasClass("required_error")&&(o.parent().removeClass("required_error"),o.parent().find(".error_note").remove())})},saveShortcodeAjax:function(t,s,a,i){var n=this,r={action:"ajaxQueryInsertOrUpdateShortcode",shortcodeTitle:i,shortcodeID:s,sortBy:o.sortBy,employeeIDs:o.employeeIDs,categoryIDs:o.categoryIDs,serviceIDs:o.serviceIDs,locationIDs:o.locationIDs,order:o.order,do:1};return e.ajax({type:"POST",url:n.ajaxurl,cache:!0,data:r,success:function(e){a.removeClass("await"),n.getUpdatedShortcodesList(e,s)},error:function(){}}),!1},getUpdatedShortcodesList:function(o,t){var s=this,a=e.parseJSON(o),i=e(".bookmify_be_shortcodes_list"),n=e(".bookmify_be_page_title h3 span.count");s.closePopupForm(),e.isNumeric(t)?setTimeout(function(){e.iaoAlert({msg:s.alertSuccessIcon+s.savedShortcode,type:"success",alertTime:s.iaoAlertTime,position:s.iaoAlertPosition})},301):setTimeout(function(){e.iaoAlert({msg:s.alertSuccessIcon+s.addedShortcode,type:"success",alertTime:s.iaoAlertTime,position:s.iaoAlertPosition})},301),i.html(a.bookmify_be_data),n.html(a.number);var r=i.find(".shortcode_list > div");setTimeout(function(){r.each(function(o,t){setTimeout(function(){e(t).addClass("fadeInTop done")},100*o)})},150),s.init()},closerButton:function(){var o=this;e(".bookmify_be_popup_form_wrap.enable").find("span.closer").on("click",function(){o.closePopupForm()})},closerEsc:function(){e(document).keyup(function(e){e.key})},closersPopup:function(){this.closerEsc(),this.closerButton()},closePopupForm:function(){e(".nano").removeClass("focused"),e("input").removeClass("input_clicked");var o=e(".bookmify_be_popup_form_wrap.enable");e("body").removeClass("disable_scroll"),o.removeClass("enable"),setTimeout(function(){o.remove()},300)},scrollToTop:function(o){e(".bookmify_be_popup_form_wrap").animate({scrollTop:0},o)},cancelItem:function(){var o=this;e(".bookmify_be_popup_form_button a.cancel").off().on("click",function(){return o.closePopupForm(),!1})},categoryPopper:function(){var t=this,s=e('body > .bookmify_be_popup_form_shortcode input[name="category"]'),a=e(".bookmify_be_shortcode_popup_list.b_category"),i=s.siblings("span.bot_btn"),n=s.parent(),r=n.find(".bookmify_be_new_value"),l=s.data("placeholder"),c=s.closest("form").find(".input_wrap");s.off().on("click",function(e){e.stopPropagation(),n.hasClass("opened")?n.removeClass("opened"):(c.removeClass("opened"),n.addClass("opened"))}),e(window).on("click",function(){n.removeClass("opened")}),a.on("click",function(e){e.stopPropagation()}),a.find("div").off().on("click",function(s){s.stopPropagation();var a=e(this),i=a.data("id");o.serviceIDs=[],a.hasClass("sending")?(a.removeClass("sending"),o.categoryIDs=e.grep(o.categoryIDs,function(e){return e!=i})):(a.addClass("sending"),o.categoryIDs.push(i)),t.categoryListToNewValue()}),i.off().on("click",function(e){e.preventDefault(),e.stopPropagation(),o.categoryIDs=[],n.removeClass("ready opened"),r.html(""),t.filterAjaxCall(),s.attr("placeholder",l),a.children("div").removeClass("sending")})},categoryListToNewValue:function(t){var s=e('body > .bookmify_be_popup_form_shortcode input[name="category"]'),a=e(".bookmify_be_shortcode_popup_list.b_category"),i=s.data("placeholder");if(e.isEmptyObject(o.categoryIDs))s.attr("placeholder",i),s.siblings(".bookmify_be_new_value").html(""),s.parent().removeClass("ready");else{var n="";if(s.attr("placeholder",""),o.categoryIDs.length>1){var r=a.children("div").length;n='<span class="number">'+o.categoryIDs.length+" / "+r+"</span>"}var l='<span class="text">'+a.find('div[data-id="'+o.categoryIDs[0]+'"]').html()+"</span>";s.siblings(".bookmify_be_new_value").html("").html(l+n),s.parent().addClass("ready")}"no"!==t&&this.filterAjaxCall()},locationPopper:function(){var t=this,s=e('body > .bookmify_be_popup_form_shortcode input[name="location"]'),a=e(".bookmify_be_shortcode_popup_list.b_location"),i=s.siblings("span.bot_btn"),n=s.parent(),r=n.find(".bookmify_be_new_value"),l=s.data("placeholder"),c=s.closest("form").find(".input_wrap");s.off().on("click",function(e){e.stopPropagation(),n.hasClass("opened")?n.removeClass("opened"):(c.removeClass("opened"),n.addClass("opened"))}),e(window).on("click",function(){n.removeClass("opened")}),a.on("click",function(e){e.stopPropagation()}),a.find("div").off().on("click",function(s){s.stopPropagation();var a=e(this),i=a.data("id");a.hasClass("sending")?(a.removeClass("sending"),o.locationIDs=e.grep(o.locationIDs,function(e){return e!=i})):(a.addClass("sending"),o.locationIDs.push(i)),t.locationListToNewValue()}),i.off().on("click",function(e){e.preventDefault(),e.stopPropagation(),o.locationIDs=[],n.removeClass("ready opened"),r.html(""),t.filterAjaxCall(),s.attr("placeholder",l),a.children("div").removeClass("sending")})},locationListToNewValue:function(t){var s=e('body > .bookmify_be_popup_form_shortcode input[name="location"]'),a=e(".bookmify_be_shortcode_popup_list.b_location"),i=s.data("placeholder");if(e.isEmptyObject(o.locationIDs))s.attr("placeholder",i),s.siblings(".bookmify_be_new_value").html(""),s.parent().removeClass("ready");else{var n="";if(s.attr("placeholder",""),o.locationIDs.length>1){var r=a.children("div").length;n='<span class="number">'+o.locationIDs.length+" / "+r+"</span>"}var l='<span class="text">'+a.find('div[data-id="'+o.locationIDs[0]+'"]').html()+"</span>";s.siblings(".bookmify_be_new_value").html("").html(l+n),s.parent().addClass("ready")}"no"!==t&&this.filterAjaxCall()},servicePopper:function(){var t=this,s=e('body > .bookmify_be_popup_form_shortcode input[name="service"]'),a=e(".bookmify_be_shortcode_popup_list.b_service"),i=s.siblings("span.bot_btn"),n=s.parent(),r=n.find(".bookmify_be_new_value"),l=s.data("placeholder"),c=s.closest("form").find(".input_wrap");s.off().on("click",function(e){e.stopPropagation(),n.hasClass("opened")?n.removeClass("opened"):(c.removeClass("opened"),n.addClass("opened"))}),e(window).on("click",function(){n.removeClass("opened")}),a.on("click",function(e){e.stopPropagation()}),a.find("div").off().on("click",function(s){s.stopPropagation();var a=e(this),i=a.data("id");a.hasClass("sending")?(a.removeClass("sending"),o.serviceIDs=e.grep(o.serviceIDs,function(e){return e!=i})):(a.addClass("sending"),o.serviceIDs.push(i)),t.serviceListToNewValue()}),i.off().on("click",function(e){e.preventDefault(),e.stopPropagation(),o.serviceIDs=[],n.removeClass("ready opened"),r.html(""),t.filterAjaxCall(),s.attr("placeholder",l),a.children("div").removeClass("sending")})},serviceListToNewValue:function(t){var s=e('body > .bookmify_be_popup_form_shortcode input[name="service"]'),a=e(".bookmify_be_shortcode_popup_list.b_service"),i=s.data("placeholder");if(e.isEmptyObject(o.serviceIDs))s.attr("placeholder",i),s.siblings(".bookmify_be_new_value").html(""),s.parent().removeClass("ready");else{var n="";if(s.attr("placeholder",""),o.serviceIDs.length>1){var r=a.children("div").length;n='<span class="number">'+o.serviceIDs.length+" / "+r+"</span>"}var l='<span class="text">'+a.find('div[data-id="'+o.serviceIDs[0]+'"]').html()+"</span>";s.siblings(".bookmify_be_new_value").html("").html(l+n),s.parent().addClass("ready")}"no"!==t&&this.filterAjaxCall()},employeePopper:function(){var t=this,s=e('body > .bookmify_be_popup_form_shortcode input[name="employee"]'),a=e(".bookmify_be_shortcode_popup_list.b_employee"),i=s.siblings("span.bot_btn"),n=s.parent(),r=n.find(".bookmify_be_new_value"),l=s.data("placeholder"),c=s.closest("form").find(".input_wrap");s.off().on("click",function(e){e.stopPropagation(),n.hasClass("opened")?n.removeClass("opened"):(c.removeClass("opened"),n.addClass("opened"))}),e(window).on("click",function(){n.removeClass("opened")}),a.on("click",function(e){e.stopPropagation()}),a.find("div").off().on("click",function(s){s.stopPropagation();var a=e(this),i=a.data("id");a.hasClass("sending")?(a.removeClass("sending"),o.employeeIDs=e.grep(o.employeeIDs,function(e){return e!=i})):(a.addClass("sending"),o.employeeIDs.push(i)),t.employeeListToNewValue()}),i.off().on("click",function(e){e.preventDefault(),e.stopPropagation(),o.employeeIDs=[],n.removeClass("ready opened"),r.html(""),t.filterAjaxCall(),s.attr("placeholder",l),a.children("div").removeClass("sending")})},employeeListToNewValue:function(t){var s=e('body > .bookmify_be_popup_form_shortcode input[name="employee"]'),a=e(".bookmify_be_shortcode_popup_list.b_employee"),i=s.data("placeholder");if(e.isEmptyObject(o.employeeIDs))s.attr("placeholder",i),s.siblings(".bookmify_be_new_value").html(""),s.parent().removeClass("ready");else{var n="";if(s.attr("placeholder",""),o.employeeIDs.length>1){var r=a.children("div").length;n='<span class="number">'+o.employeeIDs.length+" / "+r+"</span>"}var l='<span class="text">'+a.find('div[data-id="'+o.employeeIDs[0]+'"]').html()+"</span>";s.siblings(".bookmify_be_new_value").html("").html(l+n),s.parent().addClass("ready")}"no"!==t&&this.filterAjaxCall()},sortPopper:function(){var t=this,s=e('body > .bookmify_be_popup_form_shortcode input[name="sorting"]'),a=e(".bookmify_be_shortcode_popup_list.b_sorting"),i=s.siblings("span.bot_btn"),n=s.parent(),r=n.find(".bookmify_be_new_value"),l=s.data("placeholder"),c=s.closest("form").find(".input_wrap");s.off().on("click",function(e){e.stopPropagation(),n.hasClass("opened")?n.removeClass("opened"):(c.removeClass("opened"),n.addClass("opened"))}),e(window).on("click",function(){n.removeClass("opened")}),a.on("click",function(e){e.stopPropagation()}),a.find("div").off().on("click",function(i){i.stopPropagation();var c=e(this),d=c.html(),p=c.data("id");c.hasClass("sending")?(c.removeClass("sending"),o.sortBy="",r.html(""),s.attr("placeholder",l),n.removeClass("ready")):(a.find("div").removeClass("sending"),n.addClass("ready"),c.addClass("sending"),o.sortBy=p,s.attr("placeholder",""),r.html(d)),n.removeClass("opened"),t.filterAjaxCall()}),i.off().on("click",function(e){e.preventDefault(),e.stopPropagation(),o.sortBy="",t.filterAjaxCall(),n.removeClass("ready opened"),r.html(""),s.attr("placeholder",l),a.children("div").removeClass("sending")})},filterAjaxCall:function(){var t=e("body > .bookmify_be_popup_form_wrap").find(".bookmify_be_p_service_list"),s=e(".bookmify_be_hidden_info").html();t.html(s);var a={action:"ajaxPreviewServiceList",sortBy:o.sortBy,employeeIDs:o.employeeIDs,categoryIDs:o.categoryIDs,serviceIDs:o.serviceIDs,locationIDs:o.locationIDs,order:o.order,do:1};e.ajax({type:"POST",url:this.ajaxurl,cache:!0,data:a,success:function(o){var s=e.parseJSON(o);t.html(s.bookmify_be_data),t.length&&new PerfectScrollbar(".bookmify_be_p_service_list",{suppressScrollX:!0,wheelSpeed:.5,wheelPropagation:!0})},error:function(){}})}};e(document).ready(function(){a.init()})}(jQuery);