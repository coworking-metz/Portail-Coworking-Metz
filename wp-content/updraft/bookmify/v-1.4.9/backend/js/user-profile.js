!function(e){"use strict";var a=bookmifyConfig,i={iaoAlertTime:"5000",iaoAlertPosition:"bottom-right",alertSuccessIcon:'<span class="icon_holder success"><i class="xcon-ok"></i></span>',alertWarningIcon:'<span class="icon_holder warning"><i class="xcon-attention-alt"></i></span>',updatedText:'<span class="text">'+a.updatedText+"</span>",disconnect:'<span class="text">'+a.disconnect+"</span>",connected:'<span class="text">'+a.connected+"</span>",errorField:'<span class="error_note">'+a.errorField+"</span>",invalidEmail:'<span class="error_note">'+a.invalidEmail+"</span>",emailUsed:'<span class="error_note">'+a.emailUsed+"</span>",invalidDate:'<span class="error_note">'+a.invalidDate+"</span>",emailExist:'<span class="error_note">'+a.emailExist+"</span>",hackText:'<span class="error_note">'+a.hackText+"</span>",employeeID:"",employeeAuthCode:"",ajaxurl:a.ajaxUrl,monthsNames:a.months,init:function(){this.getValFromUrlParameters(),this.imgToSvg(),this.intlTelInput(),this.mediaUploadToUserProfile(),this.googleDisable(),this.saveEmployee(),this.saveCustomer(),e(".bookmify_be_customer_profile").length&&this.birthdayInput()},getValFromUrlParameters:function(){var a,i=this,t=i.getUrlParams(window.location.href).state,r=i.getUrlParams(window.location.href).code;""!==t&&(i.employeeID=t),""!==r&&(i.employeeAuthCode=r),a=i.removeUrlParams(window.location.href,"state"),a=i.removeUrlParams(a,"code"),a=i.removeUrlParams(a,"scope"),history.pushState(null,null,a),void 0!==i.employeeID&&setTimeout(function(){e.iaoAlert({msg:i.alertSuccessIcon+i.connected,type:"success",alertTime:i.iaoAlertTime,position:i.iaoAlertPosition})},50)},getUrlParams:function(e){var a=e?e.split("?")[1]:window.location.search.slice(1),i={};if(a)for(var t=(a=a.split("#")[0]).split("&"),r=0;r<t.length;r++){var o=t[r].split("="),n=o[0],s=void 0===o[1]||o[1];if(n.match(/\[(\d+)?\]$/)){var l=n.replace(/\[(\d+)?\]/,"");if(i[l]||(i[l]=[]),n.match(/\[\d+\]$/)){var m=/\[(\d+)\]/.exec(n)[1];i[l][m]=s}else i[l].push(s)}else i[n]?i[n]&&"string"==typeof i[n]?(i[n]=[i[n]],i[n].push(s)):i[n].push(s):i[n]=s}return i},removeUrlParams:function(e,a){var i=e.split("?");if(i.length>=2){for(var t=encodeURIComponent(a)+"=",r=i[1].split(/[&;]/g),o=r.length;o-- >0;)-1!==r[o].lastIndexOf(t,0)&&r.splice(o,1);return i[0]+(r.length>0?"?"+r.join("&"):"")}return e},intlTelInput:function(){e(".bookmify_be_user_profile .phone_wrap input,.bookmify_be_customer_profile .phone input").each(function(){var a=e(this),i=a.val();a.intlTelInput({autoPlaceholder:"aggressive",autoHideDialCode:!0}),a.val(i)})},googleDisable:function(){var a=this,i=e(".bookmify_be_employee_profile");i.find(".bookmify_be_google_disable").off().on("click",function(){var t=e(this),r={action:"ajaxQueryDeleteGoogleData",bookmify_data:i.data("id")};return t.hasClass("loading")||(t.addClass("loading"),e.ajax({type:"POST",url:a.ajaxurl,cache:!1,data:r,success:function(i){t.removeClass("loading"),t.closest(".bookmify_be_emmp_google_cal").find(".g_top").html(e.parseJSON(i).top_html),t.closest(".bookmify_be_emmp_google_cal").find(".g_bottom").html(e.parseJSON(i).bottom_html),"warning"===e.parseJSON(i).error&&e.iaoAlert({msg:a.alertWarningIcon+a.hackText,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition}),setTimeout(function(){e.iaoAlert({msg:a.alertSuccessIcon+a.disconnect,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition})},300)},error:function(){}})),!1})},imgToSvg:function(){e("img.bookmify_be_svg").each(function(){var a=e(this),i=a.attr("class"),t=a.attr("src");e.get(t,function(t){var r=e(t).find("svg");void 0!==i&&(r=r.attr("class",i+" replaced-svg")),r=r.removeAttr("xmlns:a"),a.replaceWith(r)},"xml")})},saveEmployee:function(){var a=e(".bookmify_be_employee_profile .save_holder a.save"),i=this;a.off().on("click",function(){var a=e(this),t=a.closest(".bookmify_be_employee_profile"),r=0,o=t.find(".required_field"),n=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(o.each(function(){var a=e(this);a.hasClass("employee_email")?""===a.val()?a.parent().hasClass("required_error")||(a.parent().find(".error_note").remove(),a.parent().addClass("required_error").append(i.errorField),r++):n.test(a.val())||(a.parent().find(".error_note").remove(),a.parent().addClass("invalid_email").append(i.invalidEmail),r++):""===a.val()&&(a.parent().find(".error_note").remove(),a.parent().addClass("required_error").append(i.errorField),r++)}),0!==r)return i.scrollToTop(500),!1;a.addClass("await");var s={};s.id=parseInt(t.data("id")),s.att_id=t.find("input[name='employee_img_id']").val(),s.first_name=t.find("input[name='first_name']").val(),s.last_name=t.find("input[name='last_name']").val(),s.email=t.find("input[name='email']").val(),s.phone=t.find("input[name='phone']").val(),s.desc=t.find("textarea").val();var l={action:"ajaxQueryUpdateEmployeeInfo",bookmify_data:JSON.stringify(s)};return e.ajax({type:"POST",url:i.ajaxurl,cache:!1,data:l,success:function(){a.removeClass("await"),e.iaoAlert({msg:i.alertSuccessIcon+i.updatedText,type:"success",alertTime:i.iaoAlertTime,position:i.iaoAlertPosition})},error:function(){}}),!1}),e(".bookmify_be_employee_profile input.required_field").keyup(function(){var a=e(this);(""!==a.val()&&a.parent().hasClass("required_error")||a.parent().hasClass("invalid_email"))&&(a.parent().removeClass("required_error invalid_email"),a.parent().find(".error_note").remove())})},mediaUploadToUserProfile:function(){e(".bookmify_be_employee_profile .bookmify_thumb_edit").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var i=e(this).closest(".bookmify_be_employee_profile"),t=i.find('input[class="bookmify_be_img_id"]'),r=i.find(".bookmify_thumb_wrap"),o=i.find(".bookmify_thumb_remove"),n="",s=wp.media({library:{type:"image"},multiple:!1});return s.on("select",function(){var a=s.state().get("selection").toJSON();a.length&&(void 0!==a[0].sizes.thumbnail?a[0].sizes.thumbnail.url:a[0].url,n=void 0!==a[0].sizes.large?a[0].sizes.large.url:a[0].url,t.val(a[0].id),r.addClass("has_image").css({"background-image":"url("+n+")"}),e(this).hide(),o.show())}),s.open(),!1}),e(".bookmify_be_employee_profile .bookmify_thumb_remove a").off().on("click",function(a){a.preventDefault(),a.stopPropagation(),e(".nano").removeClass("focused clicked"),e("input").removeClass("input_clicked");var i=e(this).closest(".bookmify_be_employee_profile"),t=i.find('input[class="bookmify_be_img_id"]'),r=i.find(".bookmify_thumb_wrap");return t.val(""),r.removeClass("has_image").css({"background-image":"none"}),e(this).parent().hide(),!1})},scrollToTop:function(a){a=parseInt(a),e("body,html").animate({scrollTop:0},a)},birthdayInput:function(){var a,i=this,t=e(".bookmify_be_customer_profile .birthday_input_wrap"),r=t.find(".years"),o=r.data("index"),n=t.find(".months"),s=n.data("index");for(a=(new Date).getFullYear();a>1909;a--){var l=a===o?'selected="selected"':"";r.append(e("<option "+l+" />").val(a).html(a))}var m=[["01",this.monthsNames.january],["02",this.monthsNames.february],["03",this.monthsNames.march],["04",this.monthsNames.april],["05",this.monthsNames.may],["06",this.monthsNames.june],["07",this.monthsNames.july],["08",this.monthsNames.august],["09",this.monthsNames.september],["10",this.monthsNames.october],["11",this.monthsNames.november],["12",this.monthsNames.december]];for(a=0;a<12;a++){var d=m[a][0]==s?'selected="selected"':"";n.append(e("<option "+d+" />").val(m[a][0]).html(m[a][1]))}i.updateNumberOfDays(r,n),r.change(function(){i.updateNumberOfDays(r,n)}),n.change(function(){i.updateNumberOfDays(r,n)})},updateNumberOfDays:function(a,i){var t,r=e(".bookmify_be_customer_profile .birthday_input_wrap .days"),o=r.data("index"),n=i.val(),s=a.val(),l=this.daysInMonth(s,n);for(r.html('<option value="00">---</option>'),t=1;t<l+1;t++){var m=t==o?'selected="selected"':"";r.append(e("<option "+m+" />").val(t).html(t))}},daysInMonth:function(e,a){return new Date(e,a,0).getDate()},saveCustomer:function(){var a=this,i=e(".bookmify_be_customer_profile a.save"),t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,r=/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\.\/0-9]{6,17}$/;i.off().on("click",function(){var i=e(this),o=i.parents(".bookmify_be_customer_profile"),n=o.find(".required_field"),s=0;o.find(".error_note").remove(),o.find(".invalid_email,.required_error").removeClass("invalid_email required_error"),n.each(function(){var i=e(this);i.hasClass("customer_email")?""===i.val()?i.parent().hasClass("required_error")||(i.parent().find(".error_note").remove(),i.parent().addClass("required_error").append(a.errorField),s++):t.test(i.val())||i.parent().hasClass("invalid_email")||(i.parent().find(".error_note").remove(),i.parent().addClass("invalid_email").append(a.invalidEmail),s++):""!==i.val()||i.parent().hasClass("required_error")||(i.parent().find(".error_note").remove(),i.parent().addClass("required_error").append(a.errorField),s++)});var l=o.find(".customer_phone");""!==l.val()&&(r.test(l.val())||l.parent().hasClass("invalid_email")||(l.parent().find(".error_note").remove(),l.parent().addClass("invalid_email").append(a.invalidEmail),s++));var m=parseFloat(o.find(".birthday_input_wrap select.years").val()),d=parseFloat(o.find(".birthday_input_wrap select.months").val()),p=parseFloat(o.find(".birthday_input_wrap select.days").val());d<10&&(d="0"+d),p<10&&(p="0"+p);var c=o.find(".birthday_input_wrap");0!=m&&0!=d&&0!=p||0==m&&0==d&&0==p||c.parent().hasClass("invalid_email")||(c.parent().find(".error_note").remove(),c.parent().addClass("invalid_email").append(a.invalidDate),s++);var u=m+"-"+d+"-"+p;if(0!==s)return a.scrollToTop(500),!1;i.addClass("await");var f={};f.first_name=o.find("input.customer_first_name").val(),f.last_name=o.find("input.customer_last_name").val(),f.email=o.find("input.customer_email").val(),f.phone=o.find("input.customer_phone").val(),f.birthday=u,f.country=o.find("input.customer_country").val(),f.state=o.find("input.customer_state").val(),f.city=o.find("input.customer_city").val(),f.address=o.find("input.customer_address").val(),f.postcode=o.find("input.customer_postcode").val(),f.info=o.find("textarea.customer_info").val(),f.id=o.data("id");var _={action:"ajaxQueryUpdateCustomerInfo",bookmify_data:JSON.stringify(f)};return e.ajax({type:"POST",url:a.ajaxurl,cache:!1,data:_,success:function(t){var r=e.parseJSON(t).bookmify_be_data;i.removeClass("await"),"yes"===r?(a.scrollToTop(500),setTimeout(function(){e.iaoAlert({msg:a.alertWarningIcon+a.emailUsed,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition}),o.find(".input_wrap.email").addClass("invalid_email").append(a.emailExist)},500)):e.iaoAlert({msg:a.alertSuccessIcon+a.updatedText,type:"success",alertTime:a.iaoAlertTime,position:a.iaoAlertPosition})},error:function(){}}),!1}),e(".bookmify_be_customer_profile input.required_field, .bookmify_be_customer_profile input.customer_phone").keyup(function(){var a=e(this);(a.parent().hasClass("required_error")||a.parent().hasClass("invalid_email"))&&(a.parent().removeClass("required_error invalid_email"),a.parent().find(".error_note").remove())})}};e(document).ready(function(){i.init()})}(jQuery);