!function(e){"use strict";var o=bookmifyConfig,a={iaoAlertTime:"5000",iaoAlertPosition:"bottom-right",alertSuccessIcon:'<span class="icon_holder success"><i class="xcon-ok"></i></span>',alertWarningIcon:'<span class="icon_holder warning"><i class="xcon-attention-alt"></i></span>',savedTax:'<span class="text">'+o.savedTax+"</span>",deletedTax:'<span class="text">'+o.deletedTax+"</span>",addedTax:'<span class="text">'+o.addedTax+"</span>",errorField:'<span class="error_note">'+o.errorField+"</span>",cantDeleteCategory:o.cantDeleteCategory,cantDeleteTaxe:o.cantDeleteTaxe,assetsURI:o.assetsURL,ajaxurl:o.ajaxUrl,init:function(){this.imgToSvg(),this.insertTax(),this.openerTax(),this.deleteTax(),e.protip()},imgToSvg:function(){e("img.bookmify_be_svg").each(function(){var o=e(this),a=o.attr("class"),t=o.attr("src");e.get(t,function(t){var i=e(t).find("svg");void 0!==a&&(i=i.attr("class",a+" replaced-svg")),i=i.removeAttr("xmlns:a"),o.replaceWith(i)},"xml")})},insertTax:function(){var o=this;e(".bookmify_be_add_new_tax a").off().on("click",function(){var a=e(".bookmify_be_content .bookmify_be_popup_form_wrap").clone();return e("body").addClass("disable_scroll").append(a),e("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_tax"),o.imgToSvg(),o.saveTax(),o.cancelItem(),e("body > .bookmify_be_popup_form_wrap").addClass("enable"),o.closersPopup(),!1})},openerTax:function(){var o=this;e(".bookmify_be_taxes .bookmify_be_edit").off().on("click",function(a){a.preventDefault();var t=e(this),i=t.closest(".bookmify_be_list_item"),s={action:"ajaxQueryEditTax",bookmify_data:i.data("tax-id")};return t.hasClass("loading")||(t.addClass("loading"),i.addClass("loading"),e.ajax({type:"POST",url:o.ajaxurl,cache:!1,data:s,success:function(e){t.removeClass("loading"),i.removeClass("loading"),o.getRequestedTaxPopup(e)},error:function(){}})),!1})},getRequestedTaxPopup:function(o){var a=e.parseJSON(o).bookmify_be_data;e("body").addClass("disable_scroll").append(a),e("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_tax"),this.imgToSvg(),this.saveTax(),this.cancelItem(),e("body > .bookmify_be_popup_form_wrap").addClass("enable"),this.closersPopup()},deleteTax:function(){var o=this;e(".bookmify_be_taxes .bookmify_be_delete").off().on("click",function(){var a=e(this),t=a.data("entity-id"),i=a.parents(".bookmify_be_tax_item");return a.addClass("clicked"),o.deleteConfirmTax(i,t,a),!1})},deleteConfirmTax:function(o,a,t){var i=this,s=e("#bookmify_be_confirm");s.addClass("opened tax_confirm");var n=e("#bookmify_be_confirm.tax_confirm").find("a.yes"),r=e("#bookmify_be_confirm.tax_confirm").find("a.no");n.off().on("click",function(n){n.preventDefault(),t.removeClass("clicked"),s.removeClass("opened tax_confirm"),t.addClass("loading"),o.addClass("loading");var r={action:"ajaxQueryDeleteTax",bookmify_tax_id:a};e.ajax({type:"POST",url:i.ajaxurl,cache:!0,data:r,success:function(a){var s=e.parseJSON(a),n=e(".bookmify_be_page_title h3 span.count");return 0===parseInt(s.count)?(n.html(s.number),o.slideUp(500),setTimeout(function(){o.remove()},501),e(".bookmify_be_tax_list ul.tax_list").removeClass("opened"),i.openerTax(),setTimeout(function(){e.iaoAlert({msg:i.alertSuccessIcon+i.serDeleted,type:"success",alertTime:i.iaoAlertTime,position:i.iaoAlertPosition})},501)):(t.removeClass("loading clicked"),o.removeClass("loading"),e.iaoAlert({msg:i.alertWarningIcon+'<span class="error_note">'+i.cantDeleteTax+" "+s.count+"</span>",type:"success",alertTime:i.iaoAlertTime,position:i.iaoAlertPosition})),!1}})}),r.on("click",function(){return s.removeClass(),t.removeClass("clicked"),!1})},saveTax:function(){var o=this;e(".bookmify_be_popup_form_tax .bookmify_be_popup_form_button a.save").off().on("click",function(){var a=e(this),t=a.closest(".bookmify_be_popup_form_tax").find("form"),i=a.closest(".bookmify_be_popup_form_tax").data("entity-id"),s=0;if(t.find(".required_field").each(function(){var a=e(this);""===a.val()&&(a.parent().find(".error_note").remove(),a.parent().addClass("required_error").append(o.errorField),s++)}),0!==s)return o.scrollToTop(500),!1;i||(i=""),a.addClass("await");var n=t.find("input.tax_title").val(),r=t.find("input.tax_rate").val();return o.saveTaxAjax(t,i,a,n,r),!1}),e(".bookmify_be_popup_form_tax input.required_field").keyup(function(){var o=e(this);""!==o.val()&&o.parent().hasClass("required_error")&&(o.parent().removeClass("required_error"),o.parent().find(".error_note").remove())})},saveTaxAjax:function(o,a,t,i,s){var n=this,r={action:"ajaxQueryInsertOrUpdateTax",taxTitle:i,taxRate:s,taxID:a,do:1};return e.ajax({type:"POST",url:n.ajaxurl,cache:!0,data:r,success:function(e){t.removeClass("await"),n.getUpdatedTaxesList(e,a)},error:function(){}}),!1},getUpdatedTaxesList:function(o,a){var t=this,i=e.parseJSON(o),s=e(".bookmify_be_taxes_list"),n=e(".bookmify_be_page_title h3 span.count");t.closePopupForm(),e.isNumeric(a)?setTimeout(function(){e.iaoAlert({msg:t.alertSuccessIcon+t.savedTax,type:"success",alertTime:t.iaoAlertTime,position:t.iaoAlertPosition})},301):setTimeout(function(){e.iaoAlert({msg:t.alertSuccessIcon+t.addedTax,type:"success",alertTime:t.iaoAlertTime,position:t.iaoAlertPosition})},301),s.html(i.bookmify_be_data),n.html(i.number);var r=s.find(".tax_list > div");setTimeout(function(){r.each(function(o,a){setTimeout(function(){e(a).addClass("fadeInTop done")},100*o)})},150),t.init()},closerButton:function(){var o=this;e(".bookmify_be_popup_form_wrap.enable").find("span.closer").on("click",function(){o.closePopupForm()})},closerEsc:function(){e(document).keyup(function(e){e.key})},closersPopup:function(){this.closerEsc(),this.closerButton()},closePopupForm:function(){e(".nano").removeClass("focused"),e("input").removeClass("input_clicked");var o=e(".bookmify_be_popup_form_wrap.enable");e("body").removeClass("disable_scroll"),o.removeClass("enable"),setTimeout(function(){o.remove()},300)},scrollToTop:function(o){e(".bookmify_be_popup_form_wrap").animate({scrollTop:0},o)},cancelItem:function(){var o=this;e(".bookmify_be_popup_form_button a.cancel").off().on("click",function(){return o.closePopupForm(),!1})}};e(document).ready(function(){a.init()})}(jQuery);