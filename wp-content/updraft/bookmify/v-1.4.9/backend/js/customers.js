!function(e){"use strict";var t={page:1,search:"",order:"ASC",text:"",orderClass:"order_asc"},o={cloneForm:e(".bookmify_be_content .bookmify_be_popup_form_wrap").clone()},a=bookmifyConfig,s={iaoAlertTime:"5000",iaoAlertPosition:"bottom-right",alertSuccessIcon:'<span class="icon_holder success"><i class="xcon-ok"></i></span>',alertWarningIcon:'<span class="icon_holder warning"><i class="xcon-attention-alt"></i></span>',deletedText:'<span class="text">'+a.deletedText+"</span>",savedText:'<span class="text">'+a.savedText+"</span>",addedText:'<span class="text">'+a.addedText+"</span>",emptyField:a.emptyField,invalidPhone:a.invalidPhone,invalidEmail:a.invalidEmail,invalidDate:a.invalidDate,emailExist:a.emailExist,demoWpUserID:a.demoWpUserID,monthsNames:a.months,ajaxurl:a.ajaxUrl,cantDeleteCustomer:a.cantDeleteCustomer,cacheElements:function(){this.cache={buttonAdd:e(".bookmify_be_add_new_customer a.add_new"),buttonEdit:e(".bookmify_be_customers_list .customer_item a.bookmify_be_edit"),buttonDelete:e(".bookmify_be_customers_list .customer_item a.bookmify_be_delete"),buttonPagination:e(".bookmify_be_pagination.customer li a"),allInputs:e('input[type="text"]')},this.stopAction=0},init:function(){e(".bookmify_be_customers").length&&e(".bookmify_be_content .bookmify_be_popup_form_wrap").remove(),this.cacheElements(),this.imgToSvg(),this.itemAdd(),this.itemEdit(),this.itemDelete(),this.itemSave(),this.doFilter(),e.protip()},imgToSvg:function(){e("img.bookmify_be_svg").each(function(){var t=e(this),o=t.attr("class"),a=t.attr("src");e.get(a,function(a){var s=e(a).find("svg");void 0!==o&&(s=s.attr("class",o+" replaced-svg")),s=s.removeAttr("xmlns:a"),t.replaceWith(s)},"xml")})},scrollToTop:function(t){e(".bookmify_be_popup_form_wrap").animate({scrollTop:0},t)},wpUserPopper:function(){var t=e(".nano.wp_users_customers"),o=e('body > .bookmify_be_popup_form_customer .input_wrap.wp_user input[type="text"]'),a=this;o.each(function(){var o=e(this),s=o.parent().find(".bot_btn");e(window).on("click",function(){e(".nano").removeClass("focused"),e("input").removeClass("input_clicked")}),t.on("click",function(e){e.stopPropagation()}),o.off().on("click",function(e){e.stopPropagation(),t.css({width:o.outerWidth()+"px"}),o.hasClass("input_clicked")?(o.removeClass("input_clicked"),t.removeClass("focused")):(o.addClass("input_clicked"),t.addClass("focused"),new Popper(o,t,{placement:"bottom-start",onUpdate:function(){t.css({width:o.outerWidth()+"px"})}}))}),t.css({width:o.outerWidth()+"px"}),t.find(".nano-content > div").on("click",function(t){t.stopPropagation();var i=e(this).html(),n=e(this).data("id");o.val(i),o.parent().find('input[type="hidden"]').val(n),a.asdasfdsasdsd(o,s),e(".nano").removeClass("focused"),e("input").removeClass("input_clicked")}),s.on("click",function(){o.val(""),o.parent().find('input[type="hidden"]').val(""),s.removeClass("opened"),e(".nano").removeClass("focused"),e("input").removeClass("input_clicked")}),a.asdasfdsasdsd(o,s)})},asdasfdsasdsd:function(e,t){" "===e.val()||""===e.val()?t.removeClass("opened"):t.addClass("opened")},itemAdd:function(){var t=this;t.cache.buttonAdd.off().on("click",function(a){a.preventDefault();var s=o.cloneForm.clone();e("body").addClass("disable_scroll").append(s),setTimeout(function(){e("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_customer enable"),t.itemSave(),t.wpUserPopper(),t.phoneInput(),t.birthdayInput(),t.closersPopup()},10),t.scrollToTop(1),t.cancelItem()})},phoneInput:function(){e(".bookmify_be_popup_form_customer input.customer_phone").each(function(){var t=e(this),o=t.val();t.intlTelInput({autoPlaceholder:"aggressive",autoHideDialCode:!0}),t.val(o)})},closerButton:function(){var t=this;e(".bookmify_be_popup_form_wrap.enable").find("span.closer").on("click",function(){t.closePopupForm()})},closerEsc:function(){var t=this;e(document).keyup(function(e){"Escape"===e.key&&t.closePopupForm()})},closersPopup:function(){this.closerEsc(),this.closerButton()},closePopupForm:function(){var t=e(".bookmify_be_popup_form_wrap.enable");e("body").removeClass("disable_scroll"),t.removeClass("enable"),setTimeout(function(){t.remove()},300)},birthdayInput:function(){var t,o=this,a=e(".bookmify_be_popup_form_customer .birthday_input_wrap"),s=a.find(".years"),i=s.data("index"),n=a.find(".months"),r=n.data("index");for(t=(new Date).getFullYear();t>1909;t--){var l=t===i?'selected="selected"':"";s.append(e("<option "+l+" />").val(t).html(t))}var c=[["01",this.monthsNames.january],["02",this.monthsNames.february],["03",this.monthsNames.march],["04",this.monthsNames.april],["05",this.monthsNames.may],["06",this.monthsNames.june],["07",this.monthsNames.july],["08",this.monthsNames.august],["09",this.monthsNames.september],["10",this.monthsNames.october],["11",this.monthsNames.november],["12",this.monthsNames.december]];for(t=0;t<12;t++){var d=c[t][0]==r?'selected="selected"':"";n.append(e("<option "+d+" />").val(c[t][0]).html(c[t][1]))}o.updateNumberOfDays(s,n),s.change(function(){o.updateNumberOfDays(s,n)}),n.change(function(){o.updateNumberOfDays(s,n)})},updateNumberOfDays:function(t,o){var a,s=e(".bookmify_be_popup_form_customer .birthday_input_wrap .days"),i=s.data("index"),n=o.val(),r=t.val(),l=this.daysInMonth(r,n);for(s.html('<option value="00">---</option>'),a=1;a<l+1;a++){var c=a==i?'selected="selected"':"";s.append(e("<option "+c+" />").val(a).html(a))}},daysInMonth:function(e,t){return new Date(e,t,0).getDate()},itemSave:function(o,a){var s=this,i=e(".bookmify_be_popup_form_customer .bookmify_be_popup_form_button a.save"),n=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,r=/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\.\/0-9]{6,17}$/;i.off().on("click",function(){var i=e(this),l=i.parents(".bookmify_be_popup_form_customer"),c=0;l.find(".required_field").each(function(){var t=e(this);t.hasClass("customer_email")?""===t.val()?t.parent().hasClass("required_error")||(t.parent().find(".error_note").remove(),t.parent().addClass("required_error").append('<span class="error_note">'+s.emptyField+"</span>"),s.stopAction++):n.test(t.val())?t.parent().hasClass("invalid_email")&&s.stopAction--:t.parent().hasClass("invalid_email")||(t.parent().find(".error_note").remove(),t.parent().addClass("invalid_email").append('<span class="error_note">'+s.invalidEmail+"</span>"),s.stopAction++):""!==t.val()||t.parent().hasClass("required_error")||(t.parent().find(".error_note").remove(),t.parent().addClass("required_error").append('<span class="error_note">'+s.emptyField+"</span>"),s.stopAction++)});var d=l.find(".customer_phone");""!==d.val()&&(r.test(d.val())?d.parent().hasClass("invalid_email")&&s.stopAction--:d.parent().hasClass("invalid_email")||(d.parent().find(".error_note").remove(),d.parent().addClass("invalid_email").append('<span class="error_note">'+s.emptyField+"</span>"),s.stopAction++));var p=parseFloat(l.find(".birthday_input_wrap select.years").val()),m=parseFloat(l.find(".birthday_input_wrap select.months").val()),u=parseFloat(l.find(".birthday_input_wrap select.days").val());m<10&&(m="0"+m),u<10&&(u="0"+u);var _=l.find(".birthday_input_wrap");0==p&&0==m&&0==u?_.parent().hasClass("invalid_email")&&(s.stopAction-=1):0==p||0==m||0==u?0==p&&0==m&&0==u||_.parent().hasClass("invalid_email")||(_.parent().find(".error_note").remove(),_.parent().addClass("invalid_email").append('<span class="error_note">'+s.invalidDate+"</span>"),s.stopAction+=1):_.parent().hasClass("invalid_email")&&(s.stopAction-=1);var f=p+"-"+m+"-"+u;if(0!==s.stopAction)return s.scrollToTop(500),!1;i.addClass("await");var b={};b.first_name=l.find("input.customer_first_name").val(),b.last_name=l.find("input.customer_last_name").val(),b.email=l.find("input.customer_email").val(),b.phone=l.find("input.customer_phone").val(),b.birthday=f,b.country=l.find("input.customer_country").val(),b.state=l.find("input.customer_state").val(),b.city=l.find("input.customer_city").val(),b.address=l.find("input.customer_address").val(),b.postcode=l.find("input.customer_postcode").val(),b.info=l.find("textarea.customer_info").val(),b.wp_user_id=l.find("input[name='wp_user_id']").val(),!0===o&&(b.id=a,c=1);var v={action:"ajaxQueryInsertOrUpdateCustomer",bookmify_data:JSON.stringify(b),bookmify_update:c,bookmify_page:t.page,bookmify_search:t.search,bookmify_order:t.order};return e.ajax({type:"POST",url:s.ajaxurl,cache:!1,data:v,success:function(e){i.removeClass("await"),s.getUpdatedCustomersList(e)},error:function(){}}),!1}),e(".bookmify_be_popup_form_customer input.required_field, .bookmify_be_popup_form_customer input.customer_phone").keyup(function(){var t=e(this);(t.parent().hasClass("required_error")||t.parent().hasClass("invalid_email"))&&(t.parent().removeClass("required_error invalid_email"),t.parent().find(".error_note").remove(),s.stopAction-=1)})},getUpdatedCustomersList:function(t){var o=this,a=e.parseJSON(t),s=e(".bookmify_be_customer_list_content"),i=e(".bookmify_be_customers"),n=e(".bookmify_be_popup_form_customer .customer_email");if(1===a.number)n.parent().hasClass("invalid_email")||(n.parent().find(".error_note").remove(),n.parent().addClass("invalid_email").append('<span class="error_note">'+o.emailExist+"</span>"),o.stopAction+=1,o.scrollToTop(500));else{o.closePopupForm();var r=e(".bookmify_be_page_title h3 span.count"),l=parseInt(a.itemsCount);r.html(l),e.iaoAlert({msg:o.alertSuccessIcon+o.savedText,type:"success",alertTime:o.iaoAlertTime,position:o.iaoAlertPosition}),"cant"===a.demo_check&&setTimeout(function(){e.iaoAlert({msg:o.alertSuccessIcon+o.demoWpUserID,type:"success",alertTime:o.iaoAlertTime,position:o.iaoAlertPosition})},1e3),s.html(a.bookmify_be_data);var c=s.find(".customer_list > .customer_item");setTimeout(function(){c.each(function(t,o){setTimeout(function(){e(o).addClass("fadeInTop done")},100*t)})},150),e("html, body").animate({scrollTop:i.find(".bookmify_be_customers_header").offset().top-i.find(".bookmify_be_customers_header").height()},500),o.init()}},itemEdit:function(){var t=this;t.cache.buttonEdit.off().on("click",function(o){o.preventDefault();var a=e(this),s=a.data("entity-id"),i=a.parents(".bookmify_be_list_item"),n={action:"ajaxQueryEditCustomer",bookmify_data:s};return a.hasClass("loading")||(a.addClass("loading"),i.addClass("loading"),e.ajax({type:"POST",url:t.ajaxurl,cache:!1,data:n,success:function(e){a.removeClass("loading"),i.removeClass("loading"),t.getRequestedCustomerPopup(e)},error:function(){}})),!1})},getRequestedCustomerPopup:function(t){var o=e.parseJSON(t),a=o.bookmify_be_data,s=o.bookmify_be_id;e("body").addClass("disable_scroll").append(a),e("body > .bookmify_be_popup_form_wrap").addClass("bookmify_be_popup_form_customer"),this.wpUserPopper(),this.itemSave(!0,s),this.phoneInput(),this.birthdayInput(),e("body > .bookmify_be_popup_form_wrap").addClass("enable"),this.closersPopup(),this.cancelItem(),this.scrollToTop(1)},itemDelete:function(){var t=this;t.cache.buttonDelete.off().on("click",function(o){o.preventDefault();var a=e(this),s=a.parents(".customer_item"),i=s.data("entity-id");return a.addClass("clicked"),t.itemDeleteConfirm(s,i,a),!1})},itemDeleteConfirm:function(t,o,a){var s=this,i=e("#bookmify_be_confirm");i.addClass("opened customer_confirm");var n=e("#bookmify_be_confirm.customer_confirm").find("a.yes"),r=e("#bookmify_be_confirm.customer_confirm").find("a.no");n.off().on("click",function(n){n.preventDefault(),a.removeClass("clicked"),t.addClass("bookmify_be_being_removed"),t.find(".bookmify_be_delete").addClass("loading");var r={action:"ajaxQueryDeleteCustomer",bookmify_data:o};return e.ajax({type:"POST",url:s.ajaxurl,cache:!0,data:r,success:function(o){var a=e.parseJSON(o),i=e(".bookmify_be_page_title h3 span.count"),n=parseInt(a.count);0===n?(i.html(a.number),t.find(".bookmify_be_delete").removeClass("loading"),t.slideUp(300),setTimeout(function(){t.remove()},301),e.iaoAlert({msg:s.alertSuccessIcon+s.deletedText,type:"success",alertTime:s.iaoAlertTime,position:s.iaoAlertPosition})):(t.find(".bookmify_be_delete").removeClass("loading"),t.removeClass("bookmify_be_being_removed"),e.iaoAlert({msg:s.alertWarningIcon+'<span class="error_note">'+s.cantDeleteCustomer+" "+n+"</span>",type:"success",alertTime:s.iaoAlertTime,position:s.iaoAlertPosition}))}}),i.removeClass("opened customer_confirm"),!1}),r.on("click",function(){return i.removeClass(),a.removeClass("clicked"),!1}),e(document).keydown(function(e){if(27===e.keyCode)return i.removeClass(),a.removeClass("clicked"),!1})},doFilter:function(){var o=this,a=e(".bookmify_be_filter_search");o.cache.buttonPagination.off().on("click",function(a){a.preventDefault();var s=e(this),i=s.parent(),n=s.data("page"),r=0;return i.hasClass("prev")?(n=s.parent().parent().find("li.active a").data("page")-1,r=1):i.hasClass("next")&&(n=s.parent().parent().find("li.active a").data("page")+1,r=1),i.hasClass("active")||(t.page=n,o.filterAjaxCall()),1===r&&(t.page=n,o.filterAjaxCall()),!1}),e(".bookmify_be_customers .bookmify_be_filter .filter_order").off().on("click",function(a){a.preventDefault();var s="ASC",i=e(this).closest(".bookmify_be_filter_order");return!i.hasClass("await")&&(i.addClass("await"),i.hasClass("active")?(i.removeClass("active"),s="ASC"):(i.addClass("active"),s="DESC"),t.order=s,t.orderClass="order_"+s.toLowerCase(),o.filterAjaxCall(),!1)});var s=null;e(".bookmify_be_customers .bookmify_be_filter .filter_search").off().on("keyup",function(){var i=e(this).val();t.page=1,clearTimeout(s),s=setTimeout(function(){if(t.search=i,i===t.text)return!1;t.text=i,a.removeClass("ready").addClass("await"),o.filterAjaxCall()},700)}),a.find(".icon").off().on("click",function(){a.removeClass("ready").addClass("await"),a.find("input").val(""),t.text="",t.search="",t.page=1,o.filterAjaxCall()})},filterAjaxCall:function(){var o=this,a=e(".bookmify_be_filter_search"),s=e(".bookmify_be_filter_order"),i={action:"ajaxFilterCustomerList",bookmify_page:t.page,bookmify_search:t.search,bookmify_order:t.order};e.ajax({type:"POST",url:o.ajaxurl,cache:!0,data:i,success:function(e){a.removeClass("await ready"),""!==t.search&&a.addClass("ready"),s.removeClass("await order_desc order_asc").addClass(t.orderClass),o.getFilteredCustomersList(e)},error:function(){}})},getFilteredCustomersList:function(t){var o=e.parseJSON(t),a=e(".bookmify_be_customer_list_content");a.html(o.bookmify_be_data);var s=a.find(".bookmify_be_list_item");setTimeout(function(){s.each(function(t,o){setTimeout(function(){e(o).addClass("fadeInTop done")},100*t)})},150),this.init()},cancelItem:function(){var t=this;e(".bookmify_be_popup_form_button a.cancel").off().on("click",function(){return t.closePopupForm(),!1})}};e(document).ready(function(){s.init()})}(jQuery);